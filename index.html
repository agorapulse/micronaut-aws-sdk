<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.8">
<meta name="author" content="Vladimir Orany">
<title>Set of useful libraries for Micronaut</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<link rel="stylesheet" href="./asciidoctor.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="css/docs.css?v=1.2.8" />
<style>
.hidden {
    display: none;
}

.switch {
    border-width: 1px 1px 0 1px;
    border-style: solid;
    border-color: #7a2518;
    display: inline-block;
}

.switch--item {
    padding: 10px;
    background-color: #ffffff;
    color: #7a2518;
    display: inline-block;
    cursor: pointer;
}

.switch--item.selected {
    background-color: #7a2519;
    color: #ffffff;
}

</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/zepto/1.2.0/zepto.min.js"></script>
<script type="text/javascript">
function addBlockSwitches() {
    $('.primary').each(function() {
        primary = $(this);
        createSwitchItem(primary, createBlockSwitch(primary)).item.addClass("selected");
        primary.children('.title').remove();
    });
    $('.secondary').each(function(idx, node) {
        secondary = $(node);
        primary = findPrimary(secondary);
        switchItem = createSwitchItem(secondary, primary.children('.switch'));
        switchItem.content.addClass('hidden');
        findPrimary(secondary).append(switchItem.content);
        secondary.remove();
    });
}

function createBlockSwitch(primary) {
    blockSwitch = $('<div class="switch"></div>');
    primary.prepend(blockSwitch);
    return blockSwitch;
}

function findPrimary(secondary) {
    candidate = secondary.prev();
    while (!candidate.is('.primary')) {
        candidate = candidate.prev();
    }
    return candidate;
}

function createSwitchItem(block, blockSwitch) {
    blockName = block.children('.title').text();
    content = block.children('.content').first().append(block.next('.colist'));
    item = $('<div class="switch--item">' + blockName + '</div>');
    item.on('click', '', content, function(e) {
        $(this).addClass('selected');
        $(this).siblings().removeClass('selected');
        e.data.siblings('.content').addClass('hidden');
        e.data.removeClass('hidden');
    });
    blockSwitch.append(item);
    return {'item': item, 'content': content};
}

$(addBlockSwitches);

</script>

</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Set of useful libraries for Micronaut</h1>
<div class="details">
<span id="author" class="author">Vladimir Orany</span><br>
<span id="revnumber">version 1.2.8</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel2">
<li><a href="#_aws_sdk_for_micronaut">1. AWS SDK for Micronaut</a>
<ul class="sectlevel3">
<li><a href="#_installation">1.1. Installation</a></li>
<li><a href="#_dynamodb">1.2. DynamoDB</a>
<ul class="sectlevel4">
<li><a href="#_declarative_services_with_service">Declarative Services with <code>@Service</code></a></li>
<li><a href="#_dynamodb_service">DynamoDB Service</a></li>
<li><a href="#_dynamodb_accelerator_dax">DynamoDB Accelerator (DAX)</a></li>
<li><a href="#_testing">Testing</a></li>
</ul>
</li>
<li><a href="#_kinesis">1.3. Kinesis</a>
<ul class="sectlevel4">
<li><a href="#_configuration">Configuration</a></li>
<li><a href="#_publishing_with_kinesisclient">Publishing with <code>@KinesisClient</code></a></li>
<li><a href="#_listening_with_kinesislistener">Listening with <code>@KinesisListener</code></a></li>
<li><a href="#_kinesis_service">Kinesis Service</a></li>
<li><a href="#_testing_2">Testing</a></li>
</ul>
</li>
<li><a href="#_simple_storage_service_s3">1.4. Simple Storage Service (S3)</a>
<ul class="sectlevel4">
<li><a href="#_configuration_2">Configuration</a></li>
<li><a href="#_simple_storage_service">Simple Storage Service</a></li>
<li><a href="#_testing_3">Testing</a></li>
</ul>
</li>
<li><a href="#_simple_email_service_ses">1.5. Simple Email Service (SES)</a>
<ul class="sectlevel4">
<li><a href="#_simple_email_service">Simple Email Service</a></li>
<li><a href="#_testing_4">Testing</a></li>
</ul>
</li>
<li><a href="#_simple_notification_service_sns">1.6. Simple Notification Service (SNS)</a>
<ul class="sectlevel4">
<li><a href="#_configuration_3">Configuration</a></li>
<li><a href="#_publishing_with_notificationclient">Publishing with <code>@NotificationClient</code></a></li>
<li><a href="#_simple_notification_service">Simple Notification Service</a></li>
<li><a href="#_testing_5">Testing</a></li>
</ul>
</li>
<li><a href="#_simple_queue_service_sqs">1.7. Simple Queue Service (SQS)</a>
<ul class="sectlevel4">
<li><a href="#_configuration_4">Configuration</a></li>
<li><a href="#_publishing_with_queueclient">Publishing with <code>@QueueClient</code></a></li>
<li><a href="#_simple_queue_service">Simple Queue Service</a></li>
<li><a href="#_testing_6">Testing</a></li>
</ul>
</li>
<li><a href="#_security_token_service_sts">1.8. Security Token Service (STS)</a>
<ul class="sectlevel4">
<li><a href="#_security_token_service">Security Token Service</a></li>
<li><a href="#_testing_7">Testing</a></li>
</ul>
</li>
<li><a href="#_websockets_for_api_gateway">1.9. WebSockets for API Gateway</a>
<ul class="sectlevel4">
<li><a href="#_configuration_5">Configuration</a></li>
<li><a href="#_usage">Usage</a></li>
<li><a href="#_testing_8">Testing</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_micronaut_for_api_gateway_proxy">2. Micronaut for API Gateway Proxy</a>
<ul class="sectlevel3">
<li><a href="#_testing_9">2.1. Testing</a></li>
</ul>
</li>
<li><a href="#_micronaut_grails">3. Micronaut Grails</a></li>
<li><a href="#_links">1. Links</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="imageblock ribbon">
<div class="content">
<a class="image" href="https://github.com/agorapulse/micronaut-libraries"><img src="images/ribbon.png" alt="ribbon"></a>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="imageblock left">
<div class="content">
<a class="image" href="https://bintray.com/agorapulse/libs/micronaut-libraries/_latestVersion"><img src="https://api.bintray.com/packages/agorapulse/libs/{project-name]/images/download.svg" alt="download"></a>
</div>
</div>
<div class="imageblock left">
<div class="content">
<a class="image" href="https://github.com/agorapulse/micronaut-libraries/actions?query=workflow%3ACheck"><img src="https://github.com/agorapulse/micronaut-libraries/workflows/Check/badge.svg" alt="Build Status"></a>
</div>
</div>
<div class="imageblock left">
<div class="content">
<a class="image" href="https://coveralls.io/github/agorapulse/micronaut-libraries?branch=master""><img src="https://coveralls.io/repos/github/agorapulse/micronaut-libraries/badge.svg?branch=master" alt="badge"></a>
</div>
</div>
</div>
</div>
<hr>
<div class="paragraph">
<p>Set of useful libraries for <a href="http://micronaut.io">Micronaut</a>. All the libraries are available in <a href="https://bintray.com/bintray/jcenter">JCenter Maven repository</a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#_aws_sdk_for_micronaut">AWS SDK for Micronaut</a> - integration for <a href="#_dynamodb">DynamoDB</a>, <a href="#_kinesis">Kinesis</a>, <a href="#_simple_storage_service_s3">Simple Storage Service (S3)</a>, <a href="#_simple_email_service_ses">Simple Email Service (SES)</a>, <a href="#_simple_notification_service_sns">Simple Notification Service (SNS)</a>,  <a href="#_simple_queue_service_sqs">Simple Queue Service (SQS)</a> and <a href="#_websockets_for_api_gateway">WebSockets for API Gateway</a></p>
</li>
<li>
<p><a href="#_micronaut_for_api_gateway_proxy">Micronaut for API Gateway Proxy</a> - develop API Gateway Proxy Lambda functions using Micronaut HTTP server capabilities</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_aws_sdk_for_micronaut"><a class="anchor" href="#_aws_sdk_for_micronaut"></a>1. AWS SDK for Micronaut</h3>
<div class="paragraph">
<p>AWS SDK for Micronaut is a successor of <a href="https://github.com/agorapulse/grails-aws-sdk">Grails AWS SDK Plugin</a>.
If you are <a href="https://github.com/agorapulse/grails-aws-sdk">Grails AWS SDK Plugin</a> user you should find many of services familiar.</p>
</div>
<div class="paragraph">
<p>Provided integrations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#_dynamodb">DynamoDB</a></p>
</li>
<li>
<p><a href="#_kinesis">Kinesis</a></p>
</li>
<li>
<p><a href="#_simple_storage_service_s3">Simple Storage Service (S3)</a></p>
</li>
<li>
<p><a href="#_simple_email_service_ses">Simple Email Service (SES)</a></p>
</li>
<li>
<p><a href="#_simple_notification_service_sns">Simple Notification Service (SNS)</a></p>
</li>
<li>
<p><a href="#_simple_queue_service_sqs">Simple Queue Service (SQS)</a></p>
</li>
<li>
<p><a href="#_security_token_service_sts">Security Token Service (STS)</a></p>
</li>
<li>
<p><a href="#_websockets_for_api_gateway">WebSockets for API Gateway</a></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<a href="#_micronaut_for_api_gateway_proxy">Micronaut for API Gateway Proxy</a> is handled separately in its own library.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Key concepts of the AWS SDK for Micronaut:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Fully leveraging of Micronaut best practises</p>
<div class="ulist">
<ul>
<li>
<p>Low-level API clients such as <code>AmazonDynamoDB</code> available for dependency injection</p>
</li>
<li>
<p>Declarative clients and services such as <code>@KinesisListener</code> where applicable</p>
</li>
<li>
<p>Configuration driven named service beans</p>
</li>
<li>
<p>Sensible defaults</p>
</li>
<li>
<p>Conditional beans based on presence of classes on the classpath or on the presence of specific properties</p>
</li>
</ul>
</div>
</li>
<li>
<p>Fully leveraging existing AWS SDK configuration chains (e.g. <a href="https://docs.aws.amazon.com/AWSJavaSDK/latest/javadoc/com/amazonaws/auth/DefaultAWSCredentialsProviderChain.html">default credential provider chain</a>, <a href="https://docs.aws.amazon.com/AWSJavaSDK/latest/javadoc/com/amazonaws/regions/DefaultAwsRegionProviderChain.html">default region provider chain</a>)</p>
</li>
<li>
<p>Strong focus on the ease of testing</p>
<div class="ulist">
<ul>
<li>
<p>Low-level API clients such as <code>AmazonDynamoDB</code> injected by Micronaut and overridable in the tests</p>
</li>
<li>
<p>All high-level services hidden behind an interface for easy mocking in the tests</p>
</li>
<li>
<p>Declarative clients and services for easy mocking in the tests</p>
</li>
</ul>
</div>
</li>
<li>
<p>Java-enabled but Groovy is a first-class citizen</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In this documentation, the high-level approaches will be discussed first before the lower-level services.</p>
</div>
<div class="sect3">
<h4 id="_installation"><a class="anchor" href="#_installation"></a>1.1. Installation</h4>
<div class="listingblock primary">
<div class="title">Gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code>compile 'com.agorapulse:micronaut-aws-sdk:1.2.8'

// only required for DynamoDB and Kinesis integration
compile group: 'com.amazonaws', name: 'aws-java-sdk-dynamodb', version: '1.11.656'

// only required for DynamoDB Accelerator (DAX) integration
compile group: 'com.amazonaws', name: 'amazon-dax-client', version: '1.0.202017.0'

// only required for Kinesis integration
compile group: 'com.amazonaws', name: 'amazon-kinesis-client', version: '1.9.3'
compile group: 'com.amazonaws', name: 'aws-java-sdk-kinesis', version: '1.11.656'

// only required for S3 integration
compile group: 'com.amazonaws', name: 'aws-java-sdk-s3', version: '1.11.656'

// only required for SES integration
compile group: 'com.amazonaws', name: 'aws-java-sdk-ses', version: '1.11.656'

// only required for SNS integration
compile group: 'com.amazonaws', name: 'aws-java-sdk-sns', version: '1.11.656'

// only required for SQS integration
compile group: 'com.amazonaws', name: 'aws-java-sdk-sqs', version: '1.11.656'

// only required for STS integration
compile group: 'com.amazonaws', name: 'aws-java-sdk-sts', version: '1.11.656'</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Maven</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.agorapulse&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-aws-sdk&lt;/artifactId&gt;
    &lt;version&gt;1.2.8&lt;/version&gt;
&lt;/dependency&gt;

&lt;!-- only required for DynamoDB and Kinesis integration --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.amazonaws&lt;/groupId&gt;
    &lt;artifactId&gt;aws-java-sdk-dynamodb&lt;/artifactId&gt;
    &lt;version&gt;1.11.656&lt;/version&gt;
&lt;/dependency&gt;

&lt;!-- only required for DynamoDB Accelerator (DAX) integration --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.amazonaws&lt;/groupId&gt;
    &lt;artifactId&gt;amazon-dax-client&lt;/artifactId&gt;
    &lt;version&gt;1.0.202017.0&lt;/version&gt;
&lt;/dependency&gt;

&lt;!-- only required for Kinesis integration --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.amazonaws&lt;/groupId&gt;
    &lt;artifactId&gt;amazon-kinesis-client&lt;/artifactId&gt;
    &lt;version&gt;1.9.3&lt;/version&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
    &lt;groupId&gt;com.amazonaws&lt;/groupId&gt;
    &lt;artifactId&gt;aws-java-sdk-kinesis&lt;/artifactId&gt;
    &lt;version&gt;1.11.656&lt;/version&gt;
&lt;/dependency&gt;

&lt;!-- only required for S3 integration --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.amazonaws&lt;/groupId&gt;
    &lt;artifactId&gt;aws-java-sdk-s3&lt;/artifactId&gt;
    &lt;version&gt;1.11.656&lt;/version&gt;
&lt;/dependency&gt;

&lt;!-- only required for SES integration --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.amazonaws&lt;/groupId&gt;
    &lt;artifactId&gt;aws-java-sdk-ses&lt;/artifactId&gt;
    &lt;version&gt;1.11.656&lt;/version&gt;
&lt;/dependency&gt;

&lt;!-- only required for SNS integration --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.amazonaws&lt;/groupId&gt;
    &lt;artifactId&gt;aws-java-sdk-sns&lt;/artifactId&gt;
    &lt;version&gt;1.11.656&lt;/version&gt;
&lt;/dependency&gt;

&lt;!-- only required for SQS integration --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.amazonaws&lt;/groupId&gt;
    &lt;artifactId&gt;aws-java-sdk-sqs&lt;/artifactId&gt;
    &lt;version&gt;1.11.656&lt;/version&gt;
&lt;/dependency&gt;

&lt;!-- only required for STS integration --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.amazonaws&lt;/groupId&gt;
    &lt;artifactId&gt;aws-java-sdk-sts&lt;/artifactId&gt;
    &lt;version&gt;1.11.656&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_dynamodb"><a class="anchor" href="#_dynamodb"></a>1.2. DynamoDB</h4>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Amazon DynamoDB is a fully managed NoSQL database service that provides fast and predictable performance with seamless scalability.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>This library provides two approaches to work with DynamoDB tables and entities:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>High-level <a href="#_declarative_services_with_service">Declarative Services with <code>@Service</code></a></p>
</li>
<li>
<p>Middle-level <a href="#_dynamodb_service">DynamoDB Service</a></p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_declarative_services_with_service"><a class="anchor" href="#_declarative_services_with_service"></a>Declarative Services with <code>@Service</code></h5>
<div class="paragraph">
<p>Declarative services are very similar to <a href="http://gorm.grails.org/6.1.x/hibernate/manual/#dataServices">Grails GORM Data Services</a>.
If you place <code>com.agorapulse.micronaut.aws.dynamodb.annotation.Service</code> annotation on the interface then methods
matching predefined pattern will be automatically implemented.</p>
</div>
<div class="sect5">
<h6 id="_method_signatures"><a class="anchor" href="#_method_signatures"></a>Method Signatures</h6>
<div class="paragraph">
<p>The following example shows many of available method signatures:</p>
</div>
<div class="listingblock primary">
<div class="title">Groovy</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code class="language-groovy" data-lang="groovy">@Service(DynamoDBEntity)
interface DynamoDBItemDBService {

    DynamoDBEntity get(String hash, String rangeKey)
    DynamoDBEntity load(String hash, String rangeKey)
    List&lt;DynamoDBEntity&gt; getAll(String hash, List&lt;String&gt; rangeKeys)
    List&lt;DynamoDBEntity&gt; getAll(String hash, String... rangeKeys)
    List&lt;DynamoDBEntity&gt; loadAll(String hash, List&lt;String&gt; rangeKeys)
    List&lt;DynamoDBEntity&gt; loadAll(String hash, String... rangeKeys)

    DynamoDBEntity save(DynamoDBEntity entity)
    List&lt;DynamoDBEntity&gt; saveAll(DynamoDBEntity... entities)
    List&lt;DynamoDBEntity&gt; saveAll(Iterable&lt;DynamoDBEntity&gt; entities)

    int count(String hashKey)
    int count(String hashKey, String rangeKey)

    @Query({
        query(DynamoDBEntity) {
            hash hashKey
            range {
                eq DynamoDBEntity.RANGE_INDEX, rangeKey
            }
        }
    })
    int countByRangeIndex(String hashKey, String rangeKey)

    @Query({
        query(DynamoDBEntity) {
            hash hashKey
            range { between DynamoDBEntity.DATE_INDEX, after, before }
        }
    })
    int countByDates(String hashKey, Date after, Date before)

    Flowable&lt;DynamoDBEntity&gt; query(String hashKey)
    Flowable&lt;DynamoDBEntity&gt; query(String hashKey, String rangeKey)

    @Query({
        query(DynamoDBEntity) {
            hash hashKey
            range {
                eq DynamoDBEntity.RANGE_INDEX, rangeKey
            }
            only {
                rangeIndex
            }
        }
    })
    Flowable&lt;DynamoDBEntity&gt; queryByRangeIndex(String hashKey, String rangeKey)

    @Query({
        query(DynamoDBEntity) {
            hash hashKey
            range { between DynamoDBEntity.DATE_INDEX, after, before }
        }
    })
    List&lt;DynamoDBEntity&gt; queryByDates(String hashKey, Date after, Date before)

    void delete(DynamoDBEntity entity)
    void delete(String hashKey, String rangeKey)

    @Query({
        query(DynamoDBEntity) {
            hash hashKey
            range {
                eq DynamoDBEntity.RANGE_INDEX, rangeKey
            }
        }
    })
    int deleteByRangeIndex(String hashKey, String rangeKey)

    @Query({
        query(DynamoDBEntity) {
            hash hashKey
            range { between DynamoDBEntity.DATE_INDEX, after, before }
        }
    })
    int deleteByDates(String hashKey, Date after, Date before)

    @Update({
        update(DynamoDBEntity) {
            hash hashKey
            range rangeKey
            add 'number', 1
            returnUpdatedNew { number }
        }
    })
    Number increment(String hashKey, String rangeKey)

    @Update({
        update(DynamoDBEntity) {
            hash hashKey
            range rangeKey
            add 'number', -1
            returnUpdatedNew { number }
        }
    })
    Number decrement(String hashKey, String rangeKey)

    @Scan({
        scan(DynamoDBEntity) {
            filter {
                eq DynamoDBEntity.RANGE_INDEX, foo
            }
        }
    })
    Flowable&lt;DynamoDBEntity&gt; scanAllByRangeIndex(String foo)

}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Java</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code class="language-java" data-lang="java">@Service(DynamoDBEntity.class)
public interface DynamoDBEntityService {

    class EqRangeIndex implements Function&lt;Map&lt;String, Object&gt;, DetachedQuery&gt; {
        public DetachedQuery apply(Map&lt;String, Object&gt; arguments) {
            return Builders.query(DynamoDBEntity.class)
                .hash(arguments.get("hashKey"))
                .range(r -&gt; r.eq(DynamoDBEntity.RANGE_INDEX, arguments.get("rangeKey")));
        }
    }

    class EqRangeProjection implements Function&lt;Map&lt;String, Object&gt;, DetachedQuery&gt; {
        public DetachedQuery apply(Map&lt;String, Object&gt; arguments) {
            return Builders.query(DynamoDBEntity.class)
                .hash(arguments.get("hashKey"))
                .range(r -&gt;
                    r.eq(DynamoDBEntity.RANGE_INDEX, arguments.get("rangeKey"))
                )
                .only(DynamoDBEntity.RANGE_INDEX);
        }
    }

    class EqRangeScan implements Function&lt;Map&lt;String, Object&gt;, DetachedScan&gt; {
        public DetachedScan apply(Map&lt;String, Object&gt; arguments) {
            return Builders.scan(DynamoDBEntity.class)
                .filter(f -&gt; f.eq(DynamoDBEntity.RANGE_INDEX, arguments.get("foo")));
        }
    }

    class BetweenDateIndex implements Function&lt;Map&lt;String, Object&gt;, DetachedQuery&gt; {
        public DetachedQuery apply(Map&lt;String, Object&gt; arguments) {
            return Builders.query(DynamoDBEntity.class)
                .hash(arguments.get("hashKey"))
                .range(r -&gt; r.between(DynamoDBEntity.DATE_INDEX, arguments.get("after"), arguments.get("before")));
        }
    }

    class IncrementNumber implements Function&lt;Map&lt;String, Object&gt;, DetachedUpdate&gt; {
        public DetachedUpdate apply(Map&lt;String, Object&gt; arguments) {
            return Builders.update(DynamoDBEntity.class)
                .hash(arguments.get("hashKey"))
                .range(arguments.get("rangeKey"))
                .add("number", 1)
                .returnUpdatedNew(DynamoDBEntity::getNumber);
        }
    }

    class DecrementNumber implements Function&lt;Map&lt;String, Object&gt;, DetachedUpdate&gt; {
        public DetachedUpdate apply(Map&lt;String, Object&gt; arguments) {
            return Builders.update(DynamoDBEntity.class)
                .hash(arguments.get("hashKey"))
                .range(arguments.get("rangeKey"))
                .add("number", -1)
                .returnUpdatedNew(DynamoDBEntity::getNumber);
        }
    }

    DynamoDBEntity get(String hash, String rangeKey);

    DynamoDBEntity load(String hash, String rangeKey);

    List&lt;DynamoDBEntity&gt; getAll(String hash, List&lt;String&gt; rangeKeys);

    List&lt;DynamoDBEntity&gt; getAll(String hash, String... rangeKeys);

    List&lt;DynamoDBEntity&gt; loadAll(String hash, List&lt;String&gt; rangeKeys);

    List&lt;DynamoDBEntity&gt; loadAll(String hash, String... rangeKeys);

    DynamoDBEntity save(DynamoDBEntity entity);

    List&lt;DynamoDBEntity&gt; saveAll(DynamoDBEntity... entities);

    List&lt;DynamoDBEntity&gt; saveAll(Iterable&lt;DynamoDBEntity&gt; entities);

    int count(String hashKey);

    int count(String hashKey, String rangeKey);

    @Query(EqRangeIndex.class)
    int countByRangeIndex(String hashKey, String rangeKey);

    @Query(BetweenDateIndex.class)
    int countByDates(String hashKey, Date after, Date before);

    Flowable&lt;DynamoDBEntity&gt; query(String hashKey);

    Flowable&lt;DynamoDBEntity&gt; query(String hashKey, String rangeKey);

    @Query(EqRangeProjection.class)
    Flowable&lt;DynamoDBEntity&gt; queryByRangeIndex(String hashKey, String rangeKey);

    @Query(BetweenDateIndex.class)
    List&lt;DynamoDBEntity&gt; queryByDates(String hashKey, Date after, Date before);

    void delete(DynamoDBEntity entity);

    void delete(String hashKey, String rangeKey);

    @Query(EqRangeIndex.class)
    int deleteByRangeIndex(String hashKey, String rangeKey);

    @Query(BetweenDateIndex.class)
    int deleteByDates(String hashKey, Date after, Date before);

    @Update(IncrementNumber.class)
    Number increment(String hashKey, String rangeKey);

    @Update(DecrementNumber.class)
    Number decrement(String hashKey, String rangeKey);

    @Scan(EqRangeScan.class)
    Flowable&lt;DynamoDBEntity&gt; scanAllByRangeIndex(String foo);

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following table summarizes the supported method signatures:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Basic Service Methods</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Return Type</th>
<th class="tableblock halign-left valign-top">Method Name</th>
<th class="tableblock halign-left valign-top">Arguments</th>
<th class="tableblock halign-left valign-top">Example</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>T</code></p>
<p class="tableblock">    <code>List&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>save*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An entity, array of entities or iterable of entities</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DynamoDBEntity save(DynamoDBEntity entity)</code></p>
<p class="tableblock">    <code>List&lt;DynamoDBEntity&gt; saveAll(DynamoDBEntity&#8230;&#8203; entities)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Perists the entity or a list of entities and returns self</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>T</code></p>
<p class="tableblock">    <code>List&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>get*</code>, <code>load*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hash key and optional range key, array of range keys or iterable of range keys annotated with <code>@HashKey</code> and <code>@RangeKey</code> if the argument name does not contain word <code>hash</code> or <code>range</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DynamoDBEntity load(String hashKey);</code></p>
<p class="tableblock">    <code>List&lt;DynamoDBEntity&gt; getAll(@HashKey String parentId, String&#8230;&#8203; rangeKeys);</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Loads a single entity or a list of entities from the table. Range key is required for tables which defines the range key</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>count*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hash key and optional range key annotated with <code>@HashKey</code> and <code>@RangeKey</code> if the argument name does not contain word <code>hash</code> or <code>range</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int count(String hashKey)</code></p>
<p class="tableblock">    <code>int count(@HashKey String parentId, String rangeKey)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counts the items in the database. Beware, this can be very expensive operation in DynamoDB. See <a href="#_advanced_queries">Advanced Queries</a> for advanced use cases</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>void</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>delete*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Entity or Hash key and optional range key annotated with <code>@HashKey</code> and <code>@RangeKey</code> if the argument name does not contain word <code>hash</code> or <code>range</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>void delete(DynamoDBEntity entity)</code></p>
<p class="tableblock">    <code>void delete(String hashKey, String rangeKey)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deletes an item which can be specified with hash key and optional range key. See <a href="#_advanced_queries">Advanced Queries</a> for advanced use cases</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Flowable&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>list*</code></p>
<p class="tableblock"><code>findAll*</code></p>
<p class="tableblock"><code>query*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Entity or Hash key and optional range key annotated with <code>@HashKey</code> and <code>@RangeKey</code> if the argument name does not contain word <code>hash</code> or <code>range</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Flowable&lt;DynamoDBEntity&gt; query(String hashKey)</code></p>
<p class="tableblock">    <code>List&lt;DynamoDBEntity&gt; query(String hashKey, String rangeKey)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Queries for all entities with given hash key and/or range key.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(contextual)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(none of above)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any arguments which will be translated into arguments map</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(see below)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Query, scan or update. See <a href="#_advanced_queries">Advanced Queries</a>, <a href="#_scanning">Scanning</a> and <a href="#_updates">Updates</a> for advanced use cases</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Calling any of the declarative service method will create the DynamoDB table automatically if it does not exist already.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_advanced_queries"><a class="anchor" href="#_advanced_queries"></a>Advanced Queries</h6>
<div class="paragraph">
<p>DynamoDB integration does not support feature known as <a href="http://gorm.grails.org/6.0.x/hibernate/manual/index.html#finders"><em>dynamic finders</em></a>.
Instead you can annotate any method with <code>@Query</code> annotation to make it</p>
</div>
<div class="ulist">
<ul>
<li>
<p>counting method if its name begins with <code>count</code></p>
</li>
<li>
<p>batch delete method if its name begins with <code>delete</code></p>
</li>
<li>
<p>otherwise an advanced query method</p>
</li>
</ul>
</div>
<div class="listingblock primary">
<div class="title">Groovy</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code class="language-groovy" data-lang="groovy">Unresolved directive in dynamodb.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/dynamodb/DefaultDynamoDBServiceSpec.groovy[tags=builders-import]
Unresolved directive in dynamodb.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/dynamodb/DefaultDynamoDBServiceSpec.groovy[tags=service-header]
Unresolved directive in dynamodb.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/dynamodb/DefaultDynamoDBServiceSpec.groovy[tags=sample-queries]
Unresolved directive in dynamodb.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/dynamodb/DefaultDynamoDBServiceSpec.groovy[tags=service-footer]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>Builders</code> class provides all necessary factory methods and keywords</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Annotate an interface with <code>@Service</code> with the type of the entity as its <code>value</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>@Query</code> annotation accepts a closure which returns a query builder (see <a href="https://agorapulse.github.io/micronaut-libraries/docs/javadoc/micronaut-aws-sdk/com/agorapulse/micronaut/aws/dynamodb/builder/QueryBuilder.html">QueryBuilder</a> for full reference)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Specify a hash key with <code>hash</code> method and method&#8217;s <code>hashKey</code> argument</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Specify some range key criteria with the method&#8217;s <code>rangeKey</code> argument (see <a href="https://agorapulse.github.io/micronaut-libraries/docs/javadoc/micronaut-aws-sdk/com/agorapulse/micronaut/aws/dynamodb/builder/RangeConditionCollector.html">RangeConditionCollector</a> for full reference)</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>You can limit which properties are returned from the query</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Only <code>rangeIndex</code> property will be populated in the entities returned</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>The arguments have no special meaning but you can use them in the query. The method must return either <code>Flowable</code> or <code>List</code> of entities.</td>
</tr>
</table>
</div>
<div class="listingblock secondary">
<div class="title">Java</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code class="language-java" data-lang="java">Unresolved directive in dynamodb.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/dynamodb/DynamoDBEntityService.java[tags=header]

Unresolved directive in dynamodb.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/dynamodb/DynamoDBEntityService.java[tags=sample-query-class]

Unresolved directive in dynamodb.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/dynamodb/DynamoDBEntityService.java[tags=sample-query]

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate an interface with <code>@Service</code> with the type of the entity as its <code>value</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Define class which implements <code>Function&lt;Map&lt;String, Object&gt;, DetachedQuery&gt;</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Use <code>Builders</code> class to create a query builder for given DynamoDB entity (see <a href="https://agorapulse.github.io/micronaut-libraries/docs/javadoc/micronaut-aws-sdk/com/agorapulse/micronaut/aws/dynamodb/builder/QueryBuilder.html">QueryBuilder</a> for full reference)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Specify a hash key with <code>hash</code> method and method&#8217;s <code>hashKey</code> argument</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Specify some range key criteria with the method&#8217;s <code>rangeKey</code> argument (see <a href="https://agorapulse.github.io/micronaut-libraries/docs/javadoc/micronaut-aws-sdk/com/agorapulse/micronaut/aws/dynamodb/builder/RangeConditionCollector.html">RangeConditionCollector</a> for full reference)</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Only <code>rangeIndex</code> property will be populated in the entities returned</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td><code>@Query</code> annotation accepts a class which implements <code>Function&lt;Map&lt;String, Object&gt;, DetachedQuery&gt;</code></td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>The arguments have no special meaning but you can use them in the query using <code>arguments</code> map. The method must return either <code>Flowable</code> or <code>List</code> of entities.</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_scanning"><a class="anchor" href="#_scanning"></a>Scanning</h6>
<div class="paragraph">
<p>DynamoDB integration does not support feature known as <a href="http://gorm.grails.org/6.0.x/hibernate/manual/index.html#finders"><em>dynamic finders</em></a>.
If you need to scan the table by unindexed attributes you can annotate any method with <code>@scan</code> annotation to make it</p>
</div>
<div class="ulist">
<ul>
<li>
<p>counting method if its name begins with <code>count</code></p>
</li>
<li>
<p>otherwise an advanced query method</p>
</li>
</ul>
</div>
<div class="listingblock primary">
<div class="title">Groovy</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code class="language-groovy" data-lang="groovy">Unresolved directive in dynamodb.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/dynamodb/DefaultDynamoDBServiceSpec.groovy[tags=builders-import]

Unresolved directive in dynamodb.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/dynamodb/DefaultDynamoDBServiceSpec.groovy[tags=service-header]

Unresolved directive in dynamodb.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/dynamodb/DefaultDynamoDBServiceSpec.groovy[tags=sample-scan]

Unresolved directive in dynamodb.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/dynamodb/DefaultDynamoDBServiceSpec.groovy[tags=service-footer]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>Builders</code> class provides all necessary factory methods and keywords</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Annotate an interface with <code>@Service</code> with the type of the entity as its <code>value</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>@Scan</code> annotation accepts a closure which returns a scan builder (see <a href="https://agorapulse.github.io/micronaut-libraries/docs/javadoc/micronaut-aws-sdk/com/agorapulse/micronaut/aws/dynamodb/builder/ScanBuilder.html">ScanBuilder</a> for full reference)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Specify some filter criteria with the method&#8217;s <code>foo</code> argument (see <a href="https://agorapulse.github.io/micronaut-libraries/docs/javadoc/micronaut-aws-sdk/com/agorapulse/micronaut/aws/dynamodb/builder/RangeConditionCollector.html">RangeConditionCollector</a> for full reference)</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The arguments have no special meaning but you can use them in the scan definition. The method must return either <code>Flowable</code> or <code>List</code> of entities.</td>
</tr>
</table>
</div>
<div class="listingblock secondary">
<div class="title">Java</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code class="language-java" data-lang="java">Unresolved directive in dynamodb.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/dynamodb/DynamoDBEntityService.java[tags=header]

Unresolved directive in dynamodb.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/dynamodb/DynamoDBEntityService.java[tags=sample-scan-class]

Unresolved directive in dynamodb.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/dynamodb/DynamoDBEntityService.java[tags=sample-scan]

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate an interface with <code>@Service</code> with the type of the entity as its <code>value</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Define class which implements <code>Function&lt;Map&lt;String, Object&gt;, DetachedScan&gt;</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Use <code>Builders</code> class to create a scan builder for given DynamoDB entity (see <a href="https://agorapulse.github.io/micronaut-libraries/docs/javadoc/micronaut-aws-sdk/com/agorapulse/micronaut/aws/dynamodb/builder/ScanBuilder.html">ScanBuilder</a> for full reference)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Specify some filter criteria with the method&#8217;s <code>foo</code> argument (see <a href="https://agorapulse.github.io/micronaut-libraries/docs/javadoc/micronaut-aws-sdk/com/agorapulse/micronaut/aws/dynamodb/builder/RangeConditionCollector.html">RangeConditionCollector</a> for full reference)</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td><code>@Scan</code> annotation accepts a class which implements <code>Function&lt;Map&lt;String, Object&gt;, DetachedScan&gt;</code></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>The arguments have no special meaning but you can use them in the scan definition. The method must return either <code>Flowable</code> or <code>List</code> of entities.</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_updates"><a class="anchor" href="#_updates"></a>Updates</h6>
<div class="paragraph">
<p>Declarative services allows you to execute fine-grained updates. Any method annotated with <code>@Update</code> will perform the update in the DynamoDB table.</p>
</div>
<div class="listingblock primary">
<div class="title">Groovy</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code class="language-groovy" data-lang="groovy">Unresolved directive in dynamodb.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/dynamodb/DefaultDynamoDBServiceSpec.groovy[tags=builders-import]

Unresolved directive in dynamodb.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/dynamodb/DefaultDynamoDBServiceSpec.groovy[tags=service-header]

Unresolved directive in dynamodb.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/dynamodb/DefaultDynamoDBServiceSpec.groovy[tags=sample-update]

Unresolved directive in dynamodb.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/dynamodb/DefaultDynamoDBServiceSpec.groovy[tags=service-footer]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>Builders</code> class provides all necessary factory methods and keywords</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Annotate an interface with <code>@Service</code> with the type of the entity as its <code>value</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>@Update</code> annotation accepts a closure which returns an update builder (see <a href="https://agorapulse.github.io/micronaut-libraries/docs/javadoc/micronaut-aws-sdk/com/agorapulse/micronaut/aws/dynamodb/builder/UpdateBuilder.html">UpdateBuilder</a> for full reference)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Specify a hash key with <code>hash</code> method and method&#8217;s <code>hashKey</code> argument</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Specify a range key with <code>range</code> method and method&#8217;s <code>rangeKey</code> argument</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Specify update operation - increment <code>number</code> attribute (see <a href="https://agorapulse.github.io/micronaut-libraries/docs/javadoc/micronaut-aws-sdk/com/agorapulse/micronaut/aws/dynamodb/builder/UpdateBuilder.html">UpdateBuilder</a> for full reference). You may have multiple update operations.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Specify what should be returned from the method (see <a href="https://agorapulse.github.io/micronaut-libraries/docs/javadoc/micronaut-aws-sdk/com/agorapulse/micronaut/aws/dynamodb/builder/UpdateBuilder.html">UpdateBuilder</a> for full reference).</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>The arguments have no special meaning but you can use them in the scan definition. The method&#8217;s return value depends on the value returned from <code>returnUpdatedNew</code> mapper.</td>
</tr>
</table>
</div>
<div class="listingblock secondary">
<div class="title">Java</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code class="language-java" data-lang="java">Unresolved directive in dynamodb.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/dynamodb/DynamoDBEntityService.java[tags=header]

Unresolved directive in dynamodb.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/dynamodb/DynamoDBEntityService.java[tags=sample-update-class]

Unresolved directive in dynamodb.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/dynamodb/DynamoDBEntityService.java[tags=sample-update]

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate an interface with <code>@Service</code> with the type of the entity as its <code>value</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Define class which implements <code>Function&lt;Map&lt;String, Object&gt;, DetachedUpdate&gt;</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Use <code>Builders</code> class to create an update builder for given DynamoDB entity (see <a href="https://agorapulse.github.io/micronaut-libraries/docs/javadoc/micronaut-aws-sdk/com/agorapulse/micronaut/aws/dynamodb/builder/UpdateBuilder.html">UpdateBuilder</a> for full reference)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Specify a hash key with <code>hash</code> method and method&#8217;s <code>hashKey</code> argument</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Specify a range key with <code>range</code> method and method&#8217;s <code>rangeKey</code> argument</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Specify update operation - increment <code>number</code> attribute (see <a href="https://agorapulse.github.io/micronaut-libraries/docs/javadoc/micronaut-aws-sdk/com/agorapulse/micronaut/aws/dynamodb/builder/UpdateBuilder.html">UpdateBuilder</a> for full reference). You may have multiple update operations.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Specify what should be returned from the method (see <a href="https://agorapulse.github.io/micronaut-libraries/docs/javadoc/micronaut-aws-sdk/com/agorapulse/micronaut/aws/dynamodb/builder/UpdateBuilder.html">UpdateBuilder</a> for full reference).</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td><code>@Update</code> annotation accepts a class which implements <code>Function&lt;Map&lt;String, Object&gt;, DetachedUpdate&gt;</code></td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>The arguments have no special meaning but you can use them in the scan definition. The method&#8217;s return value depends on the value returned from <code>returnUpdatedNew</code> mapper.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_dynamodb_service"><a class="anchor" href="#_dynamodb_service"></a>DynamoDB Service</h5>
<div class="paragraph">
<p><code>DynamoDBService</code> provides middle-level API for working with DynamoDB tables and entites. You can obtain instance of <code>DynamoDBService</code> from
<code>DynamoDBServiceProvider</code> which can be injected to any bean.</p>
</div>
<div class="listingblock primary">
<div class="title">Groovy</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code class="language-groovy" data-lang="groovy">        DynamoDBServiceProvider provider = context.getBean(DynamoDBServiceProvider)
        DynamoDBService&lt;DynamoDBEntity&gt; s = provider.findOrCreate(DynamoDBEntity)       <i class="conum" data-value="1"></i><b>(1)</b>

Unresolved directive in dynamodb.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/dynamodb/DefaultDynamoDBServiceSpec.groovy[tags=create-table]

Unresolved directive in dynamodb.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/dynamodb/DefaultDynamoDBServiceSpec.groovy[tags=save-entity]

Unresolved directive in dynamodb.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/dynamodb/DefaultDynamoDBServiceSpec.groovy[tags=load-entity]

Unresolved directive in dynamodb.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/dynamodb/DefaultDynamoDBServiceSpec.groovy[tags=query-by-range-index]

Unresolved directive in dynamodb.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/dynamodb/DefaultDynamoDBServiceSpec.groovy[tags=query-by-dates]

Unresolved directive in dynamodb.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/dynamodb/DefaultDynamoDBServiceSpec.groovy[tags=increment]

Unresolved directive in dynamodb.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/dynamodb/DefaultDynamoDBServiceSpec.groovy[tags=delete]

Unresolved directive in dynamodb.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/dynamodb/DefaultDynamoDBServiceSpec.groovy[tags=delete-all]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Obtain the instance of <code>DynamoDBService</code> from <code>DynamoDBServiceProvider</code> (provider can be injected)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Create table for the entity</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Save an entity</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Load the entity by its hash and range keys</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Query the table for entities with given range index value</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Query the table for entities having date between the specified dates</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Increment a property for entity specified by hash and range keys</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Delete an entity by object reference</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Delete all entities with given range index value</td>
</tr>
</table>
</div>
<div class="listingblock secondary">
<div class="title">Java</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code class="language-java" data-lang="java">Unresolved directive in dynamodb.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/dynamodb/DynamoDBServiceTest.java[tags=obtain-service]

Unresolved directive in dynamodb.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/dynamodb/DynamoDBServiceTest.java[tags=create-table]

Unresolved directive in dynamodb.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/dynamodb/DynamoDBServiceTest.java[tags=save-entity]

Unresolved directive in dynamodb.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/dynamodb/DynamoDBServiceTest.java[tags=load-entity]

Unresolved directive in dynamodb.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/dynamodb/DynamoDBServiceTest.java[tags=query-by-range-index]

Unresolved directive in dynamodb.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/dynamodb/DynamoDBServiceTest.java[tags=query-by-dates]

Unresolved directive in dynamodb.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/dynamodb/DynamoDBServiceTest.java[tags=increment]

Unresolved directive in dynamodb.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/dynamodb/DynamoDBServiceTest.java[tags=delete]

Unresolved directive in dynamodb.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/dynamodb/DynamoDBServiceTest.java[tags=delete-all]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Obtain the instance of <code>DynamoDBService</code> from <code>DynamoDBServiceProvider</code> (provider can be injected)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Create table for the entity</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Save an entity</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Load the entity by its hash and range keys</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Query the table for entities with given range index value</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Query the table for entities having date between the specified dates</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Increment a property for entity specified by hash and range keys</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Delete an entity by object reference</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Delete all entities with given range index value</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Please see <a href="https://agorapulse.github.io/micronaut-libraries/docs/javadoc/micronaut-aws-sdk/com/agorapulse/micronaut/aws/dynamodb/DynamoDBService.html">DynamoDBService</a> for full reference.</p>
</div>
</div>
<div class="sect4">
<h5 id="_dynamodb_accelerator_dax"><a class="anchor" href="#_dynamodb_accelerator_dax"></a>DynamoDB Accelerator (DAX)</h5>
<div class="paragraph">
<p>You can simply enable DynamoDB Accelerator by setting the DAX endpoint as <code>aws.dax.endpoint</code> property. Every operation
performed using injected <code>AmazonDynamoDB</code>, <code>IDynamoDBMapper</code> or a data service will be performed against DAX instead of
DynamoDB tables.</p>
</div>
<div class="paragraph">
<p>Please, check <a href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/DAX.consistency.html">DAX and DynamoDB Consistency Models</a>
article to understand the subsequence of using DAX instead of direct DynamoDB operations.</p>
</div>
<div class="paragraph">
<p>Make sure you have set up proper policy to access the DAX cluster. See <a href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/DAX.access-control.html">DAX Access Control</a> for more information.
Following policy allow every DAX operatin on any resource. In production, you should constraint the scope to single cluster.</p>
</div>
<div class="listingblock">
<div class="title">DAX Access Policy</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-json" data-lang="json">{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "DaxAllowAll",
            "Effect": "Allow",
            "Action": "dax:*",
            "Resource": "*"
        }
    ]
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_testing"><a class="anchor" href="#_testing"></a>Testing</h5>
<div class="paragraph">
<p>You can very easily mock any of the interfaces and declarative services but if you need close-to-production
DynamoDB integration works well with <a href="https://www.testcontainers.org/">Testcontainers</a> and <a href="https://localstack.cloud/">LocalStack</a>.</p>
</div>
<div class="paragraph">
<p>You need to add following dependencies into your build file:</p>
</div>
<div class="listingblock primary">
<div class="title">Gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code>compile group: 'org.testcontainers', name: 'localstack', version: '1.10.2'
compile group: 'org.testcontainers', name: 'spock', version: '1.10.2'</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Maven</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.testcontainers&lt;/groupId&gt;
    &lt;artifactId&gt;localstack&lt;/artifactId&gt;
    &lt;version&gt;1.10.2&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.testcontainers&lt;/groupId&gt;
    &lt;artifactId&gt;spock&lt;/artifactId&gt;
    &lt;version&gt;1.10.2&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you can setup your tests like this:</p>
</div>
<div class="listingblock primary">
<div class="title">Groovy</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">Unresolved directive in dynamodb.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/dynamodb/DefaultDynamoDBServiceSpec.groovy[tags=testcontainers-header]
Unresolved directive in dynamodb.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/dynamodb/DefaultDynamoDBServiceSpec.groovy[tags=testcontainers-setup]
    // test methods

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate the specification with <code>@Testcontainers</code> to let Spock manage the Testcontainers for you</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Prepare the reference to the <code>ApplicationContext</code>, <code>@AutoCleanup</code> guarantees closing the context after the tests</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Create an instance of <code>LocalStackContainer</code> with only DynamoDB support enabled</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Create <code>AmazonDynamoDB</code> client using the LocalStack configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Register the client using LocalStack to the application context</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Register the mapper using LocalStack to the application context</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Obtain the provider bean</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Obtain <code>DynamoDBService</code> for particular DynamoDB entity</td>
</tr>
</table>
</div>
<div class="listingblock secondary">
<div class="title">Java</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">Unresolved directive in dynamodb.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/dynamodb/DynamoDBServiceTest.java[tags=header]
Unresolved directive in dynamodb.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/dynamodb/DynamoDBServiceTest.java[tags=setup]
    @Test
    public void testSomething() {
        DynamoDBServiceProvider provider = ctx.getBean(DynamoDBServiceProvider.class);  <i class="conum" data-value="7"></i><b>(7)</b>
        DynamoDBService&lt;DynamoDBEntity&gt; s = provider.findOrCreate(DynamoDBEntity.class);<i class="conum" data-value="8"></i><b>(8)</b>

        // test code
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create an instance of <code>LocalStackContainer</code> with only DynamoDB support enabled</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Prepare the reference to the <code>ApplicationContext</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Create <code>AmazonDynamoDB</code> client using the LocalStack configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Register the client using LocalStack to the application context</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Register the mapper using LocalStack to the application context</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Close the application context after test execution</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Obtain the provider bean</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Obtain <code>DynamoDBService</code> for particular DynamoDB entity</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can obtain instances of declarative client from the context as well.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kinesis"><a class="anchor" href="#_kinesis"></a>1.3. Kinesis</h4>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Amazon Kinesis makes it easy to collect, process, and analyze real-time, streaming data so you can get timely insights and react quickly to new information.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>This library provides three approaches to work with Kinesis streams:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>High-level <a href="#_publishing_with_kinesisclient">Publishing with <code>@KinesisClient</code></a></p>
</li>
<li>
<p>High-level <a href="#_listening_with_kinesislistener">Listening with <code>@KinesisListener</code></a></p>
</li>
<li>
<p>Middle-level <a href="#_kinesis_service">Kinesis Service</a></p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_configuration"><a class="anchor" href="#_configuration"></a>Configuration</h5>
<div class="paragraph">
<p>By default, only <code>aws.kinesis.application.name</code> and <code>aws.kinesis.listener.stream</code> are required if you decide to use <code>@KinesisListener</code>.
Otherwise you need no configuration at all but some of the configuration may be useful for you.</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code class="language-yaml" data-lang="yaml">Unresolved directive in kinesis.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/resources/application-docs-kinesis.yml[]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>You can specify the default stream for <a href="https://agorapulse.github.io/micronaut-libraries/docs/javadoc/micronaut-aws-sdk/com/agorapulse/micronaut/aws/kinesis/KinesisService.html">KinesisService</a> and <code>@KinesisClient</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can define multiple configurations</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Each of the configuration can be access using <code>@Named('test') KinesisService</code> qualifier or you can define the configuration as <code>value</code> of <code>@KinesisClient('test')</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Application name is required for <code>@KinesisListner</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Optional id of the Kinesis worker (listener)</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Stream to listen is required for <code>@KinesisListener</code></td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>You can define multiple listeners configurations</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>The name of the configuration will be used as <code>value</code> of <code>@KinesisListener('test')</code></td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_publishing_with_kinesisclient"><a class="anchor" href="#_publishing_with_kinesisclient"></a>Publishing with <code>@KinesisClient</code></h5>
<div class="paragraph">
<p>If you place <code>com.agorapulse.micronaut.aws.kinesis.annotation.KinesisClient</code> annotation on the interface then methods
matching predefined pattern will be automatically implemented. Every method of <code>KinesisClient</code> puts new records into
the stream.</p>
</div>
<div class="paragraph">
<p>The following example shows many of available method signatures for publishing records:</p>
</div>
<div class="listingblock">
<div class="title">Publishing String Records</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code class="language-java" data-lang="java">Unresolved directive in kinesis.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/kinesis/DefaultClient.java[tags=header]
Unresolved directive in kinesis.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/kinesis/DefaultClient.java[tags=string]
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>@KinesisClient</code> annotation makes the interface a Kinesis client</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can put String into the stream with generated UUID as partition key</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>You can user predefined partition key</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>If the name of the argument does not contain word <code>parition</code> then <code>@PartitionKey</code> annotation must to be used</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>You can put String into the stream with predefined partition key and a sequence number</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>If the name of the sequence number argument does not contain word <code>sequence</code> then <code>@SequenceKey</code> annotation must to be used</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>The type of parition key and sequence number does not matter as the value will be always converted to string</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Publishing Byte Array Records</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code class="language-java" data-lang="java">Unresolved directive in kinesis.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/kinesis/DefaultClient.java[tags=header]
Unresolved directive in kinesis.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/kinesis/DefaultClient.java[tags=bytes]
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>@KinesisClient</code> annotation makes the interface a Kinesis client</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can put byte array into the stream, UUID as partition key will be generated</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>If the name of the argument does not contain word <code>parition</code> then <code>@PartitionKey</code> annotation must to be used</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>You can put several records wrapped into iterable of <code>PutRecordsRequestEntry</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>You can put several records wrapped into array of <code>PutRecordsRequestEntry</code></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>If the single argument is of type <code>PutRecordsRequestEntry</code> then <code>PutRecordsResult</code> object is returned from the method despite only single record has been published</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Publishing Plain Old Java Objects</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code class="language-java" data-lang="java">Unresolved directive in kinesis.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/kinesis/DefaultClient.java[tags=header]
Unresolved directive in kinesis.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/kinesis/DefaultClient.java[tags=pogo]
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>@KinesisClient</code> annotation makes the interface a Kinesis client</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can put any object into the stream, UUID as partition key will be generated, the objects will be serialized to JSON</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>You can put array of any objects into the stream, UUID as partition key will be generated for each record, each object will be serialized to JSON</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>You can put iterable of any objects into the stream, UUID as partition key will be generated for each record, each object will be serialized to JSON</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>You can put any object into the stream with predefined partition key, if the name of the argument does not contain word <code>parition</code> then <code>@PartitionKey</code> annotation must to be used</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Publishing Events</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code class="language-java" data-lang="java">Unresolved directive in kinesis.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/kinesis/DefaultClient.java[tags=header]
Unresolved directive in kinesis.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/kinesis/DefaultClient.java[tags=events]
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>@KinesisClient</code> annotation makes the interface a Kinesis client</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can put object implementing <code>Event</code> into the stream</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>You can put iterable of objects implementing <code>Event</code> into the stream</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>You can put array of objects implementing <code>Event</code> into the stream</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Without any parameters <code>@KinesisClient</code> publishes to default stream of the default configuration but you can change it using <code>@Stream</code> annotation on the method</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The return value of the method is <code>PutRecordResult</code> or <code>PutRecordsResult</code> for putting multiple records but it can be always
omitted and replaced with <code>void</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By default, <code>KinesisClient</code> publishes records into the default stream defined by <code>aws.kinesis.stream</code> property.
You can switch to different configuration by changing the <code>value</code> of the annotation such as <code>@KinesisClient("other")</code> or
by setting the <code>stream</code> property of the annotation such as <code>@KinesisClient(stream = "MyStream")</code>. You can change stream
used by particular method using <code>@Stream</code> annotation as mentioned above.</p>
</div>
</div>
<div class="sect4">
<h5 id="_listening_with_kinesislistener"><a class="anchor" href="#_listening_with_kinesislistener"></a>Listening with <code>@KinesisListener</code></h5>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Before you start implementing your service with <code>@KinesisListener</code> you may consider implementing a Lambda function
instead.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you place <code>com.agorapulse.micronaut.aws.kinesis.annotation.KinesisListener</code> annotation on the method in the bean
then the method will be triggered with the new records in the stream.</p>
</div>
<div class="paragraph">
<p>source,java,indent=0,options="nowrap"]
.Publishing Events</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Unresolved directive in kinesis.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/kinesis/KinesisListenerTester.java[tags=all]</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>@KinesisListener</code> method must be declared in a bean, e.g. <code>@Singleton</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can listen to just plain string records</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>You can listen to <code>Record</code> objects</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>You can listen to both string and <code>Record</code> objects</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>You can listen to objects implementing <code>Event</code> interface</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>You can listen to both <code>Event</code> and <code>Record</code> objects</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>You can listen to any object as long as it can be unmarshalled from the record payload</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can listen to different than default configuration by changing the <code>value</code> of the annotation such as <code>@KinesisListener("other")</code>.</p>
</div>
<div class="paragraph">
<p>Multiple methods in a single application can listen to the same configuration (stream). In that case, every method will be executed with the
incoming payload.</p>
</div>
</div>
<div class="sect4">
<h5 id="_kinesis_service"><a class="anchor" href="#_kinesis_service"></a>Kinesis Service</h5>
<div class="paragraph">
<p><code>KinesisService</code> provides middle-level API for creating, describing, and deleting streams. You can manage shards as well as read records
from particular shards.</p>
</div>
<div class="paragraph">
<p>Instance of <code>KinesisService</code> is created for the default Kinesis configuration and each stream configuration in <code>aws.kinesis.streams</code> map.
You should always use <code>@Named</code> qualifier when injecting <code>KinesisService</code> if you have more than one stream configuration present, e.g. <code>@Named("other") KinesisService otherService</code>.</p>
</div>
<div class="paragraph">
<p>Please, see <a href="https://agorapulse.github.io/micronaut-libraries/docs/javadoc/micronaut-aws-sdk/com/agorapulse/micronaut/aws/kinesis/KinesisService.html">KinesisService</a> for the full reference.</p>
</div>
</div>
<div class="sect4">
<h5 id="_testing_2"><a class="anchor" href="#_testing_2"></a>Testing</h5>
<div class="paragraph">
<p>You can very easily mock any of the interfaces and declarative services but if you need close-to-production
Kinesis integration works well with <a href="https://www.testcontainers.org/">Testcontainers</a> and <a href="https://localstack.cloud/">LocalStack</a>.</p>
</div>
<div class="paragraph">
<p>You need to add following dependencies into your build file:</p>
</div>
<div class="listingblock primary">
<div class="title">Gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code>compile group: 'org.testcontainers', name: 'localstack', version: '1.10.2'
compile group: 'org.testcontainers', name: 'spock', version: '1.10.2'</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Maven</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.testcontainers&lt;/groupId&gt;
    &lt;artifactId&gt;localstack&lt;/artifactId&gt;
    &lt;version&gt;1.10.2&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.testcontainers&lt;/groupId&gt;
    &lt;artifactId&gt;spock&lt;/artifactId&gt;
    &lt;version&gt;1.10.2&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you can setup your tests like this:</p>
</div>
<div class="listingblock primary">
<div class="title">Groovy</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">Unresolved directive in kinesis.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/kinesis/KinesisAnnotationsSpec.groovy[tags=testcontainers-header]

Unresolved directive in kinesis.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/kinesis/KinesisAnnotationsSpec.groovy[tags=testcontainers-setup]

Unresolved directive in kinesis.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/kinesis/KinesisAnnotationsSpec.groovy[tags=testcontainers-test]

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate the specification with <code>@Testcontainers</code> to let Spock manage the Testcontainers for you</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>@RestoreSystemProperties</code> will guarantee that system properties will be restore after the test</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Create an instance of <code>LocalStackContainer</code> with Kinesis and  DynamoDB (required by the listener) support enabled</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Prepare the reference to the <code>ApplicationContext</code>, <code>@AutoCleanup</code> guarantees closing the context after the tests</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Disable CBOR protocol for Kinesis (not supported by LocalStack/Kinesilite)</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Create <code>AmazonDynamoDB</code> client using the LocalStack configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Create <code>AmazonKinesis</code> client using the LocalStack configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Prepare the application context with required properties and service LocalStack</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>You can obtain instance of <code>KinesisService</code> from the context</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>You can obtain instance of declarative listener from the context</td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b>11</b></td>
<td>You can obtain instance of declarative client from the context</td>
</tr>
</table>
</div>
<div class="listingblock secondary">
<div class="title">Java</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">Unresolved directive in kinesis.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/kinesis/KinesisTest.java[tags=testcontainers-header]

Unresolved directive in kinesis.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/kinesis/KinesisTest.java[tags=testcontainers-setup]

Unresolved directive in kinesis.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/kinesis/KinesisTest.java[tags=testcontainers-test]

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Prepare the reference to the <code>ApplicationContext</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Create an instance of <code>LocalStackContainer</code> with Kinesis and  DynamoDB (required by the listener) support enabled</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Disable CBOR protocol for Kinesis (not supported by LocalStack/Kinesilite)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Create <code>AmazonDynamoDB</code> client using the LocalStack configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Create <code>AmazonKinesis</code> client using the LocalStack configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Prepare required properties</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Prepare the application context with required properties and service LocalStack</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Reset CBOR protocol settings after the test</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Close the application context after the test</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>You can obtain instance of <code>KinesisService</code> from the context</td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b>11</b></td>
<td>You can obtain instance of declarative listener from the context</td>
</tr>
<tr>
<td><i class="conum" data-value="12"></i><b>12</b></td>
<td>You can obtain instance of declarative client from the context</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_simple_storage_service_s3"><a class="anchor" href="#_simple_storage_service_s3"></a>1.4. Simple Storage Service (S3)</h4>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Amazon Simple Storage Service (Amazon S3) is an object storage service that offers industry-leading scalability, data availability, security, and performance.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>This library provides basic support for Amazon S3 using <a href="#_simple_storage_service">Simple Storage Service</a></p>
</div>
<div class="sect4">
<h5 id="_configuration_2"><a class="anchor" href="#_configuration_2"></a>Configuration</h5>
<div class="paragraph">
<p>You can store the name of the bucket in the configuration using <code>aws.s3.bucket</code> property. You can create additional configurations
by providing 'aws.s3.buckets' configuration map.</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code class="language-yaml" data-lang="yaml">Unresolved directive in s3.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/resources/application-docs-s3.yml[]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>You can define default bucket for the service</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can define multiple configurations</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Each of the configuration can be access using <code>@Named('test') SimpleStorageService</code> qualifier</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_simple_storage_service"><a class="anchor" href="#_simple_storage_service"></a>Simple Storage Service</h5>
<div class="paragraph">
<p><code>SimpleStorageService</code> provides middle-level API for managing buckets and uploading and downloading files.</p>
</div>
<div class="paragraph">
<p>Instance of <code>SimpleStorageService</code> is created for the default S3 configuration and each bucket configuration in <code>aws.s3.buckets</code> map.
You should always use <code>@Named</code> qualifier when injecting <code>SimpleStorageService</code> if you have more than one bucket configuration present, e.g. <code>@Named("test") SimpleStorageService service</code>.</p>
</div>
<div class="paragraph">
<p>Following example shows some of the most common use cases for working with S3 buckets.</p>
</div>
<div class="listingblock">
<div class="title">Creating Bucket</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code class="language-java" data-lang="java">Unresolved directive in s3.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/s3/SimpleStorageServiceTest.java[tags=create-bucket]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create new bucket of given name</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The bucket is present within the list of all bucket names</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Upload File</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code class="language-java" data-lang="java">Unresolved directive in s3.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/s3/SimpleStorageServiceTest.java[tags=store-file]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Upload file</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>File is uploaded</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>File is present in the summaries of all files</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Upload from <code>InputStream</code></div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code class="language-java" data-lang="java">Unresolved directive in s3.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/s3/SimpleStorageServiceTest.java[tags=store-input-stream]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Upload data from stream</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Stream is uploaded</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Generate URL</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code class="language-java" data-lang="java">Unresolved directive in s3.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/s3/SimpleStorageServiceTest.java[tags=generate-url]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Generate presigned URL</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Downloaded content corresponds with the expected content</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Download File</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code class="language-java" data-lang="java">Unresolved directive in s3.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/s3/SimpleStorageServiceTest.java[tags=download-file]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Prepare a destination file</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Download the file locally</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Delete File</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code class="language-java" data-lang="java">Unresolved directive in s3.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/s3/SimpleStorageServiceTest.java[tags=delete-file]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Delete file</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The file is no longer present</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Delete Bucket</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code class="language-java" data-lang="java">Unresolved directive in s3.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/s3/SimpleStorageServiceTest.java[tags=delete-bucket]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Delete bucket</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The Bucket is no longer present</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Please, see <a href="https://agorapulse.github.io/micronaut-libraries/docs/javadoc/micronaut-aws-sdk/com/agorapulse/micronaut/aws/s3/SimpleStorageService.html">SimpleStorageService</a> for the full reference.</p>
</div>
</div>
<div class="sect4">
<h5 id="_testing_3"><a class="anchor" href="#_testing_3"></a>Testing</h5>
<div class="paragraph">
<p>You can very easily mock the <code>SimpleStorageService</code> but if you need close-to-production
S3 integration works well with <a href="https://www.testcontainers.org/">Testcontainers</a> and <a href="https://localstack.cloud/">LocalStack</a>.</p>
</div>
<div class="paragraph">
<p>You need to add following dependencies into your build file:</p>
</div>
<div class="listingblock primary">
<div class="title">Gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code>compile group: 'org.testcontainers', name: 'localstack', version: '1.10.2'
compile group: 'org.testcontainers', name: 'spock', version: '1.10.2'</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Maven</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.testcontainers&lt;/groupId&gt;
    &lt;artifactId&gt;localstack&lt;/artifactId&gt;
    &lt;version&gt;1.10.2&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.testcontainers&lt;/groupId&gt;
    &lt;artifactId&gt;spock&lt;/artifactId&gt;
    &lt;version&gt;1.10.2&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you can setup your tests like this:</p>
</div>
<div class="listingblock primary">
<div class="title">Groovy</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">Unresolved directive in s3.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/s3/SimpleStorageServiceSpec.groovy[tags=header]
Unresolved directive in s3.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/s3/SimpleStorageServiceSpec.groovy[tags=setup]

    // test methods

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate the specification with <code>@Testcontainers</code> to let Spock manage the Testcontainers for you</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Prepare the reference to the <code>ApplicationContext</code>, <code>@AutoCleanup</code> guarantees closing the context after the tests</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Create an instance of <code>LocalStackContainer</code> with S3 support enabled</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Create <code>AmazonS3</code> client using the LocalStack configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Set the default bucket</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Register <code>AmazonS3</code> service running against LocalStack</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>You can obtain instance of <code>SimpleStorageService</code> from the context</td>
</tr>
</table>
</div>
<div class="listingblock secondary">
<div class="title">Java</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">Unresolved directive in s3.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/s3/SimpleStorageServiceTest.java[tags=header]

Unresolved directive in s3.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/s3/SimpleStorageServiceTest.java[tags=setup]

    // test methods

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create an instance of <code>LocalStackContainer</code> with Kinesis and  DynamoDB (required by the listener) support enabled</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Prepare the reference to the <code>ApplicationContext</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Create <code>AmazonS3</code> client using the LocalStack configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Register <code>AmazonS3</code> service running against LocalStack</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Don&#8217;t forget to close <code>ApplicationContext</code></td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_simple_email_service_ses"><a class="anchor" href="#_simple_email_service_ses"></a>1.5. Simple Email Service (SES)</h4>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Amazon Simple Email Service (Amazon SES) is a cloud-based email sending service designed to help digital marketers and application developers send marketing, notification, and transactional emails. It is a reliable, cost-effective service for businesses of all sizes that use email to keep in contact with their customers.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>This library provides basic support for Amazon SES using <a href="#_simple_email_service">Simple Email Service</a></p>
</div>
<div class="sect4">
<h5 id="_simple_email_service"><a class="anchor" href="#_simple_email_service"></a>Simple Email Service</h5>
<div class="paragraph">
<p><code>SimpleEmailService</code> provides DSL for creating and sending simple emails with attachments. As the other services,
it uses default credentials chain to obtain the credentials.</p>
</div>
<div class="paragraph">
<p>Following example shows how to send an email with attachment.</p>
</div>
<div class="listingblock primary">
<div class="title">Groovy</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code class="language-groovy" data-lang="groovy">Unresolved directive in ses.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/ses/SendEmailSpec.groovy[]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Start building an email</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Define subject of the email</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Define the from address</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Define one or more recipients</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Define HTML body (alternatively you can declare plain text body as well)</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Build an attachment</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Define the location of the file to be sent</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Define the file name (optional - deduced from the file)</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Define the mime type (usually optional - deduced from the file)</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>Define the description of the file (optional)</td>
</tr>
</table>
</div>
<div class="listingblock secondary">
<div class="title">Java</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code class="language-java" data-lang="java">Unresolved directive in ses.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/ses/SendEmailTest.java[]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Start building an email</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Define subject of the email</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Define the from address</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Define one or more recipients</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Define HTML body (alternatively you can declare plain text body as well)</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Build an attachment</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Define the location of the file to be sent</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Define the file name (optional - deduced from the file)</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Define the mime type (usually optional - deduced from the file)</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>Define the description of the file (optional)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Please, see <a href="https://agorapulse.github.io/micronaut-libraries/docs/javadoc/micronaut-aws-sdk/com/agorapulse/micronaut/aws/ses/SimpleEmailService.html">SimpleEmailService</a> for the full reference.</p>
</div>
</div>
<div class="sect4">
<h5 id="_testing_4"><a class="anchor" href="#_testing_4"></a>Testing</h5>
<div class="paragraph">
<p>It is recommended just to mock the <code>SimpleEmailService</code> in your tests as it only contains single abstract method.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_simple_notification_service_sns"><a class="anchor" href="#_simple_notification_service_sns"></a>1.6. Simple Notification Service (SNS)</h4>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Amazon Simple Notification Service (SNS) is a highly available, durable, secure, fully managed pub/sub messaging service that enables you to decouple microservices, distributed systems, and serverless applications.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>This library provides two approaches to work with Simple Notification Service topics:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>High-level <a href="#_publishing_with_notificationclient">Publishing with <code>@NotificationClient</code></a></p>
</li>
<li>
<p>Middle-level <a href="#_simple_notification_service">Simple Notification Service</a></p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_configuration_3"><a class="anchor" href="#_configuration_3"></a>Configuration</h5>
<div class="paragraph">
<p>No configuration is required but some of the configuration properties may be useful for you.</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code class="language-yaml" data-lang="yaml">Unresolved directive in sns.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/resources/application-docs-sns.yml[]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>You can specify the default topic for <a href="https://agorapulse.github.io/micronaut-libraries/docs/javadoc/micronaut-aws-sdk/com/agorapulse/micronaut/aws/sns/SimpleNotificationService.html">SimpleNotificationService</a> and <code>@NotificationClient</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Amazon Resource Name for the iOS application mobile push</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Amazon Resource Name for the Android application mobile push</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Amazon Resource Name for the Amazon application mobile push</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>You can define multiple configurations</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Each of the configuration can be access using <code>@Named('test') SimpleNotificationService</code> qualifier or you can define the configuration as <code>value</code> of <code>@NotificationClient('test')</code></td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_publishing_with_notificationclient"><a class="anchor" href="#_publishing_with_notificationclient"></a>Publishing with <code>@NotificationClient</code></h5>
<div class="paragraph">
<p>If you place <code>com.agorapulse.micronaut.aws.sns.annotation.NotificationClient</code> annotation on the interface then methods
matching predefined pattern will be automatically implemented. Methods containing word <code>sms</code> will send text messages.
Other methods of <code>NotificationClient</code> will publish new messages into the topic.</p>
</div>
<div class="paragraph">
<p>The following example shows many of available method signatures for publishing records:</p>
</div>
<div class="listingblock">
<div class="title">Publishing String Records</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code class="language-java" data-lang="java">Unresolved directive in sns.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/sns/DefaultClient.java[]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>@NotificationClient</code> annotation makes the interface a SNS client</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can specify to which topic is the message published using <code>@Topic</code> annotation</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>You can publish any object which can be converted into JSON.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>You can add additional subject to published message (only useful for few protocols, e.g. email)</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>You can publish a string message</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>You can send SMS using the word <code>SMS</code> in the name of the method. One argument must be phone number and its name must contain the word <code>number</code></td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>You can provide additional attributes for the SMS message</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The return value of the methods is message id returned by AWS.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By default, <code>NotificationClient</code> publishes messages into the default topic defined by <code>aws.sns.topic</code> property.
You can switch to different configuration by changing the <code>value</code> of the annotation such as <code>@NotificationClient("other")</code> or
by setting the <code>topic</code> property of the annotation such as <code>@NotificationClient(topic = "SomeTopic")</code>. You can change topic
used by particular method using <code>@Topic</code> annotation as mentioned above.</p>
</div>
</div>
<div class="sect4">
<h5 id="_simple_notification_service"><a class="anchor" href="#_simple_notification_service"></a>Simple Notification Service</h5>
<div class="paragraph">
<p><code>SimpleNotificationService</code> provides middle-level API for creating, describing, and deleting topics. You can manage applications, endpoints and devices.
You can send messages and notifications.</p>
</div>
<div class="paragraph">
<p>Instance of <code>SimpleNotificationService</code> is created for the default SNS configuration and each topics configuration in <code>aws.sns.topics</code> map.
You should always use <code>@Named</code> qualifier when injecting <code>SimpleNotificationService</code> if you have more than one topic configuration present, e.g. <code>@Named("other") SimpleNotificationService otherService</code>.</p>
</div>
<div class="paragraph">
<p>Following example shows some of the most common use cases for working with Amazon SNS.</p>
</div>
<div class="sect5">
<h6 id="_working_with_topics"><a class="anchor" href="#_working_with_topics"></a>Working with Topics</h6>
<div class="listingblock">
<div class="title">Creating Topic</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code class="language-java" data-lang="java">Unresolved directive in sns.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/sns/SimpleNotificationServiceTest.java[tags=new-topic]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create new topic of given name</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The topic is present within the list of all topics' names</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Subscribe to Topic</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code class="language-java" data-lang="java">Unresolved directive in sns.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/sns/SimpleNotificationServiceTest.java[tags=subscription]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Subscribe to the topic with an email (there are more variants of this method to subscribe to most common protocols such as HTTP(S) endpoints, SQS, &#8230;&#8203;)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Publish message to the topic</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Use the subscription ARN to unsubscribe from the topic</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Delete Topic</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code class="language-java" data-lang="java">Unresolved directive in sns.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/sns/SimpleNotificationServiceTest.java[tags=delete-topic]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Delete the topic</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The topic is no longer present within the list of all topics' names</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_working_with_applications"><a class="anchor" href="#_working_with_applications"></a>Working with Applications</h6>
<div class="listingblock">
<div class="title">Working with Applications</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code class="language-java" data-lang="java">Unresolved directive in sns.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/sns/SimpleNotificationServiceTest.java[tags=applications]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create new Android application (more platforms available)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Register Android device (more platforms available)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Send Android notification (more platforms available)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Validate Android device</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Unregister device</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_sending_sms"><a class="anchor" href="#_sending_sms"></a>Sending SMS</h6>
<div class="listingblock">
<div class="title">Sending SMS</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code class="language-java" data-lang="java">Unresolved directive in sns.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/sns/SimpleNotificationServiceTest.java[tags=sms]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Send a message to the phone number</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Please, see <a href="https://agorapulse.github.io/micronaut-libraries/docs/javadoc/micronaut-aws-sdk/com/agorapulse/micronaut/aws/sns/SimpleNotificationService.html">SimpleNotificationService</a> for the full reference.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_testing_5"><a class="anchor" href="#_testing_5"></a>Testing</h5>
<div class="paragraph">
<p>You can very easily mock any of the interfaces and declarative services but if you need close-to-production
SNS integration works well with <a href="https://www.testcontainers.org/">Testcontainers</a> and <a href="https://localstack.cloud/">LocalStack</a>.</p>
</div>
<div class="paragraph">
<p>You need to add following dependencies into your build file:</p>
</div>
<div class="listingblock primary">
<div class="title">Gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code>compile group: 'org.testcontainers', name: 'localstack', version: '1.10.2'
compile group: 'org.testcontainers', name: 'spock', version: '1.10.2'</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Maven</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.testcontainers&lt;/groupId&gt;
    &lt;artifactId&gt;localstack&lt;/artifactId&gt;
    &lt;version&gt;1.10.2&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.testcontainers&lt;/groupId&gt;
    &lt;artifactId&gt;spock&lt;/artifactId&gt;
    &lt;version&gt;1.10.2&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you can setup your tests like this:</p>
</div>
<div class="listingblock primary">
<div class="title">Groovy</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">Unresolved directive in sns.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/sns/SimpleNotificationServiceSpec.groovy[tags=testcontainers-header]

Unresolved directive in sns.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/sns/SimpleNotificationServiceSpec.groovy[tags=testcontainers-fields]

Unresolved directive in sns.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/sns/SimpleNotificationServiceSpec.groovy[tags=testcontainers-setup]

    // tests

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate the specification with <code>@Testcontainers</code> to let Spock manage the Testcontainers for you</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Create an instance of <code>LocalStackContainer</code> with SNS support enabled</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Prepare the reference to the <code>ApplicationContext</code>, <code>@AutoCleanup</code> guarantees closing the context after the tests</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Create <code>AmazonSNS</code> client using the LocalStack configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Prepare the application context with required properties and service using LocalStack</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>You can obtain instance of <code>SimpleNotificationService</code> from the context</td>
</tr>
</table>
</div>
<div class="listingblock secondary">
<div class="title">Java</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">class SimpleNotificationServiceTest {

Unresolved directive in sns.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/sns/SimpleNotificationServiceTest.java[tags=testcontainers-setup]

    // tests

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Prepare the reference to the <code>ApplicationContext</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Create an instance of <code>LocalStackContainer</code> with SNS support enabled</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Create <code>AmazonSNS</code> client using the LocalStack configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Prepare required properties</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Prepare the application context with required properties and service LocalStack</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Close the application context after the test</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_simple_queue_service_sqs"><a class="anchor" href="#_simple_queue_service_sqs"></a>1.7. Simple Queue Service (SQS)</h4>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Amazon Simple Queue Service (SQS) is a fully managed message queuing service that enables you to decouple and scale microservices, distributed systems, and serverless applications. SQS eliminates the complexity and overhead associated with managing and operating message oriented middleware, and empowers developers to focus on differentiating work.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>This library provides two approaches to work with Simple Queue Service queues:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>High-level <a href="#_publishing_with_queueclient">Publishing with <code>@QueueClient</code></a></p>
</li>
<li>
<p>Middle-level <a href="#_simple_queue_service">Simple Queue Service</a></p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_configuration_4"><a class="anchor" href="#_configuration_4"></a>Configuration</h5>
<div class="paragraph">
<p>No configuration is required but some of the configuration properties may be useful for you.</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code class="language-yaml" data-lang="yaml">Unresolved directive in sqs.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/resources/application-docs-sqs.yml[]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Queue prefix is prepended to every queue name (may be useful for local development)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Whether to create any missing queue automatically (default <code>false</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Whether to first fetch all queues and set up queue to url cache first time the service is prompted for the queue URL (default <code>false</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>You can specify the default topic for <a href="https://agorapulse.github.io/micronaut-libraries/docs/javadoc/micronaut-aws-sdk/com/agorapulse/micronaut/aws/sqs/SimpleQueueService.html">SimpleQueueService</a> and <code>@QueueClient</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Whether the newly created queues are supposed to be <a href="https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/FIFO-queues.html">FIFO queues</a> (default <code>false</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>The length of time, in seconds, for which the delivery of all messages in the queue is delayed. Valid values: An integer from <code>0</code> to <code>900</code> (15 minutes). Default: <code>0</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>The length of time, in seconds, for which Amazon SQS retains a message. Valid values: An integer representing seconds, from <code>60</code> (1 minute) to <code>1,209,600</code> (14 days). Default: <code>345,600</code> (4 days).</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>The limit of how many bytes a message can contain before Amazon SQS rejects it. Valid values: An integer from <code>1,024</code> bytes (1 KiB) up to <code>262,144</code> bytes (256 KiB). Default: <code>262,144</code> (256 KiB).</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>The visibility timeout for the queue, in seconds. Valid values: an integer from <code>0</code> to <code>43,200</code> (12 hours). Default: <code>30</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>You can define multiple configurations</td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b>11</b></td>
<td>Each of the configuration can be access using <code>@Named('test') SimpleNotificationService</code> qualifier or you can define the configuration as <code>value</code> of <code>@NotificationClient('test')</code></td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_publishing_with_queueclient"><a class="anchor" href="#_publishing_with_queueclient"></a>Publishing with <code>@QueueClient</code></h5>
<div class="paragraph">
<p>If you place <code>com.agorapulse.micronaut.aws.sqs.annotation.QueueClient</code> annotation on the interface then methods
matching predefined pattern will be automatically implemented. Methods containing word <code>delete</code> will delete queue messages.
Other methods of <code>QueueClient</code> will publish new records into the queue.</p>
</div>
<div class="paragraph">
<p>The following example shows many of available method signatures for publishing records:</p>
</div>
<div class="listingblock">
<div class="title">Publishing String Records</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code class="language-java" data-lang="java">Unresolved directive in sqs.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/sqs/DefaultClient.java[]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>@QueueClient</code> annotation makes the interface a SQS client</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can specify to which queue is the message published using <code>@Queue</code> annotation, you can also specify the <code>group</code> for FIFO queues</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>You can publish any record object which can be converted into JSON.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>You can publish a byte array record</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>You can publish a string record</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>You can publish a string with custom delay</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>You can publish a string with custom FIFO queue group</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>You can publish a string with custom delay and FIFO queue group</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>You can delete published message using the message ID if the</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The return value of the publishing methods is message id returned by AWS.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By default, <code>QueueClient</code> publishes recoreds into the default queue defined by <code>aws.sns.queue</code> property.
You can switch to different configuration by changing the <code>value</code> of the annotation such as <code>@QueueClient("other")</code> or
by setting the <code>queue</code> property of the annotation such as <code>@QueueClient(queue = "SomeQueue")</code>. You can change queue
used by particular method using <code>@Queue</code> annotation as mentioned above.</p>
</div>
</div>
<div class="sect4">
<h5 id="_simple_queue_service"><a class="anchor" href="#_simple_queue_service"></a>Simple Queue Service</h5>
<div class="paragraph">
<p><code>SimpleQueuenService</code> provides middle-level API for creating, describing, and deleting queues. It allows to publish, receive and delete records.</p>
</div>
<div class="paragraph">
<p>Instance of <code>SimpleQueueService</code> is created for the default SQS configuration and each queue configuration in <code>aws.sqs.queues</code> map.
You should always use <code>@Named</code> qualifier when injecting <code>SimpleQueueService</code> if you have more than one topic configuration present, e.g. <code>@Named("other") SimpleQueueService otherService</code>.</p>
</div>
<div class="paragraph">
<p>Following example shows some of the most common use cases for working with Amazon SQS.</p>
</div>
<div class="listingblock">
<div class="title">Creating Queue</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code class="language-java" data-lang="java">Unresolved directive in sqs.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/sqs/SimpleQueueServiceTest.java[tags=new-queue]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create new queue of given name</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The queue URL is present within the list of all queues' URLs</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Describing Queue Attributes</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code class="language-java" data-lang="java">Unresolved directive in sqs.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/sqs/SimpleQueueServiceTest.java[tags=describe-queue]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Fetch queue&#8217;s attributes</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can read the queue&#8217;s attributes from the map</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Delete Queue</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code class="language-java" data-lang="java">Unresolved directive in sqs.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/sqs/SimpleQueueServiceTest.java[tags=delete-queue]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Delete queue</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The queue URL is no longer present within the list of all queues' URLs</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Working with Messages</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code class="language-java" data-lang="java">Unresolved directive in sqs.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/sqs/SimpleQueueServiceTest.java[tags=messages]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Send a message</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Receive messages from the queue (in another application)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Read message body</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Developers are responsible to delete the message from the queue themselves</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Try to use AWS Lambda functions triggered by SQS messages to handle incoming SQS messages instead of implementing
complex message handling logic yourselves.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Please, see <a href="https://agorapulse.github.io/micronaut-libraries/docs/javadoc/micronaut-aws-sdk/com/agorapulse/micronaut/aws/sqs/SimpleQueueService.html">SimpleQueueService</a> for the full reference.</p>
</div>
</div>
<div class="sect4">
<h5 id="_testing_6"><a class="anchor" href="#_testing_6"></a>Testing</h5>
<div class="paragraph">
<p>You can very easily mock any of the interfaces and declarative services but if you need close-to-production
SQS integration works well with <a href="https://www.testcontainers.org/">Testcontainers</a> and <a href="https://localstack.cloud/">LocalStack</a>.</p>
</div>
<div class="paragraph">
<p>You need to add following dependencies into your build file:</p>
</div>
<div class="listingblock primary">
<div class="title">Gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code>compile group: 'org.testcontainers', name: 'localstack', version: '1.10.2'
compile group: 'org.testcontainers', name: 'spock', version: '1.10.2'</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Maven</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.testcontainers&lt;/groupId&gt;
    &lt;artifactId&gt;localstack&lt;/artifactId&gt;
    &lt;version&gt;1.10.2&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.testcontainers&lt;/groupId&gt;
    &lt;artifactId&gt;spock&lt;/artifactId&gt;
    &lt;version&gt;1.10.2&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you can setup your tests like this:</p>
</div>
<div class="listingblock primary">
<div class="title">Groovy</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">Unresolved directive in sqs.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/sqs/SimpleQueueServiceSpec.groovy[tags=testcontainers-header]

Unresolved directive in sqs.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/sqs/SimpleQueueServiceSpec.groovy[tags=testcontainers-fields]

Unresolved directive in sqs.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/sqs/SimpleQueueServiceSpec.groovy[tags=testcontainers-setup]

    // tests

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate the specification with <code>@Testcontainers</code> to let Spock manage the Testcontainers for you</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>@RestoreSystemProperties</code> will guarantee that system properties will be restore after the test</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Create an instance of <code>LocalStackContainer</code> with SQS support enabled</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Prepare the reference to the <code>ApplicationContext</code>, <code>@AutoCleanup</code> guarantees closing the context after the tests</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Disable CBOR protocol for SQS (not supported by the mock implementation)</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Create <code>AmazonSQS</code> client using the LocalStack configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Prepare the application context with required properties and service using LocalStack</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>You can obtain instance of <code>SimpleQueueService</code> from the context</td>
</tr>
</table>
</div>
<div class="listingblock secondary">
<div class="title">Java</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">class SimpleNotificationServiceTest {

Unresolved directive in sqs.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/sqs/SimpleQueueServiceTest.java[tags=testcontainers-setup]

    // tests

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Prepare the reference to the <code>ApplicationContext</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Create an instance of <code>LocalStackContainer</code> with SQS support enabled</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Disable CBOR protocol for SQS (not supported by the mock implementation)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Create <code>AmazonSQS</code> client using the LocalStack configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Prepare required properties</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Prepare the application context with required properties and service LocalStack</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Close the application context after the test</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_security_token_service_sts"><a class="anchor" href="#_security_token_service_sts"></a>1.8. Security Token Service (STS)</h4>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>The AWS Security Token Service (STS) is a web service that enables you to request temporary, limited-privilege credentials for AWS Identity and Access Management (IAM) users or for users that you authenticate (federated users).</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>This library provides basic support for Amazon STS using <a href="#_security_token_service">Security Token Service</a></p>
</div>
<div class="sect4">
<h5 id="_security_token_service"><a class="anchor" href="#_security_token_service"></a>Security Token Service</h5>
<div class="paragraph">
<p><code>SecurityTokenService</code> provides only one method (with multiple variations) to create credentials
which assumes usage of a certain IAM role.</p>
</div>
<div class="paragraph">
<p>Following example shows how to create credentials for assumed role.</p>
</div>
<div class="listingblock primary">
<div class="title">Assume Role</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code class="language-groovy" data-lang="groovy">Unresolved directive in sts.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/sts/SecurityTokenServiceSpec.groovy[tag=usage]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please, see <a href="https://agorapulse.github.io/micronaut-libraries/docs/javadoc/micronaut-aws-sdk/com/agorapulse/micronaut/aws/sts/SecurityTokenService.html">SecurityTokenService</a> for the full reference.</p>
</div>
</div>
<div class="sect4">
<h5 id="_testing_7"><a class="anchor" href="#_testing_7"></a>Testing</h5>
<div class="paragraph">
<p>It is recommended just to mock the <code>SecurityTokenService</code> in your tests as it only contains single abstract method.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_websockets_for_api_gateway"><a class="anchor" href="#_websockets_for_api_gateway"></a>1.9. WebSockets for API Gateway</h4>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>In a WebSocket API, the client and the server can both send messages to each other at any time. Backend servers can easily push data to connected users and devices, avoiding the need to implement complex polling mechanisms.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>This library provides components for easy handling of incoming WebSocket proxied events as well as for sending
messages back to the clients</p>
</div>
<div class="sect4">
<h5 id="_configuration_5"><a class="anchor" href="#_configuration_5"></a>Configuration</h5>
<div class="paragraph">
<p>No configuration is required but some of the configuration properties may be useful for you.</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code class="language-yaml" data-lang="yaml">Unresolved directive in websockets.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/resources/application-docs-websockets.yml[]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>You can specify the default connections URL for <a href="https://agorapulse.github.io/micronaut-libraries/docs/javadoc/micronaut-aws-sdk/com/agorapulse/micronaut/aws/apigateway/ws/MessageSender.html">MessageSender</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>If you are creating Java functions don&#8217;t forget to specify the function&#8217;s name for deployments</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<a href="https://agorapulse.github.io/micronaut-libraries/docs/javadoc/micronaut-aws-sdk/com/agorapulse/micronaut/aws/apigateway/ws/MessageSender.html">MessageSender</a> bean
is only present in the context if <code>aws.websocket.connectins.url</code> configuration property is present.Use <a href="https://agorapulse.github.io/micronaut-libraries/docs/javadoc/micronaut-aws-sdk/com/agorapulse/micronaut/aws/apigateway/ws/MessageSenderFactory.html">MessageSenderFactory</a>
If you want to create <a href="https://agorapulse.github.io/micronaut-libraries/docs/javadoc/micronaut-aws-sdk/com/agorapulse/micronaut/aws/apigateway/ws/MessageSender.html">MessageSender</a>
manually using URL which is not predefined.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_usage"><a class="anchor" href="#_usage"></a>Usage</h5>
<div class="paragraph">
<p><a href="https://github.com/aws/aws-lambda-java-libs/tree/master/aws-lambda-java-events">AWS SDK Lambda Events library</a> does not contain the events dedicated to WebSocket API Gateway yet.
You can use <a href="https://agorapulse.github.io/micronaut-libraries/docs/javadoc/micronaut-aws-sdk/com/agorapulse/micronaut/aws/apigateway/ws/WebSocketConnectionRequest.html">WebSocketConnectionRequest</a>
as an argument to function handling connection and disconnection of the WebSocket and <a href="https://agorapulse.github.io/micronaut-libraries/docs/javadoc/micronaut-aws-sdk/com/agorapulse/micronaut/aws/apigateway/ws/WebSocketRequest.html">WebSocketRequest</a> for handling
incoming messages.</p>
</div>
<div class="paragraph">
<p><strong>The following examples assume that you have created function using <code>mn create-function</code> command.</strong></p>
</div>
<div class="paragraph">
<p>The simplest example is a echo method can be used to handle all the incoming events and reply to the incoming messages and also
publishes to SNS:</p>
</div>
<div class="listingblock primary">
<div class="title">Groovy</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">Unresolved directive in websockets.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/apigateway/ws/LambdaEchoFunction.groovy[]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Factory to create <code>MessageSender</code> if we want to reply to the message immediately</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Service to publish to SNS to forward the message</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><a href="https://agorapulse.github.io/micronaut-libraries/docs/javadoc/micronaut-aws-sdk/com/agorapulse/micronaut/aws/apigateway/ws/WebSocketRequest.html">WebSocketRequest</a> can handle any incoming event</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Create <a href="https://agorapulse.github.io/micronaut-libraries/docs/javadoc/micronaut-aws-sdk/com/agorapulse/micronaut/aws/apigateway/ws/MessageSender.html">MessageSender</a> for current client</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td><code>connectionId</code> is unique identifier of the client</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td><code>CONNECT</code> event signals new client has been connected</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td><code>MESSAGE</code> event signals new incoming message</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td><code>DISCONNECT</code> event signals client has been disconnected</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>The method must always return <code>WebSocketResponse.OK</code> to signal success</td>
</tr>
</table>
</div>
<div class="listingblock secondary">
<div class="title">Java</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">Unresolved directive in websockets.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/apigateway/ws/LambdaEchoJava.java[]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Factory to create <code>MessageSender</code> if we want to reply to the message immediately</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Service to publish to SNS to forward the message</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><a href="https://agorapulse.github.io/micronaut-libraries/docs/javadoc/micronaut-aws-sdk/com/agorapulse/micronaut/aws/apigateway/ws/WebSocketRequest.html">WebSocketRequest</a> can handle any incoming event</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Create <a href="https://agorapulse.github.io/micronaut-libraries/docs/javadoc/micronaut-aws-sdk/com/agorapulse/micronaut/aws/apigateway/ws/MessageSender.html">MessageSender</a> for current client</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td><code>connectionId</code> is unique identifier of the client</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td><code>CONNECT</code> event signals new client has been connected</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td><code>MESSAGE</code> event signals new incoming message</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td><code>DISCONNECT</code> event signals client has been disconnected</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>The method must always return <code>WebSocketResponse.OK</code> to signal success</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once the function is ready you can deploy the function to AWS Lambda and setup the new API Gateway with WebSocket API</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/new-websocket-api.png" alt="new websocket api">
</div>
<div class="title">Figure 1. Create new WebSocket API</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/new-websocket-route.png" alt="new websocket route">
</div>
<div class="title">Figure 2. Create WebSocket API Routes</div>
</div>
<div class="paragraph">
<p>Another example is a simple AWS Lambda function to react to any of events supported by AWS Lambda and push to WebSocket clients.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
There is no support for routing at the moment, but you can get the matched route from
<code>event.requestContext.routeKey</code>.
</td>
</tr>
</table>
</div>
<div class="listingblock primary">
<div class="title">Groovy</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">Unresolved directive in websockets.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/apigateway/ws/NotificationFunction.groovy[]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>MessageSender</code> can be injected if you specify <code>aws.websocket.connnections.url</code> configuration property</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can for example react on records published into Simple Notification Service</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Send message to the client (in previous example the <code>connectionId</code> was set to the <code>subject</code> of the SNS record)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>If the client is already disconnected then <code>AmazonClientException</code> may occur</td>
</tr>
</table>
</div>
<div class="listingblock secondary">
<div class="title">Java</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">Unresolved directive in websockets.adoc - include::/Users/ladin/development/projects/agorapulse/micronaut-libraries/subprojects/micronaut-aws-sdk/src/test/groovy/com/agorapulse/micronaut/aws/apigateway/ws/NotificationHandler.java[]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>MessageSender</code> can be injected if you specify <code>aws.websocket.connnections.url</code> configuration property</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can for example react on records published into Simple Notification Service</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Send message to the client (in previous example the <code>connectionId</code> was set to the <code>subject</code> of the SNS record)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>If the client is already disconnected then <code>AmazonClientException</code> may occur</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you want to publish to the WebSockets using <a href="https://agorapulse.github.io/micronaut-libraries/docs/javadoc/micronaut-aws-sdk/com/agorapulse/micronaut/aws/apigateway/ws/MessageSender.html">MessageSender</a>
your Lambda function&#8217;s role must have following permissions (preferably constrained just your API resource):</p>
</div>
<div class="listingblock">
<div class="title">ExecuteApiFullAccess Policy</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-JSON" data-lang="JSON">{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "VisualEditor0",
            "Effect": "Allow",
            "Action": "execute-api:*",
            "Resource": "*"
        }
    ]
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_testing_8"><a class="anchor" href="#_testing_8"></a>Testing</h5>
<div class="paragraph">
<p>You can very easily mock any of the interfaces. Create request event manually and follow
<a href="http://guides.micronaut.io/micronaut-function-aws-lambda/guide/index.html#functiontests">the guide to test functions with Micronaut</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_micronaut_for_api_gateway_proxy"><a class="anchor" href="#_micronaut_for_api_gateway_proxy"></a>2. Micronaut for API Gateway Proxy</h3>
<div class="paragraph">
<p>API Gateway Lambda Proxy support for Micronaut has been replaced by an official suport
<a href="https://micronaut-projects.github.io/micronaut-aws/latest/guide/#apiProxy">Micronaut AWS API Gateway Support</a></p>
</div>
<div class="listingblock">
<div class="title">Example <code>MicronautHandler</code></div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code class="language-groovy" data-lang="groovy">/*
 * SPDX-License-Identifier: Apache-2.0
 *
 * Copyright 2018-2020 Agorapulse.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package com.agorapulse.micronaut.http.examples.planets;

import com.amazonaws.serverless.exceptions.ContainerInitializationException;
import com.amazonaws.services.lambda.runtime.Context;
import com.amazonaws.services.lambda.runtime.RequestStreamHandler;
import io.micronaut.context.ApplicationContext;
import io.micronaut.context.ApplicationContextBuilder;
import io.micronaut.function.aws.proxy.MicronautLambdaContainerHandler;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import java.io.IOException;
import java.io.InputStream;
import java.io.OutputStream;
import java.util.function.Consumer;

public class MicronautHandler implements RequestStreamHandler {

    private static final Logger LOGGER = LoggerFactory.getLogger(MicronautHandler.class);

    private static MicronautLambdaContainerHandler handler;
    private static ApplicationContextBuilder builder;

    static {
        reset();
    }

    /**
     * Resets the current handler. For testing purposes only.
     */
    public static void reset() {
        reset(b -&gt; {});
    }

    /**
     * Resets the current handler. For testing purposes only.
     *
     * @param configuration builder customizer
     */
    public static void reset(Consumer&lt;ApplicationContextBuilder&gt; configuration) {
        try {
            builder = ApplicationContext.build();
            configuration.accept(builder);
            handler = MicronautLambdaContainerHandler.getAwsProxyHandler(builder);
        } catch (ContainerInitializationException e) {
            // if we fail here. We re-throw the exception to force another cold start
            if (LOGGER.isErrorEnabled()) {
                LOGGER.error("Exception in container initialization", e);
            }
            throw new IllegalStateException("Could not initialize Micronaut", e);
        }
    }

    public static ApplicationContext getApplicationContext() {
        if (handler == null) {
            reset();
        }
        return handler.getApplicationContext();
    }

    @Override
    public void handleRequest(InputStream inputStream, OutputStream outputStream, Context context)
            throws IOException {
        handler.proxyStream(inputStream, outputStream, context);
    }
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_testing_9"><a class="anchor" href="#_testing_9"></a>2.1. Testing</h4>
<div class="paragraph">
<p>You can still use the API Gateway Proxy integration is using <a href="https://agorapulse.github.io/gru/#_aws_api_gateway">Gru for API Gateway</a></p>
</div>
<div class="listingblock">
<div class="title">Controller Spec</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code class="language-groovy" data-lang="groovy">/*
 * SPDX-License-Identifier: Apache-2.0
 *
 * Copyright 2018-2020 Agorapulse.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package com.agorapulse.micronaut.http.examples.planets

import com.agorapulse.dru.Dru
import com.agorapulse.dru.dynamodb.persistence.DynamoDB
import com.agorapulse.gru.Gru
import com.agorapulse.gru.agp.ApiGatewayProxy
import com.amazonaws.services.dynamodbv2.datamodeling.IDynamoDBMapper
import io.micronaut.context.ApplicationContext
import org.junit.Rule
import spock.lang.Specification

/**
 * Test for planet controller.
 */
class PlanetControllerSpec extends Specification {

    @Rule private final Gru gru = Gru.equip(ApiGatewayProxy.steal(this) {               <i class="conum" data-value="1"></i><b>(1)</b>
        map '/planet/{star}' to MicronautHandler                                        <i class="conum" data-value="2"></i><b>(2)</b>
        map '/planet/{star}/{name}' to MicronautHandler
    })

    @Rule private final Dru dru = Dru.steal(this)

    void setup() {
        MicronautHandler.reset()                                                        <i class="conum" data-value="3"></i><b>(3)</b>
        MicronautHandler.applicationContext.with { ApplicationContext ctx -&gt;
            ctx.registerSingleton(IDynamoDBMapper, DynamoDB.createMapper(dru))          <i class="conum" data-value="4"></i><b>(4)</b>
        }
        dru.add(new Planet(star: 'sun', name: 'mercury'))
        dru.add(new Planet(star: 'sun', name: 'venus'))
        dru.add(new Planet(star: 'sun', name: 'earth'))
        dru.add(new Planet(star: 'sun', name: 'mars'))
    }

    void 'get planet'() {                                                               <i class="conum" data-value="5"></i><b>(5)</b>
        expect:
            gru.test {
                get('/planet/sun/earth')
                expect {
                    json 'earth.json'
                }
            }
    }

    void 'get planet which does not exist'() {
        expect:
            gru.test {
                get('/planet/sun/vulcan')
                expect {
                    status NOT_FOUND
                }
            }
    }

    void 'list planets by existing star'() {
        expect:
            gru.test {
                get('/planet/sun')
                expect {
                    json 'planetsOfSun.json'
                }
            }
    }

    void 'add planet'() {
        when:
            gru.test {
                post '/planet/sun/jupiter'
                expect {
                    status CREATED
                    json 'jupiter.json'
                }
            }
        then:
            gru.verify()
            dru.findAllByType(Planet).size() == 5
    }

    void 'delete planet'() {
        given:
            dru.add(new Planet(star: 'sun', name: 'pluto'))
        expect:
            dru.findAllByType(Planet).size() == 5
            gru.test {
                delete '/planet/sun/pluto'
                expect {
                    status NO_CONTENT
                    json 'pluto.json'
                }
            }
            dru.findAllByType(Planet).size() == 4
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use <code>ApiGatewayProxy</code> client with <a href="https://agorapulse.github.io/gru">Gru</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Delegate to <code>MicronautHandler</code> (see above)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Reset the application context</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Make changes in the application context</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Test method using <a href="https://agorapulse.github.io/gru">Gru</a></td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The advantage of using Gru is that you can reuse the existing test with the local server if required.
Only thing which changes it the handler setup and the client being used (HTTP instead of API Gateway Proxy).
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_micronaut_grails"><a class="anchor" href="#_micronaut_grails"></a>3. Micronaut Grails</h3>
<div class="paragraph">
<p>Micronaut Grails package has been moved into <a href="https://agorapulse.github.io/micronaut-grails">own repository</a>.</p>
</div>
</div>
<div class="sect1">
<h2 id="_links"><a class="anchor" href="#_links"></a>1. Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="api/index.html" target="_blank" rel="noopener">Javadoc</a></p>
</div>
<div class="paragraph">
<p><a href="api-html/index.html" target="_blank" rel="noopener">Source</a></p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 1.2.8<br>
Last updated 2019-12-13 15:57:15 +0100
</div>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.js"></script>
<script>prettyPrint()</script>
</body>
</html>