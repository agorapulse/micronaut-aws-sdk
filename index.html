<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<meta name="author" content="Vladimir Orany">
<title>Set of useful libraries for Micronaut</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<link rel="stylesheet" href="./asciidoctor.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="css/docs.css?v=3.3.4" />
<style>
.hidden {
    display: none;
}

.switch {
    border-width: 1px 1px 0 1px;
    border-style: solid;
    border-color: #7a2518;
    display: inline-block;
}

.switch--item {
    padding: 10px;
    background-color: #ffffff;
    color: #7a2518;
    display: inline-block;
    cursor: pointer;
}

.switch--item.selected {
    background-color: #7a2519;
    color: #ffffff;
}

</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/zepto/1.2.0/zepto.min.js"></script>
<script type="text/javascript">
function addBlockSwitches() {
    $('.primary').each(function() {
        primary = $(this);
        createSwitchItem(primary, createBlockSwitch(primary)).item.addClass("selected");
        primary.children('.title').remove();
    });
    $('.secondary').each(function(idx, node) {
        secondary = $(node);
        primary = findPrimary(secondary);
        switchItem = createSwitchItem(secondary, primary.children('.switch'));
        switchItem.content.addClass('hidden');
        findPrimary(secondary).append(switchItem.content);
        secondary.remove();
    });
}

function createBlockSwitch(primary) {
    blockSwitch = $('<div class="switch"></div>');
    primary.prepend(blockSwitch);
    return blockSwitch;
}

function findPrimary(secondary) {
    candidate = secondary.prev();
    while (!candidate.is('.primary')) {
        candidate = candidate.prev();
    }
    return candidate;
}

function createSwitchItem(block, blockSwitch) {
    blockName = block.children('.title').text();
    content = block.children('.content').first().append(block.next('.colist'));
    item = $('<div class="switch--item">' + blockName + '</div>');
    item.on('click', '', content, function(e) {
        $(this).addClass('selected');
        $(this).siblings().removeClass('selected');
        e.data.siblings('.content').addClass('hidden');
        e.data.removeClass('hidden');
    });
    blockSwitch.append(item);
    return {'item': item, 'content': content};
}

$(addBlockSwitches);

</script>

</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Set of useful libraries for Micronaut</h1>
<div class="details">
<span id="author" class="author">Vladimir Orany</span><br>
<span id="revnumber">version 3.3.4</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel2">
<li><a href="#_aws_sdk_for_micronaut">1. AWS SDK for Micronaut</a>
<ul class="sectlevel3">
<li><a href="#_installation">1.1. Installation</a></li>
<li><a href="#_cloudwatch_logs">1.2. CloudWatch Logs</a>
<ul class="sectlevel4">
<li><a href="#_installation_2">Installation</a></li>
<li><a href="#_cloudwatch_logs_service">CloudWatch Logs Service</a></li>
<li><a href="#_testing">Testing</a></li>
</ul>
</li>
<li><a href="#_dynamodb">1.3. DynamoDB</a>
<ul class="sectlevel4">
<li><a href="#_installation_3">Installation</a></li>
<li><a href="#_entity_class">Entity Class</a></li>
<li><a href="#_declarative_services_with_service">Declarative Services with <code>@Service</code></a></li>
<li><a href="#_dynamodb_service">DynamoDB Service</a></li>
<li><a href="#_dynamodb_accelerator_dax">DynamoDB Accelerator (DAX)</a></li>
<li><a href="#_testing_2">Testing</a></li>
</ul>
</li>
<li><a href="#_kinesis">1.4. Kinesis</a>
<ul class="sectlevel4">
<li><a href="#_installation_4">Installation</a></li>
<li><a href="#_configuration">Configuration</a></li>
<li><a href="#_publishing_with_kinesisclient">Publishing with <code>@KinesisClient</code></a></li>
<li><a href="#_listening_with_kinesislistener">Listening with <code>@KinesisListener</code></a></li>
<li><a href="#_kinesis_service">Kinesis Service</a></li>
<li><a href="#_testing_3">Testing</a></li>
</ul>
</li>
<li><a href="#_lambda">1.5. Lambda</a>
<ul class="sectlevel4">
<li><a href="#_installation_5">Installation</a></li>
<li><a href="#_configuration_2">Configuration</a></li>
<li><a href="#_invocation_using_lambdaclient">Invocation using <code>@LambdaClient</code></a></li>
<li><a href="#_testing_4">Testing</a></li>
<li><a href="#_integration_testing">Integration Testing</a></li>
</ul>
</li>
<li><a href="#_simple_storage_service_s3">1.6. Simple Storage Service (S3)</a>
<ul class="sectlevel4">
<li><a href="#_installation_6">Installation</a></li>
<li><a href="#_configuration_3">Configuration</a></li>
<li><a href="#_simple_storage_service">Simple Storage Service</a></li>
<li><a href="#_testing_5">Testing</a></li>
</ul>
</li>
<li><a href="#_simple_email_service_ses">1.7. Simple Email Service (SES)</a>
<ul class="sectlevel4">
<li><a href="#_installation_7">Installation</a></li>
<li><a href="#_simple_email_service">Simple Email Service</a></li>
<li><a href="#_configuration_4">Configuration</a></li>
<li><a href="#_testing_6">Testing</a></li>
</ul>
</li>
<li><a href="#_simple_notification_service_sns">1.8. Simple Notification Service (SNS)</a>
<ul class="sectlevel4">
<li><a href="#_installation_8">Installation</a></li>
<li><a href="#_configuration_5">Configuration</a></li>
<li><a href="#_publishing_with_notificationclient">Publishing with <code>@NotificationClient</code></a></li>
<li><a href="#_simple_notification_service">Simple Notification Service</a></li>
<li><a href="#_testing_7">Testing</a></li>
</ul>
</li>
<li><a href="#_simple_queue_service_sqs">1.9. Simple Queue Service (SQS)</a>
<ul class="sectlevel4">
<li><a href="#_installation_9">Installation</a></li>
<li><a href="#_configuration_6">Configuration</a></li>
<li><a href="#_publishing_with_queueclient">Publishing with <code>@QueueClient</code></a></li>
<li><a href="#_simple_queue_service">Simple Queue Service</a></li>
<li><a href="#_testing_8">Testing</a></li>
</ul>
</li>
<li><a href="#_security_token_service_sts">1.10. Security Token Service (STS)</a>
<ul class="sectlevel4">
<li><a href="#_installation_10">Installation</a></li>
<li><a href="#_security_token_service">Security Token Service</a></li>
<li><a href="#_testing_9">Testing</a></li>
</ul>
</li>
<li><a href="#_configuration_7">1.11. Configuration</a></li>
</ul>
</li>
<li><a href="#_micronaut_for_api_gateway_proxy">2. Micronaut for API Gateway Proxy</a></li>
<li><a href="#_micronaut_grails">3. Micronaut Grails</a></li>
<li><a href="#_links">1. Links</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="imageblock ribbon">
<div class="content">
<a class="image" href="https://github.com/agorapulse/micronaut-aws-sdk"><img src="images/ribbon.png" alt="ribbon"></a>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="imageblock left">
<div class="content">
<a class="image" href="https://search.maven.org/search?q=g:%22com.agorapulse%22%20AND%20a:%22micronaut-aws-sdk%22"><img src="https://img.shields.io/maven-central/v/com.agorapulse/micronaut-aws-sdk.svg?label=Maven%20Central" alt="micronaut aws sdk"></a>
</div>
</div>
<div class="imageblock left">
<div class="content">
<a class="image" href="https://github.com/agorapulse/micronaut-aws-sdk/actions?query=workflow%3ACheck"><img src="https://github.com/agorapulse/micronaut-aws-sdk/workflows/Check/badge.svg" alt="Build Status"></a>
</div>
</div>
<div class="imageblock left">
<div class="content">
<a class="image" href="https://coveralls.io/github/agorapulse/micronaut-aws-sdk?branch=master""><img src="https://coveralls.io/repos/github/agorapulse/micronaut-aws-sdk/badge.svg?branch=master" alt="badge"></a>
</div>
</div>
</div>
</div>
<hr>
<div class="paragraph">
<p>Set of useful libraries for <a href="http://micronaut.io">Micronaut</a>. All the libraries are available in the Maven Central.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#_aws_sdk_for_micronaut">AWS SDK for Micronaut</a> - integration for <a href="#_dynamodb">DynamoDB</a>, <a href="#_kinesis">Kinesis</a>, <a href="#_simple_storage_service_s3">Simple Storage Service (S3)</a>, <a href="#_simple_email_service_ses">Simple Email Service (SES)</a>, <a href="#_simple_notification_service_sns">Simple Notification Service (SNS)</a>,  <a href="#_simple_queue_service_sqs">Simple Queue Service (SQS)</a> and <a href="#WebSockets for API Gateway">[WebSockets for API Gateway]</a></p>
</li>
<li>
<p><a href="#_micronaut_for_api_gateway_proxy">Micronaut for API Gateway Proxy</a> - develop API Gateway Proxy Lambda functions using Micronaut HTTP server capabilities (currently superseded by
the official library)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_aws_sdk_for_micronaut"><a class="anchor" href="#_aws_sdk_for_micronaut"></a>1. AWS SDK for Micronaut</h3>
<div class="paragraph">
<p>AWS SDK for Micronaut is a successor of <a href="https://github.com/agorapulse/grails-aws-sdk">Grails AWS SDK Plugin</a>.
If you are <a href="https://github.com/agorapulse/grails-aws-sdk">Grails AWS SDK Plugin</a> user you should find many of services familiar.</p>
</div>
<div class="paragraph">
<p>Provided integrations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#_cloudwatch_logs">CloudWatch Logs</a></p>
</li>
<li>
<p><a href="#_dynamodb">DynamoDB</a></p>
</li>
<li>
<p><a href="#_kinesis">Kinesis</a></p>
</li>
<li>
<p><a href="#_lambda">Lambda</a></p>
</li>
<li>
<p><a href="#_simple_storage_service_s3">Simple Storage Service (S3)</a></p>
</li>
<li>
<p><a href="#_simple_email_service_ses">Simple Email Service (SES)</a></p>
</li>
<li>
<p><a href="#_simple_notification_service_sns">Simple Notification Service (SNS)</a></p>
</li>
<li>
<p><a href="#_simple_queue_service_sqs">Simple Queue Service (SQS)</a></p>
</li>
<li>
<p><a href="#_security_token_service_sts">Security Token Service (STS)</a></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<a href="#_micronaut_for_api_gateway_proxy">Micronaut for API Gateway Proxy</a> is handled separately in its own library.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Key concepts of the AWS SDK for Micronaut:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Fully leveraging of Micronaut best practises</p>
<div class="ulist">
<ul>
<li>
<p>Low-level API clients such as <code>AmazonDynamoDB</code> available for dependency injection</p>
</li>
<li>
<p>Declarative clients and services such as <code>@KinesisClient</code> where applicable</p>
</li>
<li>
<p>Configuration driven named service beans</p>
</li>
<li>
<p>Sensible defaults</p>
</li>
<li>
<p>Conditional beans based on presence of classes on the classpath or on the presence of specific properties</p>
</li>
</ul>
</div>
</li>
<li>
<p>Fully leveraging existing AWS SDK configuration chains (e.g. <a href="https://docs.aws.amazon.com/AWSJavaSDK/latest/javadoc/com/amazonaws/auth/DefaultAWSCredentialsProviderChain.html">default credential provider chain</a>, <a href="https://docs.aws.amazon.com/AWSJavaSDK/latest/javadoc/com/amazonaws/regions/DefaultAwsRegionProviderChain.html">default region provider chain</a>)</p>
</li>
<li>
<p>Strong focus on the ease of testing</p>
<div class="ulist">
<ul>
<li>
<p>Low-level API clients such as <code>AmazonDynamoDB</code> injected by Micronaut and overridable in the tests</p>
</li>
<li>
<p>All high-level services hidden behind an interface for easy mocking in the tests</p>
</li>
<li>
<p>Declarative clients and services for easy mocking in the tests</p>
</li>
</ul>
</div>
</li>
<li>
<p>Java-enabled but Groovy is a first-class citizen</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In this documentation, the high-level approaches will be discussed first before the lower-level services.</p>
</div>
<div class="sect3">
<h4 id="_installation"><a class="anchor" href="#_installation"></a>1.1. Installation</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For AWS SDK 2.x use artefacts starting with <code>micronaut-amazon-awssdk</code>. These artefacts are written pure Java.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For AWS SDK 1.x use artefacts starting with <code>micrnoaut-aws-sdk</code>. These are considered legacy artefacts and might be removed in the future when the AWS SDK 2.x get wider adoption.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Since  <code>1.2.8</code> see the particular subprojects for installation instruction.</p>
</div>
</div>
<div class="sect3">
<h4 id="_cloudwatch_logs"><a class="anchor" href="#_cloudwatch_logs"></a>1.2. CloudWatch Logs</h4>
<div class="paragraph">
<p>This library provides support for reading the latest CloudWatch Logs for given log group, usually when testing Lambda
functions.</p>
</div>
<div class="sect4">
<h5 id="_installation_2"><a class="anchor" href="#_installation_2"></a>Installation</h5>
<div class="listingblock primary">
<div class="title">Gradle (AWS SDK 2.x)</div>
<div class="content">
<pre class="prettyprint highlight"><code>implementation 'com.agorapulse:micronaut-amazon-awssdk-cloudwatchlogs:3.3.4'</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Maven (AWS SDK 2.x)</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.agorapulse&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-amazon-awssdk-cloudwatchlogs&lt;/artifactId&gt;
    &lt;version&gt;3.3.4&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Gradle (AWS SDK 1.x)</div>
<div class="content">
<pre class="prettyprint highlight"><code>implementation 'com.agorapulse:micronaut-aws-sdk-cloudwatchlogs:3.3.4'</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Maven (AWS SDK 1.x)</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.agorapulse&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-aws-sdk-cloudwatchlogs&lt;/artifactId&gt;
    &lt;version&gt;3.3.4&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_cloudwatch_logs_service"><a class="anchor" href="#_cloudwatch_logs_service"></a>CloudWatch Logs Service</h5>
<div class="paragraph">
<p>There is a bean <code>CloudWatchLogsService</code> which can be used to read the latest log events.</p>
</div>
<div class="listingblock primary">
<div class="title">Reading the Latest Log Events (AWS SDK 2.x)</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="java">package com.agorapulse.micronaut.amazon.awssdk.lambda;

import com.agorapulse.micronaut.amazon.awssdk.cloudwatchlogs.CloudWatchLogsService;

import jakarta.inject.Singleton;

@Singleton
public class LogCheckService {

    private final CloudWatchLogsService logsService;                                    <i class="conum" data-value="1"></i><b>(1)</b>

    public LogCheckService(CloudWatchLogsService logsService) {
        this.logsService = logsService;
    }

    public boolean contains(String logGroup, String text) {
        return logsService.getLogEvents(logGroup)
            .anyMatch(e -&gt; e.message().contains(text));                                 <i class="conum" data-value="2"></i><b>(2)</b>
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Inject <code>@CloudWatchLogsService</code> into the bean</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>use `getLogEvents(String) obtain a stream of the latest log events</td>
</tr>
</table>
</div>
<div class="listingblock secondary">
<div class="title">Reading the Latest Log Events (AWS SDK 1.x)</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="java">package com.agorapulse.micronaut.aws.lambda;

import com.agorapulse.micronaut.aws.cloudwatchlogs.CloudWatchLogsService;

import jakarta.inject.Singleton;

@Singleton
public class LogCheckService {

    private final CloudWatchLogsService logsService;                                    <i class="conum" data-value="1"></i><b>(1)</b>

    public LogCheckService(CloudWatchLogsService logsService) {
        this.logsService = logsService;
    }

    public boolean contains(String logGroup, String text) {
        return logsService.getLogEvents(logGroup)
            .anyMatch(e -&gt; e.getMessage().contains(text));                              <i class="conum" data-value="2"></i><b>(2)</b>
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Inject <code>@CloudWatchLogsService</code> into the bean</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>use `getLogEvents(String) obtain a stream of the latest log events</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_testing"><a class="anchor" href="#_testing"></a>Testing</h5>
<div class="paragraph">
<p>You can very easily create a Lambda function locally with <a href="https://www.testcontainers.org/">Testcontainers</a> and <a href="https://localstack.cloud/">LocalStack</a> using <code>micronaut-amazon-awssdk-integration-testing</code> module.</p>
</div>
<div class="paragraph">
<p>You need to add following dependencies into your build file to get the service connected to Localstack automatically:</p>
</div>
<div class="listingblock primary">
<div class="title">Gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code>testImplementation 'com.agorapulse:micronaut-amazon-awssdk-integration-testing:3.3.4'</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Maven</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.agorapulse&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-amazon-awssdk-integration-testing&lt;/artifactId&gt;
    &lt;version&gt;3.3.4&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_dynamodb"><a class="anchor" href="#_dynamodb"></a>1.3. DynamoDB</h4>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Amazon DynamoDB is a fully managed NoSQL database service that provides fast and predictable performance with seamless scalability.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>This library provides two approaches to work with DynamoDB tables and entities:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>High-level <a href="#_declarative_services_with_service">Declarative Services with <code>@Service</code></a></p>
</li>
<li>
<p>Middle-level <a href="#_dynamodb_service">DynamoDB Service</a></p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_installation_3"><a class="anchor" href="#_installation_3"></a>Installation</h5>
<div class="listingblock primary">
<div class="title">Gradle (AWS SDK 2.x)</div>
<div class="content">
<pre class="prettyprint highlight"><code>annotationProcessor 'com.agorapulse:micronaut-amazon-awssdk-dynamodb-annotation-processor:3.3.4'
implementation 'com.agorapulse:micronaut-amazon-awssdk-dynamodb:3.3.4'

// for Kotlin Query DSL
implementation 'com.agorapulse:micronaut-amazon-awssdk-dynamodb-kotlin:3.3.4'</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Maven (AWS SDK 2.x)</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.agorapulse&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-amazon-awssdk-dynamodb&lt;/artifactId&gt;
    &lt;version&gt;3.3.4&lt;/version&gt;
&lt;/dependency&gt;
&lt;!-- for Kotlin Query DSL --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.agorapulse&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-amazon-awssdk-dynamodb&lt;/artifactId&gt;
    &lt;version&gt;3.3.4&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Gradle (AWS SDK 1.x)</div>
<div class="content">
<pre class="prettyprint highlight"><code>annotationProcessor 'com.agorapulse:micronaut-aws-sdk-dynamodb-annotation-processor:3.3.4'
implementation 'com.agorapulse:micronaut-aws-sdk-dynamodb:3.3.4'</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Maven (AWS SDK 1.x)</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.agorapulse&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-aws-sdk-dynamodb&lt;/artifactId&gt;
    &lt;version&gt;3.3.4&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For Kotlin use <code>kapt</code> instead of <code>annotationProcessor</code> configuration.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_entity_class"><a class="anchor" href="#_entity_class"></a>Entity Class</h5>
<div class="paragraph">
<p>The entity class is a class which instances represent the items in DynamoDB.</p>
</div>
<div class="paragraph">
<p>For AWS SDK v2 you don&#8217;t need to use the <a href="https://sdk.amazonaws.com/java/api/latest/software/amazon/awssdk/enhanced/dynamodb/mapper/annotations/package-summary.html">native annotations</a> but
you fill their counterparts in <code>com.agorapulse.micronaut.amazon.awssdk.dynamodb.annotation</code> package. The only requirements is that
the class needs to be annotated either with <code>@Introspected</code> or <code>@DynamoDbBean</code>. There is a replacement for <code>@DynamoDBTypeConvertedJson</code> annotation as well - you can use <code>@ConvertedJson</code> annotation instead.</p>
</div>
<div class="listingblock primary">
<div class="title">Groovy</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="groovy">import com.agorapulse.micronaut.amazon.awssdk.dynamodb.annotation.PartitionKey
import com.agorapulse.micronaut.amazon.awssdk.dynamodb.annotation.Projection
import com.agorapulse.micronaut.amazon.awssdk.dynamodb.annotation.SecondaryPartitionKey
import com.agorapulse.micronaut.amazon.awssdk.dynamodb.annotation.SecondarySortKey
import com.agorapulse.micronaut.amazon.awssdk.dynamodb.annotation.SortKey
import groovy.transform.Canonical
import groovy.transform.CompileStatic
import io.micronaut.core.annotation.Introspected
import software.amazon.awssdk.services.dynamodb.model.ProjectionType

@Canonical
@Introspected                                                                           <i class="conum" data-value="1"></i><b>(1)</b>
@CompileStatic
class DynamoDBEntity {

    public static final String DATE_INDEX = 'date'
    public static final String RANGE_INDEX = 'rangeIndex'
    public static final String GLOBAL_INDEX = 'globalIndex'

    @PartitionKey String parentId                                                       <i class="conum" data-value="2"></i><b>(2)</b>
    @SortKey String id                                                                  <i class="conum" data-value="3"></i><b>(3)</b>

    @SecondarySortKey(indexNames = RANGE_INDEX)                                         <i class="conum" data-value="4"></i><b>(4)</b>
    String rangeIndex

    @Projection(ProjectionType.ALL)                                                     <i class="conum" data-value="5"></i><b>(5)</b>
    @SecondarySortKey(indexNames = DATE_INDEX)
    Date date

    Integer number = 0

    @Projection(ProjectionType.ALL)
    @SecondaryPartitionKey(indexNames = GLOBAL_INDEX)                                   <i class="conum" data-value="6"></i><b>(6)</b>
    String getGlobalIndex() {
        return "$parentId:$id"
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The entity must be annotated with <code>@Introspected</code> or <code>@DynamoDBBean</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The entity must provide the partition key using <code>@ParitionKey</code> annotation</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The sort key is optional</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The secondary indices are generated automatically if not present</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>If the secondary indices are generated then the projection type must be specified (the default is KEYS_ONLY)</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>The secondary indices can be read only if you derive them from the other attributes</td>
</tr>
</table>
</div>
<div class="listingblock secondary">
<div class="title">Java</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="java">import com.agorapulse.micronaut.amazon.awssdk.dynamodb.annotation.ConvertedJson;
import com.agorapulse.micronaut.amazon.awssdk.dynamodb.annotation.PartitionKey;
import com.agorapulse.micronaut.amazon.awssdk.dynamodb.annotation.Projection;
import com.agorapulse.micronaut.amazon.awssdk.dynamodb.annotation.SecondaryPartitionKey;
import com.agorapulse.micronaut.amazon.awssdk.dynamodb.annotation.SecondarySortKey;
import com.agorapulse.micronaut.amazon.awssdk.dynamodb.annotation.SortKey;
import io.micronaut.core.annotation.Introspected;
import software.amazon.awssdk.services.dynamodb.model.ProjectionType;

import java.util.Date;
import java.util.HashSet;
import java.util.LinkedHashMap;
import java.util.List;
import java.util.Map;
import java.util.Objects;
import java.util.Set;

@Introspected                                                                           <i class="conum" data-value="1"></i><b>(1)</b>
public class DynamoDBEntity implements PlaybookAware {

    public static final String DATE_INDEX = "date";
    public static final String RANGE_INDEX = "rangeIndex";
    public static final String GLOBAL_INDEX = "globalIndex";

    private String parentId;
    private String id;
    private String rangeIndex;
    private Date date;
    private Integer number = 0;

    private Map&lt;String, List&lt;String&gt;&gt; mapProperty = new LinkedHashMap&lt;&gt;();
    private Set&lt;String&gt; stringSetProperty = new HashSet&lt;&gt;();
    private Options options = new Options();

    @PartitionKey                                                                       <i class="conum" data-value="2"></i><b>(2)</b>
    public String getParentId() {
        return parentId;
    }

    public void setParentId(String parentId) {
        this.parentId = parentId;
    }

    @SortKey                                                                            <i class="conum" data-value="3"></i><b>(3)</b>
    public String getId() {
        return id;
    }

    public void setId(String id) {
        this.id = id;
    }

    @SecondarySortKey(indexNames = RANGE_INDEX)                                         <i class="conum" data-value="4"></i><b>(4)</b>
    public String getRangeIndex() {
        return rangeIndex;
    }

    public void setRangeIndex(String rangeIndex) {
        this.rangeIndex = rangeIndex;
    }

    @Projection(ProjectionType.ALL)                                                     <i class="conum" data-value="5"></i><b>(5)</b>
    @SecondarySortKey(indexNames = DATE_INDEX)
    public Date getDate() {
        return date;
    }

    public void setDate(Date date) {
        this.date = date;
    }

    public Integer getNumber() {
        return number;
    }

    public void setNumber(Integer number) {
        this.number = number;
    }

    @Projection(ProjectionType.ALL)
    @SecondaryPartitionKey(indexNames = GLOBAL_INDEX)                                   <i class="conum" data-value="6"></i><b>(6)</b>
    public String getGlobalIndex() {
        return parentId + ":" + id;
    }

    public Map&lt;String, List&lt;String&gt;&gt; getMapProperty() {
        return mapProperty;
    }

    public void setMapProperty(Map&lt;String, List&lt;String&gt;&gt; mapProperty) {
        this.mapProperty = mapProperty;
    }

    public Set&lt;String&gt; getStringSetProperty() {
        return stringSetProperty;
    }

    public void setStringSetProperty(Set&lt;String&gt; stringSetProperty) {
        this.stringSetProperty = stringSetProperty;
    }

    @ConvertedJson
    public Options getOptions() {
        return options;
    }

    public void setOptions(Options options) {
        this.options = options;
    }

    //CHECKSTYLE:OFF
    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (o == null || getClass() != o.getClass()) return false;
        DynamoDBEntity that = (DynamoDBEntity) o;
        return Objects.equals(parentId, that.parentId) &amp;&amp;
            Objects.equals(id, that.id) &amp;&amp;
            Objects.equals(rangeIndex, that.rangeIndex) &amp;&amp;
            Objects.equals(date, that.date) &amp;&amp;
            Objects.equals(number, that.number) &amp;&amp;
            Objects.equals(mapProperty, that.mapProperty) &amp;&amp;
            Objects.equals(stringSetProperty, that.stringSetProperty);
    }

    @Override
    public int hashCode() {
        return Objects.hash(parentId, id, rangeIndex, date, number, mapProperty, stringSetProperty);
    }

    @Override
    public String toString() {
        return "DynamoDBEntity{" +
            "parentId='" + parentId + '\'' +
            ", id='" + id + '\'' +
            ", rangeIndex='" + rangeIndex + '\'' +
            ", date=" + date +
            ", number=" + number +
            ", mapProperty=" + mapProperty +
            ", stringSetProperty=" + stringSetProperty +
            '}';
    }
    //CHECKSTYLE:ON
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The entity must be annotated with <code>@Introspected</code> or <code>@DynamoDBBean</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The entity must provide the partition key using <code>@ParitionKey</code> annotation</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The sort key is optional</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The secondary indices are generated automatically if not present</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>If the secondary indices are generated then the projection type must be specified (the default is KEYS_ONLY)</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>The secondary indices can be read only if you derive them from the other attributes</td>
</tr>
</table>
</div>
<div class="listingblock secondary">
<div class="title">Kotlin</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="kotlin">import com.agorapulse.micronaut.amazon.awssdk.dynamodb.annotation.*
import io.micronaut.core.annotation.Introspected
import software.amazon.awssdk.services.dynamodb.model.ProjectionType
import java.util.*

@Introspected                                                                           <i class="conum" data-value="1"></i><b>(1)</b>
class DynamoDBEntity {

    @PartitionKey                                                                       <i class="conum" data-value="2"></i><b>(2)</b>
    var parentId: String? = null

    @SortKey                                                                            <i class="conum" data-value="3"></i><b>(3)</b>
    var id: String? = null

    @SecondarySortKey(indexNames = [RANGE_INDEX])                                       <i class="conum" data-value="4"></i><b>(4)</b>
    var rangeIndex: String? = null

    @SecondarySortKey(indexNames = [DATE_INDEX])                                        <i class="conum" data-value="5"></i><b>(5)</b>
    @Projection(ProjectionType.ALL)
    var date: Date? = null

    var number = 0

    var map: Map&lt;String, List&lt;String&gt;&gt;? = null

    @SecondaryPartitionKey(indexNames = [GLOBAL_INDEX])                                 <i class="conum" data-value="6"></i><b>(6)</b>
    @Projection(ProjectionType.ALL)
    fun getGlobalIndex(): String {
        return "$parentId:$id"
    }

    companion object {
        const val DATE_INDEX = "date"
        const val RANGE_INDEX = "rangeIndex"
        const val GLOBAL_INDEX = "globalIndex"
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The entity must be annotated with <code>@Introspected</code> or <code>@DynamoDBBean</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The entity must provide the partition key using <code>@ParitionKey</code> annotation</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The sort key is optional</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The secondary indices are generated automatically if not present</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>If the secondary indices are generated then the projection type must be specified (the default is KEYS_ONLY)</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>The secondary indices can be read only if you derive them from the other attributes</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_declarative_services_with_service"><a class="anchor" href="#_declarative_services_with_service"></a>Declarative Services with <code>@Service</code></h5>
<div class="paragraph">
<p>Declarative services are very similar to <a href="http://gorm.grails.org/6.1.x/hibernate/manual/#dataServices">Grails GORM Data Services</a>.
If you place <code>Service</code> annotation on the interface then methods matching predefined pattern will be automatically implemented.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For AWS SDK 2.x, use packages starting <code>com.agorapulse.micronaut.amazon.awssdk.dynamodb</code>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For AWS SDK 1.x, use packages starting <code>com.agorapulse.micronaut.aws.sdk.dynamodb</code>.
</td>
</tr>
</table>
</div>
<div class="sect5">
<h6 id="_method_signatures"><a class="anchor" href="#_method_signatures"></a>Method Signatures</h6>
<div class="paragraph">
<p>The following example shows many of available method signatures:</p>
</div>
<div class="listingblock primary">
<div class="title">Groovy</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="groovy">@Service(DynamoDBEntity)
interface DynamoDBItemDBService {

    DynamoDBEntity get(String hash, String rangeKey)
    DynamoDBEntity load(String hash, String rangeKey)
    List&lt;DynamoDBEntity&gt; getAll(String hash, List&lt;String&gt; rangeKeys)
    List&lt;DynamoDBEntity&gt; getAll(String hash, String... rangeKeys)
    List&lt;DynamoDBEntity&gt; loadAll(String hash, List&lt;String&gt; rangeKeys)
    List&lt;DynamoDBEntity&gt; loadAll(String hash, String... rangeKeys)

    DynamoDBEntity save(DynamoDBEntity entity)
    List&lt;DynamoDBEntity&gt; saveAll(DynamoDBEntity... entities)
    List&lt;DynamoDBEntity&gt; saveAll(Iterable&lt;DynamoDBEntity&gt; entities)

    int count(String hashKey)
    int count(String hashKey, String rangeKey)

    @Query({
        query(DynamoDBEntity) {
            hash hashKey
            range {
                eq DynamoDBEntity.RANGE_INDEX, rangeKey
            }
        }
    })
    int countByRangeIndex(String hashKey, String rangeKey)

    @Query({
        query(DynamoDBEntity) {
            hash hashKey
            range { between DynamoDBEntity.DATE_INDEX, after, before }
        }
    })
    int countByDates(String hashKey, Date after, Date before)

    Publisher&lt;DynamoDBEntity&gt; query(String hashKey)
    Publisher&lt;DynamoDBEntity&gt; query(String hashKey, String rangeKey)

    @Query({
        query(DynamoDBEntity) {
            hash hashKey
            range {
                eq DynamoDBEntity.RANGE_INDEX, rangeKey
            }
            only {
                rangeIndex
            }
        }
    })
    Publisher&lt;DynamoDBEntity&gt; queryByRangeIndex(String hashKey, String rangeKey)

    @Query({
        query(DynamoDBEntity) {
            hash hashKey
            range { between DynamoDBEntity.DATE_INDEX, after, before }
        }
    })
    List&lt;DynamoDBEntity&gt; queryByDates(String hashKey, Date after, Date before)

    void delete(DynamoDBEntity entity)
    void delete(String hashKey, String rangeKey)

    @Query({
        query(DynamoDBEntity) {
            hash hashKey
            range {
                eq DynamoDBEntity.RANGE_INDEX, rangeKey
            }
        }
    })
    int deleteByRangeIndex(String hashKey, String rangeKey)

    @Query({
        query(DynamoDBEntity) {
            hash hashKey
            range { between DynamoDBEntity.DATE_INDEX, after, before }
        }
    })
    int deleteByDates(String hashKey, Date after, Date before)

    @Update({
        update(DynamoDBEntity) {
            hash hashKey
            range rangeKey
            add 'number', 1
            returnUpdatedNew { number }
        }
    })
    Number increment(String hashKey, String rangeKey)

    @Update({
        update(DynamoDBEntity) {
            hash hashKey
            range rangeKey
            add 'number', -1
            returnUpdatedNew { number }
        }
    })
    Number decrement(String hashKey, String rangeKey)

    @Scan({
        scan(DynamoDBEntity) {
            filter {
                eq DynamoDBEntity.RANGE_INDEX, foo
            }
        }
    })
    Publisher&lt;DynamoDBEntity&gt; scanAllByRangeIndex(String foo)

}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Java</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="java">@Service(DynamoDBEntity.class)
public interface DynamoDBEntityService {

    class EqRangeIndex implements Function&lt;Map&lt;String, Object&gt;, DetachedQuery&gt; {
        public DetachedQuery apply(Map&lt;String, Object&gt; arguments) {
            return Builders.query(DynamoDBEntity.class)
                .hash(arguments.get("hashKey"))
                .range(r -&gt; r.eq(DynamoDBEntity.RANGE_INDEX, arguments.get("rangeKey")));
        }
    }

    class EqRangeProjection implements Function&lt;Map&lt;String, Object&gt;, DetachedQuery&gt; {
        public DetachedQuery apply(Map&lt;String, Object&gt; arguments) {
            return Builders.query(DynamoDBEntity.class)
                .hash(arguments.get("hashKey"))
                .range(r -&gt;
                    r.eq(DynamoDBEntity.RANGE_INDEX, arguments.get("rangeKey"))
                )
                .only(DynamoDBEntity.RANGE_INDEX);
        }
    }

    class EqRangeScan implements Function&lt;Map&lt;String, Object&gt;, DetachedScan&gt; {
        public DetachedScan apply(Map&lt;String, Object&gt; arguments) {
            return Builders.scan(DynamoDBEntity.class)
                .filter(f -&gt; f.eq(DynamoDBEntity.RANGE_INDEX, arguments.get("foo")));
        }
    }

    class BetweenDateIndex implements Function&lt;Map&lt;String, Object&gt;, DetachedQuery&gt; {
        public DetachedQuery apply(Map&lt;String, Object&gt; arguments) {
            return Builders.query(DynamoDBEntity.class)
                .hash(arguments.get("hashKey"))
                .range(r -&gt; r.between(DynamoDBEntity.DATE_INDEX, arguments.get("after"), arguments.get("before")));
        }
    }

    class IncrementNumber implements Function&lt;Map&lt;String, Object&gt;, DetachedUpdate&gt; {
        public DetachedUpdate apply(Map&lt;String, Object&gt; arguments) {
            return Builders.update(DynamoDBEntity.class)
                .hash(arguments.get("hashKey"))
                .range(arguments.get("rangeKey"))
                .add("number", 1)
                .returnUpdatedNew(DynamoDBEntity::getNumber);
        }
    }

    class DecrementNumber implements Function&lt;Map&lt;String, Object&gt;, DetachedUpdate&gt; {
        public DetachedUpdate apply(Map&lt;String, Object&gt; arguments) {
            return Builders.update(DynamoDBEntity.class)
                .hash(arguments.get("hashKey"))
                .range(arguments.get("rangeKey"))
                .add("number", -1)
                .returnUpdatedNew(DynamoDBEntity::getNumber);
        }
    }

    DynamoDBEntity get(String hash, String rangeKey);

    DynamoDBEntity load(String hash, String rangeKey);

    List&lt;DynamoDBEntity&gt; getAll(String hash, List&lt;String&gt; rangeKeys);

    List&lt;DynamoDBEntity&gt; getAll(String hash, String... rangeKeys);

    List&lt;DynamoDBEntity&gt; loadAll(String hash, List&lt;String&gt; rangeKeys);

    List&lt;DynamoDBEntity&gt; loadAll(String hash, String... rangeKeys);

    DynamoDBEntity save(DynamoDBEntity entity);

    List&lt;DynamoDBEntity&gt; saveAll(DynamoDBEntity... entities);

    List&lt;DynamoDBEntity&gt; saveAll(Iterable&lt;DynamoDBEntity&gt; entities);

    int count(String hashKey);

    int count(String hashKey, String rangeKey);

    @Query(EqRangeIndex.class)
    int countByRangeIndex(String hashKey, String rangeKey);

    @Query(BetweenDateIndex.class)
    int countByDates(String hashKey, Date after, Date before);

    Publisher&lt;DynamoDBEntity&gt; query(String hashKey);

    Publisher&lt;DynamoDBEntity&gt; query(String hashKey, String rangeKey);

    @Query(EqRangeProjection.class)
    Publisher&lt;DynamoDBEntity&gt; queryByRangeIndex(String hashKey, String rangeKey);

    @Query(BetweenDateIndex.class)
    List&lt;DynamoDBEntity&gt; queryByDates(String hashKey, Date after, Date before);

    void delete(DynamoDBEntity entity);

    void delete(String hashKey, String rangeKey);

    @Query(EqRangeIndex.class)
    int deleteByRangeIndex(String hashKey, String rangeKey);

    @Query(BetweenDateIndex.class)
    int deleteByDates(String hashKey, Date after, Date before);

    @Update(IncrementNumber.class)
    Number increment(String hashKey, String rangeKey);

    @Update(DecrementNumber.class)
    Number decrement(String hashKey, String rangeKey);

    @Scan(EqRangeScan.class)
    Publisher&lt;DynamoDBEntity&gt; scanAllByRangeIndex(String foo);

}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Kotlin</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="kotlin">@Service(value = DynamoDBEntity::class, tableName = "DynamoDBJava")
interface DynamoDBEntityService {

    fun sget(@PartitionKey parentId: String, @SortKey id: String): DynamoDBEntity

    fun load(@PartitionKey parentId: String, @SortKey id: String): DynamoDBEntity

    fun getAll(hash: String, rangeKeys: List&lt;String&gt;): List&lt;DynamoDBEntity&gt;

    fun getAll(hash: String, vararg rangeKeys: String): List&lt;DynamoDBEntity&gt;

    fun loadAll(hash: String, rangeKeys: List&lt;String&gt;): List&lt;DynamoDBEntity&gt;

    fun loadAll(hash: String, vararg rangeKeys: String): List&lt;DynamoDBEntity&gt;

    fun save(entity: DynamoDBEntity): DynamoDBEntity

    fun saveAll(vararg entities: DynamoDBEntity): List&lt;DynamoDBEntity?&gt;?

    fun saveAll(entities: Iterable&lt;DynamoDBEntity&gt;): List&lt;DynamoDBEntity&gt;

    fun count(hashKey: String): Int

    fun count(hashKey: String, rangeKey: String): Int

    class EqRangeIndex : QueryFunction&lt;DynamoDBEntity&gt;({ args: Map&lt;String, Any&gt; -&gt;
        partitionKey(args.get("hashKey"))
        index(DynamoDBEntity.RANGE_INDEX)
        sortKey {
            eq(args["rangeKey"])
        }
    })

    @Query(EqRangeIndex::class)
    fun countByRangeIndex(hashKey: String, rangeKey: String): Int

    class BetweenDateIndex : QueryFunction&lt;DynamoDBEntity&gt;({ args: Map&lt;String, Any&gt; -&gt;
        index(DynamoDBEntity.DATE_INDEX)
        partitionKey(args["hashKey"])
        sortKey { between(args["after"], args["before"]) }
        page(1)
    })

    @Query(BetweenDateIndex::class)
    fun countByDates(hashKey: String, after: Date, before: Date): Int

    fun query(hashKey: String): Publisher&lt;DynamoDBEntity&gt;
    fun query(hashKey: String, rangeKey: String): Publisher&lt;DynamoDBEntity&gt;

    class EqRangeProjection : QueryFunction&lt;DynamoDBEntity&gt;({ args: Map&lt;String, Any&gt; -&gt;
        partitionKey(args["hashKey"])
        index(DynamoDBEntity.RANGE_INDEX)
        sortKey { eq(args["rangeKey"]) }
        only(DynamoDBEntity.RANGE_INDEX)
    })
    @Query(EqRangeProjection::class)
    fun queryByRangeIndex(hashKey: String, rangeKey: String): Publisher&lt;DynamoDBEntity&gt;

    @Query(BetweenDateIndex::class)
    fun queryByDates(hashKey: String, after: Date, before: Date): List&lt;DynamoDBEntity&gt;

    class BetweenDateIndexScroll : QueryFunction&lt;DynamoDBEntity&gt;({ args: Map&lt;String, Any&gt; -&gt;
        index(DynamoDBEntity.DATE_INDEX)
        partitionKey(args["hashKey"])
        lastEvaluatedKey(args["lastEvaluatedKey"])
        sortKey { between(args["after"], args["before"]) }
    })

    @Query(BetweenDateIndexScroll::class)
    fun queryByDatesScroll(
        hashKey: String,
        after: Date,
        before: Date,
        lastEvaluatedKey: DynamoDBEntity
    ): List&lt;DynamoDBEntity&gt;

    fun delete(entity: DynamoDBEntity)
    fun delete(hashKey: String, rangeKey: String)

    @Query(EqRangeIndex::class)
    fun deleteByRangeIndex(hashKey: String, rangeKey: String): Int

    @Query(BetweenDateIndex::class)
    fun deleteByDates(hashKey: String, after: Date, before: Date): Int
    class IncrementNumber : UpdateFunction&lt;DynamoDBEntity, Int&gt;({ args: Map&lt;String, Any&gt; -&gt;
        partitionKey(args["hashKey"])
        sortKey(args["rangeKey"])
        add("number", 1)
        returnUpdatedNew(DynamoDBEntity::number)
    })

    @Update(IncrementNumber::class)
    fun increment(hashKey: String, rangeKey: String): Number
    class DecrementNumber : UpdateFunction&lt;DynamoDBEntity, Int&gt;({ args: Map&lt;String, Any&gt; -&gt;
        partitionKey(args["hashKey"])
        sortKey(args["rangeKey"])
        add("number", -1)
        returnUpdatedNew(DynamoDBEntity::number)
    })

    @Update(DecrementNumber::class)
    fun decrement(hashKey: String, rangeKey: String): Number
    class EqRangeScan : ScanFunction&lt;DynamoDBEntity&gt;({ args: Map&lt;String, Any&gt; -&gt;
        filter {
            eq(DynamoDBEntity.RANGE_INDEX, args["foo"])
        }

    })
    @Scan(EqRangeScan::class)
    fun scanAllByRangeIndex(foo: String): Publisher&lt;DynamoDBEntity&gt;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following table summarizes the supported method signatures:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Basic Service Methods</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Return Type</th>
<th class="tableblock halign-left valign-top">Method Name</th>
<th class="tableblock halign-left valign-top">Arguments</th>
<th class="tableblock halign-left valign-top">Example</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>T</code></p>
<p class="tableblock">    <code>List&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>save*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An entity, array of entities or iterable of entities</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DynamoDBEntity save(DynamoDBEntity entity)</code></p>
<p class="tableblock">    <code>List&lt;DynamoDBEntity&gt; saveAll(DynamoDBEntity&#8230;&#8203; entities)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Persists the entity or a list of entities and returns self</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>T</code></p>
<p class="tableblock">    <code>List&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>get*</code>, <code>load*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hash key and optional range key, array of range keys or iterable of range keys annotated with <code>@HashKey</code> and <code>@RangeKey</code> if the argument name does not contain word <code>hash</code> or <code>range</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DynamoDBEntity load(String hashKey);</code></p>
<p class="tableblock">    <code>List&lt;DynamoDBEntity&gt; getAll(@HashKey String parentId, String&#8230;&#8203; rangeKeys);</code></p>
<p class="tableblock">    <code>List&lt;DynamoDBEntityNoRange&gt; getAll(@HashKey List&lt;String&gt; parentIds);</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Loads a single entity or a list of entities from the table. Range key is required for tables which defines the range key</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>count*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hash key and optional range key annotated with <code>@HashKey</code> and <code>@RangeKey</code> if the argument name does not contain word <code>hash</code> or <code>range</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int count(String hashKey)</code></p>
<p class="tableblock">    <code>int count(@HashKey String parentId, String rangeKey)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counts the items in the database. Beware, this can be very expensive operation in DynamoDB. See <a href="#_advanced_queries">Advanced Queries</a> for advanced use cases</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>void</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>delete*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Entity or Hash key and optional range key annotated with <code>@HashKey</code> and <code>@RangeKey</code> if the argument name does not contain word <code>hash</code> or <code>range</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>void delete(DynamoDBEntity entity)</code></p>
<p class="tableblock">    <code>void delete(String hashKey, String rangeKey)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deletes an item which can be specified with hash key and optional range key. See <a href="#_advanced_queries">Advanced Queries</a> for advanced use cases</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Publisher&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>list*</code></p>
<p class="tableblock"><code>findAll*</code></p>
<p class="tableblock"><code>query*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Entity or Hash key and optional range key annotated with <code>@HashKey</code> and <code>@RangeKey</code> if the argument name does not contain word <code>hash</code> or <code>range</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Publisher&lt;DynamoDBEntity&gt; query(String hashKey)</code></p>
<p class="tableblock">    <code>List&lt;DynamoDBEntity&gt; query(String hashKey, String rangeKey)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Queries for all entities with given hash key and/or range key.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(contextual)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(none of above)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any arguments which will be translated into arguments map</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(see below)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Query, scan or update. See <a href="#_advanced_queries">Advanced Queries</a>, <a href="#_scanning">Scanning</a> and <a href="#_updates">Updates</a> for advanced use cases</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Calling any of the declarative service method will create the DynamoDB table automatically if it does not exist already.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_advanced_queries"><a class="anchor" href="#_advanced_queries"></a>Advanced Queries</h6>
<div class="paragraph">
<p>DynamoDB integration does not support feature known as <a href="http://gorm.grails.org/6.0.x/hibernate/manual/index.html#finders"><em>dynamic finders</em></a>.
Instead you can annotate any method with <code>@Query</code> annotation to make it</p>
</div>
<div class="ulist">
<ul>
<li>
<p>counting method if its name begins with <code>count</code></p>
</li>
<li>
<p>batch delete method if its name begins with <code>delete</code></p>
</li>
<li>
<p>otherwise an advanced query method</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For DynamoDB v2 you can use <code>@Index</code>, <code>@Consistent</code> <code>@Descending</code>, <code>@Filter</code>, <code>@Limit</code>, <code>@Page</code> and <code>@LastEvaluatedKey</code> annotations to further customize the query without the need of creating a custom query class and use it with <code>@Query</code> annotation.</p>
</div>
<div class="listingblock">
<div class="title">Advanced Query Annotations</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="java">@Consistent                                                                         <i class="conum" data-value="1"></i><b>(1)</b>
@Descending                                                                         <i class="conum" data-value="2"></i><b>(2)</b>
@Index(DynamoDBEntity.DATE_INDEX)                                                   <i class="conum" data-value="3"></i><b>(3)</b>
List&lt;DynamoDBEntity&gt; findAllByNumber(
    @PartitionKey String parentId,
    Integer number                                                                  <i class="conum" data-value="4"></i><b>(4)</b>
);

int countAllByOptionalNumber(
    @PartitionKey String parentId,
    @Nullable Integer number                                                        <i class="conum" data-value="5"></i><b>(5)</b>
);

List&lt;DynamoDBEntity&gt; findAllByNumberGreaterThan(
    @PartitionKey String parentId,
    @Filter(                                                                        <i class="conum" data-value="6"></i><b>(6)</b>
        value = Filter.Operator.GT,
        name = "number"                                                             <i class="conum" data-value="7"></i><b>(7)</b>
    ) Integer theNumber
);

@Index(DynamoDBEntity.RANGE_INDEX)
List&lt;DynamoDBEntity&gt; findAllByRangeBeginsWith(
    @PartitionKey String parentId,
    @SortKey                                                                        <i class="conum" data-value="8"></i><b>(8)</b>
    @Filter(
        value = Filter.Operator.BEGINS_WITH,                                        <i class="conum" data-value="9"></i><b>(9)</b>
        name = "rangeIndex"                                                         <i class="conum" data-value="10"></i><b>(10)</b>
    )
    String rangeIndexPrefix
);

@Index(DynamoDBEntity.RANGE_INDEX)
int deleteAllByRangeBeginsWith(                                                     <i class="conum" data-value="11"></i><b>(11)</b>
    @PartitionKey String parentId,
    @SortKey
    @Filter(
        value = Filter.Operator.BEGINS_WITH,
        name = "rangeIndex"
    )
    String rangeIndexPrefix
);

List&lt;DynamoDBEntity&gt; findAllByNumberNot(
    @PartitionKey String parentId,
    @Filter(Filter.Operator.NE) Integer number,
    @LastEvaluatedKey DynamoDBEntity lastEvaluatedKey,                              <i class="conum" data-value="12"></i><b>(12)</b>
    @Page int page,                                                                 <i class="conum" data-value="13"></i><b>(13)</b>
    @Limit int limit                                                                <i class="conum" data-value="14"></i><b>(14)</b>
);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>You can use <code>@Consistent</code> annotation to make the query consistent</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can use <code>@Descending</code> annotation to sort the results in descending order</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>You can use <code>@Index</code> annotation to specify the index to use to query the table</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Any parameters that are not partition or sort keys are used as filter conditions</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>If the parameter is annotated with <code>@Nullable</code> then the filter condition is only applied when the parameter is not <code>null</code></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>You can use <code>@Filter</code> annotation to specify the filter condition operator</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>You can use <code>@Filter</code> annotation to specify the attribute name</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>You can combine <code>@SortKey</code> and <code>@Filter</code> annotations to specify the sort key condition</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Only`EQ`, <code>LE</code>, <code>LT</code>, <code>GE</code>, <code>GT</code>, <code>BETWEEN</code> and <code>BEGINS_WITH</code> operators are supported</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>You can also use <code>@Filter</code> annotation to specify the sort key name</td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b>11</b></td>
<td>If you use any customization annotations on delete method, then the method will be used as batch delete method</td>
</tr>
<tr>
<td><i class="conum" data-value="12"></i><b>12</b></td>
<td>You can pass the last evaluated key to the query. It must be the same type as the entity type.</td>
</tr>
<tr>
<td><i class="conum" data-value="13"></i><b>13</b></td>
<td>You can use <code>@Page</code> annotation to give the query the pagination hint</td>
</tr>
<tr>
<td><i class="conum" data-value="14"></i><b>14</b></td>
<td>You can use <code>@Limit</code> annotation to specify the maximum number of items to return</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The operator <code>EQ</code> is used by default if <code>@Filter</code> annotation is not present. This makes it special and the service introduction tries to find the appropriate operation based on the actual value. For collections or arrays, <code>inList</code> operation is actually used. If the actual value is <code>null</code> then <code>isNull</code> operation is used. For other types, <code>eq</code> operation is used. For sort keys, <code>eq</code> operation is always used.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For more complex queries you can use <code>@Query</code> annotation with a class implementing <code>QueryFunction</code> interface:</p>
</div>
<div class="listingblock primary">
<div class="title">Groovy (AWS SDK 2.x)</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="groovy">import static com.agorapulse.micronaut.amazon.awssdk.dynamodb.groovy.GroovyBuilders.*   <i class="conum" data-value="1"></i><b>(1)</b>

@Service(DynamoDBEntity)                                                                <i class="conum" data-value="2"></i><b>(2)</b>
interface DynamoDBItemDBService {

    @Query({                                                                            <i class="conum" data-value="3"></i><b>(3)</b>
        query(DynamoDBEntity) {
            partitionKey hashKey                                                        <i class="conum" data-value="4"></i><b>(4)</b>
            index DynamoDBEntity.RANGE_INDEX
            range {
                eq rangeKey                                                             <i class="conum" data-value="5"></i><b>(5)</b>
            }
            only {                                                                      <i class="conum" data-value="6"></i><b>(6)</b>
                rangeIndex                                                              <i class="conum" data-value="7"></i><b>(7)</b>
            }
        }
    })
    Publisher&lt;DynamoDBEntity&gt; queryByRangeIndex(String hashKey, String rangeKey)        <i class="conum" data-value="8"></i><b>(8)</b>

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>GroovyBuilders</code> class provides all necessary factory methods and keywords</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Annotate an interface with <code>@Service</code> with the type of the entity as its <code>value</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>@Query</code> annotation accepts a closure which returns a query builder (see <a href="https://agorapulse.github.io/micronaut-aws-sdk/api/com/agorapulse/micronaut/aws/dynamodb/builder/QueryBuilder.html">QueryBuilder</a> for full reference)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Specify a partition key with <code>partitionKey</code> method and method&#8217;s <code>hashKey</code> argument</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Specify some range key criteria with the method&#8217;s <code>rangeKey</code> argument (see <a href="https://agorapulse.github.io/micronaut-aws-sdk/api/com/agorapulse/micronaut/aws/dynamodb/builder/RangeConditionCollector.html">RangeConditionCollector</a> for full reference)</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>You can limit which properties are returned from the query</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Only <code>rangeIndex</code> property will be populated in the entities returned</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>The arguments have no special meaning but you can use them in the query. The method must return either <code>Publisher</code>, <code>Stream</code> or <code>Iterable</code> of entities.</td>
</tr>
</table>
</div>
<div class="listingblock secondary">
<div class="title">Java</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="java">@Service(value = DynamoDBEntity.class, tableName = "${test.table.name:DynamoDBJava}")   <i class="conum" data-value="1"></i><b>(1)</b>
public interface DynamoDBEntityService {

    class EqRangeProjection implements QueryFunction&lt;DynamoDBEntity&gt; {                  <i class="conum" data-value="2"></i><b>(2)</b>

        public QueryBuilder&lt;DynamoDBEntity&gt; query(Map&lt;String, Object&gt; arguments) {
            return builder().partitionKey(arguments.get("hashKey"))                     <i class="conum" data-value="3"></i><b>(3)</b>
                .index(DynamoDBEntity.RANGE_INDEX)
                .sortKey(r -&gt;
                    r.eq(arguments.get("rangeKey"))                                     <i class="conum" data-value="4"></i><b>(4)</b>
                )
                .only(DynamoDBEntity.RANGE_INDEX);                                      <i class="conum" data-value="5"></i><b>(5)</b>
        }
    }

    @Query(EqRangeProjection.class)                                                     <i class="conum" data-value="6"></i><b>(6)</b>
    Publisher&lt;DynamoDBEntity&gt; queryByRangeIndex(String hashKey, String rangeKey);       <i class="conum" data-value="7"></i><b>(7)</b>

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate an interface with <code>@Service</code> with the type of the entity as its <code>value</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Define class which implements <code>QueryFunction</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Specify a partition key with <code>partitionKey</code> method and method&#8217;s <code>hashKey</code> argument</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Specify some range key criteria with the method&#8217;s <code>rangeKey</code> argument (see <a href="https://agorapulse.github.io/micronaut-aws-sdk/api/com/agorapulse/micronaut/aws/dynamodb/builder/RangeConditionCollector.html">RangeConditionCollector</a> for full reference)</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Only <code>rangeIndex</code> property will be populated in the entities returned</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td><code>@Query</code> annotation accepts a class which implements <code>Function&lt;Map&lt;String, Object&gt;, DetachedQuery&gt;</code></td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>The arguments have no special meaning but you can use them in the query using <code>arguments</code> map. The method must return either <code>Publisher</code>, <code>Stream</code> or <code>List</code> of entities.</td>
</tr>
</table>
</div>
<div class="listingblock secondary">
<div class="title">Kotlin</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="kotlin">@Service(value = DynamoDBEntity::class, tableName = "DynamoDBJava")                     <i class="conum" data-value="1"></i><b>(1)</b>
interface DynamoDBEntityService {

    class EqRangeProjection : QueryFunction&lt;DynamoDBEntity&gt;({ args: Map&lt;String, Any&gt; -&gt; <i class="conum" data-value="2"></i><b>(2)</b>
        partitionKey(args["hashKey"]) <i class="conum" data-value="3"></i><b>(3)</b>
        index(DynamoDBEntity.RANGE_INDEX)
        sortKey { eq(args["rangeKey"]) } <i class="conum" data-value="4"></i><b>(4)</b>
        only(DynamoDBEntity.RANGE_INDEX) <i class="conum" data-value="5"></i><b>(5)</b>
    })


    @Query(EqRangeProjection::class)                                                    <i class="conum" data-value="6"></i><b>(6)</b>
    fun queryByRangeIndex(hashKey: String, rangeKey: String): Publisher&lt;DynamoDBEntity&gt; <i class="conum" data-value="7"></i><b>(7)</b>


}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate an interface with <code>@Service</code> with the type of the entity as its <code>value</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Create class that extends <code>com.agorapulse.micronaut.amazon.awssdk.dynamodb.kotlin.QueryFunction</code> and use the DSL constructor</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Specify a partition key with <code>partitionKey</code> method and method&#8217;s <code>hashKey</code> argument</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Specify some range key criteria with the method&#8217;s <code>rangeKey</code> argument (see <a href="https://agorapulse.github.io/micronaut-aws-sdk/api/com/agorapulse/micronaut/aws/dynamodb/builder/RangeConditionCollector.html">RangeConditionCollector</a> for full reference)</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Only <code>rangeIndex</code> property will be populated in the entities returned</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td><code>@Query</code> annotation accepts a class which implements <code>Function&lt;Map&lt;String, Object&gt;, DetachedQuery&gt;</code></td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>The arguments have no special meaning but you can use them in the query using <code>arguments</code> map. The method must return either <code>Publisher</code>, <code>Stream</code> or <code>List</code> of entities.</td>
</tr>
</table>
</div>
<div class="listingblock secondary">
<div class="title">Groovy  (AWS SDK 1.x)</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="groovy">import static com.agorapulse.micronaut.aws.dynamodb.builder.Builders.*                  <i class="conum" data-value="1"></i><b>(1)</b>

@Service(DynamoDBEntity)                                                                <i class="conum" data-value="2"></i><b>(2)</b>
interface DynamoDBItemDBService {

    @Query({                                                                            <i class="conum" data-value="3"></i><b>(3)</b>
        query(DynamoDBEntity) {
            hash hashKey                                                                <i class="conum" data-value="4"></i><b>(4)</b>
            range {
                eq DynamoDBEntity.RANGE_INDEX, rangeKey                                 <i class="conum" data-value="5"></i><b>(5)</b>
            }
            only {                                                                      <i class="conum" data-value="6"></i><b>(6)</b>
                rangeIndex                                                              <i class="conum" data-value="7"></i><b>(7)</b>
            }
        }
    })
    Publisher&lt;DynamoDBEntity&gt; queryByRangeIndex(String hashKey, String rangeKey)        <i class="conum" data-value="8"></i><b>(8)</b>

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>Builders</code> class provides all necessary factory methods and keywords</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Annotate an interface with <code>@Service</code> with the type of the entity as its <code>value</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>@Query</code> annotation accepts a closure which returns a query builder (see <a href="https://agorapulse.github.io/micronaut-aws-sdk/api/com/agorapulse/micronaut/aws/dynamodb/builder/QueryBuilder.html">QueryBuilder</a> for full reference)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Specify a partition key with <code>partitionKey</code> method and method&#8217;s <code>hashKey</code> argument</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Specify some range key criteria with the method&#8217;s <code>rangeKey</code> argument (see <a href="https://agorapulse.github.io/micronaut-aws-sdk/api/com/agorapulse/micronaut/aws/dynamodb/builder/RangeConditionCollector.html">RangeConditionCollector</a> for full reference)</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>You can limit which properties are returned from the query</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Only <code>rangeIndex</code> property will be populated in the entities returned</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>The arguments have no special meaning but you can use them in the query. The method must return either <code>Publisher</code>, <code>Stream</code> or <code>List</code> of entities.</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_scanning"><a class="anchor" href="#_scanning"></a>Scanning</h6>
<div class="paragraph">
<p>DynamoDB integration does not support feature known as <a href="http://gorm.grails.org/6.0.x/hibernate/manual/index.html#finders"><em>dynamic finders</em></a>.
If you need to scan the table by unindexed attributes you can annotate any method with <code>@Scan</code> annotation to make it</p>
</div>
<div class="ulist">
<ul>
<li>
<p>counting method if its name begins with <code>count</code></p>
</li>
<li>
<p>otherwise an advanced query method</p>
</li>
</ul>
</div>
<div class="listingblock primary">
<div class="title">Groovy (AWS SDK 2.x)</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="groovy">import static com.agorapulse.micronaut.amazon.awssdk.dynamodb.groovy.GroovyBuilders.*   <i class="conum" data-value="1"></i><b>(1)</b>


@Service(DynamoDBEntity)                                                                <i class="conum" data-value="2"></i><b>(2)</b>
interface DynamoDBItemDBService {


    @Scan({                                                                             <i class="conum" data-value="3"></i><b>(3)</b>
        scan(DynamoDBEntity) {
            filter {
                eq DynamoDBEntity.RANGE_INDEX, foo                                      <i class="conum" data-value="4"></i><b>(4)</b>
            }
            only {
                rangeIndex
            }
        }
    })
    Publisher&lt;DynamoDBEntity&gt; scanAllByRangeIndex(String foo)                           <i class="conum" data-value="5"></i><b>(5)</b>


}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>GroovyBuilders</code> class provides all necessary factory methods and keywords</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Annotate an interface with <code>@Service</code> with the type of the entity as its <code>value</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>@Scan</code> annotation accepts a closure which returns a scan builder (see <a href="https://agorapulse.github.io/micronaut-aws-sdk/api/com/agorapulse/micronaut/aws/dynamodb/builder/ScanBuilder.html">ScanBuilder</a> for full reference)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Specify some filter criteria with the method&#8217;s <code>foo</code> argument (see <a href="https://agorapulse.github.io/micronaut-aws-sdk/api/com/agorapulse/micronaut/aws/dynamodb/builder/RangeConditionCollector.html">RangeConditionCollector</a> for full reference)</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The arguments have no special meaning but you can use them in the scan definition. The method must return either <code>Publisher</code>, <code>Stream</code> or <code>List</code> of entities.</td>
</tr>
</table>
</div>
<div class="listingblock secondary">
<div class="title">Java</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="java">@Service(value = DynamoDBEntity.class, tableName = "${test.table.name:DynamoDBJava}")   <i class="conum" data-value="1"></i><b>(1)</b>
public interface DynamoDBEntityService {

    class EqRangeScan implements ScanFunction&lt;DynamoDBEntity&gt; {                         <i class="conum" data-value="2"></i><b>(2)</b>

        @Override
        public ScanBuilder&lt;DynamoDBEntity&gt; scan(Map&lt;String, Object&gt;  args) {
            return builder().filter(f -&gt;
                f.eq(DynamoDBEntity.RANGE_INDEX, args.get("foo"))                       <i class="conum" data-value="3"></i><b>(3)</b>
            );
        }

    }

    @Scan(EqRangeScan.class)                                                            <i class="conum" data-value="4"></i><b>(4)</b>
    Publisher&lt;DynamoDBEntity&gt; scanAllByRangeIndex(String foo);                          <i class="conum" data-value="5"></i><b>(5)</b>

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate an interface with <code>@Service</code> with the type of the entity as its <code>value</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Define class which implements <code>ScanFunction</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Specify some filter criteria with the method&#8217;s <code>foo</code> argument (see <a href="https://agorapulse.github.io/micronaut-aws-sdk/api/com/agorapulse/micronaut/aws/dynamodb/builder/RangeConditionCollector.html">RangeConditionCollector</a> for full reference)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>@Scan</code> annotation accepts a class which implements <code>Function&lt;Map&lt;String, Object&gt;, DetachedScan&gt;</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The arguments have no special meaning but you can use them in the scan definition. The method must return either <code>Publisher</code>, <code>Stream</code> or <code>List</code> of entities.</td>
</tr>
</table>
</div>
<div class="listingblock secondary">
<div class="title">Kotlin</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="kotlin">@Service(value = DynamoDBEntity::class, tableName = "DynamoDBJava")                     <i class="conum" data-value="1"></i><b>(1)</b>
interface DynamoDBEntityService {

    class EqRangeScan : ScanFunction&lt;DynamoDBEntity&gt;({ args: Map&lt;String, Any&gt; -&gt;        <i class="conum" data-value="2"></i><b>(2)</b>
        filter {
            eq(DynamoDBEntity.RANGE_INDEX, args["foo"])                                 <i class="conum" data-value="3"></i><b>(3)</b>
        }

    })


    @Scan(EqRangeScan::class)                                                           <i class="conum" data-value="4"></i><b>(4)</b>
    fun scanAllByRangeIndex(foo: String): Publisher&lt;DynamoDBEntity&gt;                     <i class="conum" data-value="5"></i><b>(5)</b>

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate an interface with <code>@Service</code> with the type of the entity as its <code>value</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Define class which implements <code>ScanFunction</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Specify some filter criteria with the method&#8217;s <code>foo</code> argument (see <a href="https://agorapulse.github.io/micronaut-aws-sdk/api/com/agorapulse/micronaut/aws/dynamodb/builder/RangeConditionCollector.html">RangeConditionCollector</a> for full reference)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>@Scan</code> annotation accepts a class which implements <code>Function&lt;Map&lt;String, Object&gt;, DetachedScan&gt;</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The arguments have no special meaning but you can use them in the scan definition. The method must return either <code>Publisher</code>, <code>Stream</code> or <code>List</code> of entities.</td>
</tr>
</table>
</div>
<div class="listingblock secondary">
<div class="title">Groovy  (AWS SDK 1.x)</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="groovy">import static com.agorapulse.micronaut.aws.dynamodb.builder.Builders.*                  <i class="conum" data-value="1"></i><b>(1)</b>


@Service(DynamoDBEntity)                                                                <i class="conum" data-value="2"></i><b>(2)</b>
interface DynamoDBItemDBService {


    @Scan({                                                                             <i class="conum" data-value="3"></i><b>(3)</b>
        scan(DynamoDBEntity) {
            filter {
                eq DynamoDBEntity.RANGE_INDEX, foo                                      <i class="conum" data-value="4"></i><b>(4)</b>
            }
        }
    })
    Publisher&lt;DynamoDBEntity&gt; scanAllByRangeIndex(String foo)                           <i class="conum" data-value="5"></i><b>(5)</b>


}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>Builders</code> class provides all necessary factory methods and keywords</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Annotate an interface with <code>@Service</code> with the type of the entity as its <code>value</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>@Scan</code> annotation accepts a closure which returns a scan builder (see <a href="https://agorapulse.github.io/micronaut-aws-sdk/api/com/agorapulse/micronaut/aws/dynamodb/builder/ScanBuilder.html">ScanBuilder</a> for full reference)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Specify some filter criteria with the method&#8217;s <code>foo</code> argument (see <a href="https://agorapulse.github.io/micronaut-aws-sdk/api/com/agorapulse/micronaut/aws/dynamodb/builder/RangeConditionCollector.html">RangeConditionCollector</a> for full reference)</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The arguments have no special meaning but you can use them in the scan definition. The method must return either <code>Publisher</code>, <code>Stream</code> or <code>List</code> of entities.</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_updates"><a class="anchor" href="#_updates"></a>Updates</h6>
<div class="paragraph">
<p>Declarative services allows you to execute fine-grained updates. Any method annotated with <code>@Update</code> will perform the update in the DynamoDB table.</p>
</div>
<div class="listingblock primary">
<div class="title">Groovy (AWS SDK 2.x)</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="groovy">import static com.agorapulse.micronaut.amazon.awssdk.dynamodb.groovy.GroovyBuilders.*   <i class="conum" data-value="1"></i><b>(1)</b>


@Service(DynamoDBEntity)                                                                <i class="conum" data-value="2"></i><b>(2)</b>
interface DynamoDBItemDBService {


    @Update({                                                                           <i class="conum" data-value="3"></i><b>(3)</b>
        update(DynamoDBEntity) {
            partitionKey hashKey                                                        <i class="conum" data-value="4"></i><b>(4)</b>
            sortKey rangeKey                                                            <i class="conum" data-value="5"></i><b>(5)</b>
            add 'number', 1                                                             <i class="conum" data-value="6"></i><b>(6)</b>
            returnUpdatedNew { number }                                                 <i class="conum" data-value="7"></i><b>(7)</b>
        }
    })
    Number increment(String hashKey, String rangeKey)                                   <i class="conum" data-value="8"></i><b>(8)</b>


}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>Builders</code> class provides all necessary factory methods and keywords</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Annotate an interface with <code>@Service</code> with the type of the entity as its <code>value</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>@Update</code> annotation accepts a closure which returns an update builder (see <a href="https://agorapulse.github.io/micronaut-aws-sdk/api/com/agorapulse/micronaut/aws/dynamodb/builder/UpdateBuilder.html">UpdateBuilder</a> for full reference)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Specify a partition key with <code>partitionKey</code> method and method&#8217;s <code>hashKey</code> argument</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Specify a sort key with <code>sortKey</code> method and method&#8217;s <code>rangeKey</code> argument</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Specify update operation - increment <code>number</code> attribute (see <a href="https://agorapulse.github.io/micronaut-aws-sdk/api/com/agorapulse/micronaut/aws/dynamodb/builder/UpdateBuilder.html">UpdateBuilder</a> for full reference). You may have multiple update operations.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Specify what should be returned from the method (see <a href="https://agorapulse.github.io/micronaut-aws-sdk/api/com/agorapulse/micronaut/aws/dynamodb/builder/UpdateBuilder.html">UpdateBuilder</a> for full reference).</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>The arguments have no special meaning but you can use them in the scan definition. The method&#8217;s return value depends on the value returned from <code>returnUpdatedNew</code> mapper.</td>
</tr>
</table>
</div>
<div class="listingblock secondary">
<div class="title">Java</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="java">@Service(value = DynamoDBEntity.class, tableName = "${test.table.name:DynamoDBJava}")   <i class="conum" data-value="1"></i><b>(1)</b>
public interface DynamoDBEntityService {

    class IncrementNumber implements UpdateFunction&lt;DynamoDBEntity, Integer&gt; {          <i class="conum" data-value="2"></i><b>(2)</b>

        @Override
        public UpdateBuilder&lt;DynamoDBEntity, Integer&gt; update(Map&lt;String, Object&gt; args) {
            return builder().partitionKey(args.get("hashKey"))                          <i class="conum" data-value="3"></i><b>(3)</b>
                .sortKey(args.get("rangeKey"))                                          <i class="conum" data-value="4"></i><b>(4)</b>
                .add("number", 1)                                                       <i class="conum" data-value="5"></i><b>(5)</b>
                .returnUpdatedNew(DynamoDBEntity::getNumber);                           <i class="conum" data-value="6"></i><b>(6)</b>
        }

    }

    @Update(IncrementNumber.class)                                                      <i class="conum" data-value="7"></i><b>(7)</b>
    Number increment(String hashKey, String rangeKey);                                  <i class="conum" data-value="8"></i><b>(8)</b>

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate an interface with <code>@Service</code> with the type of the entity as its <code>value</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Define class which implements <code>Function&lt;Map&lt;String, Object&gt;, DetachedUpdate&gt;</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Specify a partition key with <code>partitionKey</code> method and method&#8217;s <code>hashKey</code> argument</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Specify a sort key with <code>sortKey</code> method and method&#8217;s <code>rangeKey</code> argument</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Specify update operation - increment <code>number</code> attribute (see <a href="https://agorapulse.github.io/micronaut-aws-sdk/api/com/agorapulse/micronaut/aws/dynamodb/builder/UpdateBuilder.html">UpdateBuilder</a> for full reference). You may have multiple update operations.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Specify what should be returned from the method (see <a href="https://agorapulse.github.io/micronaut-aws-sdk/api/com/agorapulse/micronaut/aws/dynamodb/builder/UpdateBuilder.html">UpdateBuilder</a> for full reference).</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td><code>@Update</code> annotation accepts a class which implements <code>Function&lt;Map&lt;String, Object&gt;, DetachedUpdate&gt;</code></td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>The arguments have no special meaning but you can use them in the scan definition. The method&#8217;s return value depends on the value returned from <code>returnUpdatedNew</code> mapper.</td>
</tr>
</table>
</div>
<div class="listingblock secondary">
<div class="title">Kotlin</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="kotlin">@Service(value = DynamoDBEntity::class, tableName = "DynamoDBJava")                     <i class="conum" data-value="1"></i><b>(1)</b>
interface DynamoDBEntityService {

    class IncrementNumber : UpdateFunction&lt;DynamoDBEntity, Int&gt;({ args: Map&lt;String, Any&gt; -&gt;<i class="conum" data-value="2"></i><b>(2)</b>
        partitionKey(args["hashKey"])                                                   <i class="conum" data-value="3"></i><b>(3)</b>
        sortKey(args["rangeKey"])                                                       <i class="conum" data-value="4"></i><b>(4)</b>
        add("number", 1)                                                                <i class="conum" data-value="5"></i><b>(5)</b>
        returnUpdatedNew(DynamoDBEntity::number)                                        <i class="conum" data-value="6"></i><b>(6)</b>
    })


    @Update(IncrementNumber::class)                                                     <i class="conum" data-value="7"></i><b>(7)</b>
    fun increment(hashKey: String, rangeKey: String): Number                            <i class="conum" data-value="8"></i><b>(8)</b>


}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate an interface with <code>@Service</code> with the type of the entity as its <code>value</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Define class which extends <code>com.agorapulse.micronaut.amazon.awssdk.dynamodb.kotlin.UpdateFunction</code> and use the DSL constructor</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Specify a partition key with <code>partitionKey</code> method and method&#8217;s <code>hashKey</code> argument</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Specify a sort key with <code>sortKey</code> method and method&#8217;s <code>rangeKey</code> argument</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Specify update operation - increment <code>number</code> attribute (see <a href="https://agorapulse.github.io/micronaut-aws-sdk/api/com/agorapulse/micronaut/aws/dynamodb/builder/UpdateBuilder.html">UpdateBuilder</a> for full reference). You may have multiple update operations.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Specify what should be returned from the method (see <a href="https://agorapulse.github.io/micronaut-aws-sdk/api/com/agorapulse/micronaut/aws/dynamodb/builder/UpdateBuilder.html">UpdateBuilder</a> for full reference).</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td><code>@Update</code> annotation accepts a class which implements <code>Function&lt;Map&lt;String, Object&gt;, DetachedUpdate&gt;</code></td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>The arguments have no special meaning, but you can use them in the scan definition. The method&#8217;s return value depends on the value returned from <code>returnUpdatedNew</code> mapper.</td>
</tr>
</table>
</div>
<div class="listingblock secondary">
<div class="title">Groovy  (AWS SDK 1.x)</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="groovy">import static com.agorapulse.micronaut.aws.dynamodb.builder.Builders.*                  <i class="conum" data-value="1"></i><b>(1)</b>


@Service(DynamoDBEntity)                                                                <i class="conum" data-value="2"></i><b>(2)</b>
interface DynamoDBItemDBService {


    @Update({                                                                           <i class="conum" data-value="3"></i><b>(3)</b>
        update(DynamoDBEntity) {
            hash hashKey                                                                <i class="conum" data-value="4"></i><b>(4)</b>
            range rangeKey                                                              <i class="conum" data-value="5"></i><b>(5)</b>
            add 'number', 1                                                             <i class="conum" data-value="6"></i><b>(6)</b>
            returnUpdatedNew { number }                                                 <i class="conum" data-value="7"></i><b>(7)</b>
        }
    })
    Number increment(String hashKey, String rangeKey)                                   <i class="conum" data-value="8"></i><b>(8)</b>


}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>Builders</code> class provides all necessary factory methods and keywords</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Annotate an interface with <code>@Service</code> with the type of the entity as its <code>value</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>@Update</code> annotation accepts a closure which returns an update builder (see <a href="https://agorapulse.github.io/micronaut-aws-sdk/api/com/agorapulse/micronaut/aws/dynamodb/builder/UpdateBuilder.html">UpdateBuilder</a> for full reference)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Specify a partition key with <code>partitionKey</code> method and method&#8217;s <code>hashKey</code> argument</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Specify a range key with <code>range</code> method and method&#8217;s <code>rangeKey</code> argument</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Specify update operation - increment <code>number</code> attribute (see <a href="https://agorapulse.github.io/micronaut-aws-sdk/api/com/agorapulse/micronaut/aws/dynamodb/builder/UpdateBuilder.html">UpdateBuilder</a> for full reference). You may have multiple update operations.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Specify what should be returned from the method (see <a href="https://agorapulse.github.io/micronaut-aws-sdk/api/com/agorapulse/micronaut/aws/dynamodb/builder/UpdateBuilder.html">UpdateBuilder</a> for full reference).</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>The arguments have no special meaning but you can use them in the scan definition. The method&#8217;s return value depends on the value returned from <code>returnUpdatedNew</code> mapper.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_dynamodb_service"><a class="anchor" href="#_dynamodb_service"></a>DynamoDB Service</h5>
<div class="paragraph">
<p><code>DynamoDBService</code> provides middle-level API for working with DynamoDB tables and entities. You can obtain instance of <code>DynamoDBService</code> from
<code>DynamoDBServiceProvider</code> which can be injected to any bean.</p>
</div>
<div class="listingblock primary">
<div class="title">Groovy (AWS SDK 2.x)</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="groovy">DynamoDBServiceProvider provider = context.getBean(DynamoDBServiceProvider)
DynamoDBService&lt;DynamoDBEntity&gt; service = provider.findOrCreate(DynamoDBEntity)         <i class="conum" data-value="1"></i><b>(1)</b>

service.createTable()                                                                   <i class="conum" data-value="2"></i><b>(2)</b>

service.save(new DynamoDBEntity(                                                        <i class="conum" data-value="3"></i><b>(3)</b>
    parentId: '1',
    id: '1',
    rangeIndex: 'foo',
    number: 1,
    date: Date.from(REFERENCE_DATE)
))

service.get('1', '1')                                                                   <i class="conum" data-value="4"></i><b>(4)</b>

service.query {                                                                         <i class="conum" data-value="5"></i><b>(5)</b>
    partitionKey '1'
    index DynamoDBEntity.DATE_INDEX
    range { between from, to }
}

service.update {                                                                        <i class="conum" data-value="6"></i><b>(6)</b>
    partitionKey '1001'
    sortKey '1'
    add 'number', 13
    returns allNew
}

service.delete('1001', '1')                                                             <i class="conum" data-value="7"></i><b>(7)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Obtain the instance of <code>DynamoDBService</code> from <code>DynamoDBServiceProvider</code> (provider can be injected)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Create table for the entity</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Save an entity</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Load the entity by its hash and range keys</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Query the table for entities with given range index value</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Increment a property for entity specified by hash and range keys</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Delete an entity</td>
</tr>
</table>
</div>
<div class="listingblock secondary">
<div class="title">Java (AWS SDK 2.x)</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="java">DynamoDBServiceProvider provider = context.getBean(DynamoDBServiceProvider);
DynamoDBService&lt;DynamoDBEntity&gt; service = provider.findOrCreate(DynamoDBEntity.class);  <i class="conum" data-value="1"></i><b>(1)</b>

service.createTable();                                                                  <i class="conum" data-value="2"></i><b>(2)</b>

DynamoDBEntity entity = new DynamoDBEntity();
entity.setParentId("1");
entity.setId("1");
entity.setRangeIndex("foo");
entity.setNumber(1);
entity.setDate(new Date());
service.save(entity);                                                                   <i class="conum" data-value="3"></i><b>(3)</b>

service.get("1", "1");                                                                  <i class="conum" data-value="4"></i><b>(4)</b>

service.query(query -&gt;                                                                  <i class="conum" data-value="5"></i><b>(5)</b>
    query.partitionKey("1")
    .index(DynamoDBEntity.DATE_INDEX)
    .range(r -&gt; r.between(from, to))
);

service.update(update -&gt;                                                                <i class="conum" data-value="6"></i><b>(6)</b>
    update.partitionKey("1001")
    .sortKey("1")
    .add("number", 13)
    .returns(ReturnValue.ALL_NEW)
);

service.delete("1001", "1");                                                            <i class="conum" data-value="7"></i><b>(7)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Obtain the instance of <code>DynamoDBService</code> from <code>DynamoDBServiceProvider</code> (provider can be injected)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Create table for the entity</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Save an entity</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Load the entity by its hash and range keys</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Query the table for entities with given range index value</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Increment a property for entity specified by hash and range keys</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Delete an entity</td>
</tr>
</table>
</div>
<div class="listingblock secondary">
<div class="title">Groovy (AWS SDK 1.x)</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="groovy">DynamoDBServiceProvider provider = context.getBean(DynamoDBServiceProvider)
DynamoDBService&lt;DynamoDBEntity&gt; s = provider.findOrCreate(DynamoDBEntity)       <i class="conum" data-value="1"></i><b>(1)</b>

s.createTable()                                                                 <i class="conum" data-value="2"></i><b>(2)</b>

s.save(new DynamoDBEntity(                                                      <i class="conum" data-value="3"></i><b>(3)</b>
    parentId: '1',
    id: '1',
    rangeIndex: 'foo',
    date: REFERENCE_DATE.toDate()
))

s.get('1', '1')                                                                 <i class="conum" data-value="4"></i><b>(4)</b>

s.query('1', DynamoDBEntity.RANGE_INDEX, 'bar').count == 1                      <i class="conum" data-value="5"></i><b>(5)</b>
s.query('1', DynamoDBEntity.RANGE_INDEX, 'bar').count == 1

s.queryByDates('3', DynamoDBEntity.DATE_INDEX, [                                <i class="conum" data-value="6"></i><b>(6)</b>
    after: REFERENCE_DATE.plusDays(9).toDate(),
    before: REFERENCE_DATE.plusDays(20).toDate(),
]).count == 1
s.queryByDates('3', DynamoDBEntity.DATE_INDEX, [
    after: REFERENCE_INSTANT.plus(9, ChronoUnit.DAYS),
    before: REFERENCE_INSTANT.plus(20, ChronoUnit.DAYS),
]).count == 1

s.increment('1', '1', 'number')                                                 <i class="conum" data-value="7"></i><b>(7)</b>

s.delete(s.get('1', '1'))                                                       <i class="conum" data-value="8"></i><b>(8)</b>

s.deleteAll('1', DynamoDBEntity.RANGE_INDEX, 'bar') == 1                        <i class="conum" data-value="9"></i><b>(9)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Obtain the instance of <code>DynamoDBService</code> from <code>DynamoDBServiceProvider</code> (provider can be injected)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Create table for the entity</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Save an entity</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Load the entity by its hash and range keys</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Query the table for entities with given range index value</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Query the table for entities having date between the specified dates</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Increment a property for entity specified by hash and range keys</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Delete an entity by object reference</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Delete all entities with given range index value</td>
</tr>
</table>
</div>
<div class="listingblock secondary">
<div class="title">Java (AWS SDK 1.x)</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="java">DynamoDBService&lt;DynamoDBEntity&gt; s = provider.findOrCreate(DynamoDBEntity.class);<i class="conum" data-value="1"></i><b>(1)</b>

assertNotNull(
    s.createTable(5L, 5L)                                                       <i class="conum" data-value="2"></i><b>(2)</b>
);

assertNotNull(
    s.save(createEntity("1", "1", "foo", REFERENCE_DATE.toDate()))              <i class="conum" data-value="3"></i><b>(3)</b>
);

assertNotNull(
    s.get("1", "1")                                                             <i class="conum" data-value="4"></i><b>(4)</b>
);

assertEquals(1,
    s.query("1", DynamoDBEntity.RANGE_INDEX, "bar").getCount().intValue()        <i class="conum" data-value="5"></i><b>(5)</b>
);

assertEquals(1,
    s.queryByDates(                                                             <i class="conum" data-value="6"></i><b>(6)</b>
        "3",
        DynamoDBEntity.DATE_INDEX,
        REFERENCE_DATE.plusDays(9).toDate(),
        REFERENCE_DATE.plusDays(20).toDate()
    ).getCount().intValue()
);

s.increment("1", "1", "number");                                                <i class="conum" data-value="7"></i><b>(7)</b>

s.delete(s.get("1", "1"));                                                      <i class="conum" data-value="8"></i><b>(8)</b>

assertEquals(1,
    s.deleteAll("1", DynamoDBEntity.RANGE_INDEX, "bar")                         <i class="conum" data-value="9"></i><b>(9)</b>
);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Obtain the instance of <code>DynamoDBService</code> from <code>DynamoDBServiceProvider</code> (provider can be injected)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Create table for the entity</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Save an entity</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Load the entity by its hash and range keys</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Query the table for entities with given range index value</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Query the table for entities having date between the specified dates</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Increment a property for entity specified by hash and range keys</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Delete an entity by object reference</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Delete all entities with given range index value</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Please see  <a href="https://agorapulse.github.io/micronaut-amazon-awssdk/api/com/agorapulse/micronaut/amazon/awssdk/dynamodb/DynamoDBService.html">DynamoDBService</a> (AWS SDK 2.x)
and <a href="https://agorapulse.github.io/micronaut-aws-sdk/api/com/agorapulse/micronaut/aws/dynamodb/DynamoDBService.html">DynamoDBService</a> (AwS SDK 1.x) for full reference.</p>
</div>
</div>
<div class="sect4">
<h5 id="_dynamodb_accelerator_dax"><a class="anchor" href="#_dynamodb_accelerator_dax"></a>DynamoDB Accelerator (DAX)</h5>
<div class="paragraph">
<p>You can simply enable DynamoDB Accelerator by setting the DAX endpoint as <code>aws.dax.endpoint</code> property. Every operation
performed using injected <code>AmazonDynamoDB</code>, <code>IDynamoDBMapper</code> or a data service will be performed against DAX instead of
DynamoDB tables.</p>
</div>
<div class="paragraph">
<p>Please, check <a href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/DAX.consistency.html">DAX and DynamoDB Consistency Models</a>
article to understand the subsequence of using DAX instead of direct DynamoDB operations.</p>
</div>
<div class="paragraph">
<p>Make sure you have set up proper policy to access the DAX cluster. See <a href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/DAX.access-control.html">DAX Access Control</a> for more information.
Following policy allow every DAX operation on any resource. In production, you should constrain the scope to single cluster.</p>
</div>
<div class="listingblock">
<div class="title">DAX Access Policy</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="json">{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "DaxAllowAll",
            "Effect": "Allow",
            "Action": "dax:*",
            "Resource": "*"
        }
    ]
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_testing_2"><a class="anchor" href="#_testing_2"></a>Testing</h5>
<div class="paragraph">
<p>You can very easily mock any of the interfaces and declarative services but if you need close-to-production
DynamoDB integration works well with <a href="https://www.testcontainers.org/">Testcontainers</a> and <a href="https://localstack.cloud/">LocalStack</a> using <code>micronaut-amazon-awssdk-integration-testing</code> module.</p>
</div>
<div class="paragraph">
<p>You need to add following dependencies into your build file:</p>
</div>
<div class="listingblock primary">
<div class="title">Gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code>testImplementation 'com.agorapulse:micronaut-amazon-awssdk-integration-testing:3.3.4'</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Maven</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.agorapulse&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-amazon-awssdk-dynamodb&lt;/artifactId&gt;
    &lt;version&gt;3.3.4&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you can set up your tests like this:</p>
</div>
<div class="listingblock primary">
<div class="title">Groovy</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@MicronautTest                                                                          <i class="conum" data-value="1"></i><b>(1)</b>
class DefaultDynamoDBServiceSpec extends Specification {

    @Inject DynamoDBServiceProvider dynamoDBServiceProvider                             <i class="conum" data-value="2"></i><b>(2)</b>

    DynamoDbService&lt;DynamoDBEntity&gt; dbs

    void setup() {
        dbs = dynamoDBServiceProvider.findOrCreate(DynamoDBEntity)                      <i class="conum" data-value="3"></i><b>(3)</b>
    }

    // test methods

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate the specification with <code>@MicronautTest</code> to let Micronaut handle the application context lifecycle</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use <code>@Inject</code> to let Micronaut inject the beans into your tests</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Create the low-level service using <code>DynamoDBServiceProvider</code></td>
</tr>
</table>
</div>
<div class="listingblock secondary">
<div class="title">Java</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@MicronautTest                                                                          <i class="conum" data-value="1"></i><b>(1)</b>
@Property(name = "test.table.name", value = "DynamoDBDeclarativeJava")
public class DeclarativeServiceTest {

    @Inject DynamoDBServiceProvider provider                                            <i class="conum" data-value="2"></i><b>(2)</b>

    @Test
    public void testSomething() {
        DynamoDBService&lt;DynamoDBEntity&gt; s = provider.findOrCreate(DynamoDBEntity.class);<i class="conum" data-value="3"></i><b>(3)</b>

        // test code
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate the specification with <code>@MicronautTest</code> to let Micronaut handle the application context lifecycle</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use <code>@Inject</code> to let Micronaut inject the beans into your tests</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Create the low-level service using <code>DynamoDBServiceProvider</code></td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can save time creating the new Localstack container by sharing it between the tests.</p>
</div>
<div class="listingblock">
<div class="title">application-test.yml</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="yaml">localstack:
  containers:
    dynamodb:
      image: amazon/dynamodb-local
      tag: 1.20.0
      port: 8000
      shared: true
  services: dynamodb

aws:
    dynamodb:
        create-tables: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively you can use different container than Localstack, for example Amazon DynamoDB Local container.</p>
</div>
<div class="listingblock">
<div class="title">application-test.yml</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="yaml">localstack:
  containers:
    dynamodb:
      image: amazon/dynamodb-local
      tag: 1.20.0
      port: 8000
      shared: true
  services: dynamodb
aws:
  dynamodb:
    create-tables: true</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kinesis"><a class="anchor" href="#_kinesis"></a>1.4. Kinesis</h4>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Amazon Kinesis makes it easy to collect, process, and analyze real-time, streaming data so you can get timely insights and react quickly to new information.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>This library provides three approaches to work with Kinesis streams:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>High-level <a href="#_publishing_with_kinesisclient">Publishing with <code>@KinesisClient</code></a></p>
</li>
<li>
<p>High-level <a href="#_listening_with_kinesislistener">Listening with <code>@KinesisListener</code></a></p>
</li>
<li>
<p>Middle-level <a href="#_kinesis_service">Kinesis Service</a></p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_installation_4"><a class="anchor" href="#_installation_4"></a>Installation</h5>
<div class="listingblock primary">
<div class="title">Gradle (AWS SDK 2.x)</div>
<div class="content">
<pre class="prettyprint highlight"><code>// for Kinesis client
annotationProcessor 'com.agorapulse:micronaut-amazon-awssdk-kinesis-annotation-processor:{project-version
implementation 'com.agorapulse:micronaut-amazon-awssdk-kinesis:3.3.4'

// for Kinesis listener
implementation 'com.agorapulse:micronaut-amazon-awssdk-kinesis-worker:3.3.4'</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Maven (AWS SDK 2.x)</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;!-- for Kinesis client --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.agorapulse&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-amazon-awssdk-kinesis&lt;/artifactId&gt;
    &lt;version&gt;3.3.4&lt;/version&gt;
&lt;/dependency&gt;
&lt;!-- for Kinesis listener --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.agorapulse&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-amazon-awssdk-kinesis-worker&lt;/artifactId&gt;
    &lt;version&gt;3.3.4&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Gradle (AWS SDK 1.x)</div>
<div class="content">
<pre class="prettyprint highlight"><code>// for Kinesis client
annotationProcessor 'com.agorapulse:micronaut-aws-sdk-kinesis-annotation-processor:3.3.4'
implementation 'com.agorapulse:micronaut-aws-sdk-kinesis:3.3.4'
// for Kinesis listener
implementation 'com.agorapulse:micronaut-aws-sdk-kinesis-worker:3.3.4'</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Maven (AWS SDK 1.x)</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;!-- for Kinesis client --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.agorapulse&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-aws-sdk-kinesis&lt;/artifactId&gt;
    &lt;version&gt;3.3.4&lt;/version&gt;
&lt;/dependency&gt;
&lt;!-- for Kinesis listener --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.agorapulse&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-aws-sdk-kinesis-worker&lt;/artifactId&gt;
    &lt;version&gt;3.3.4&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For Kotlin use <code>kapt</code> instead of <code>annotationProcessor</code> configuration.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_configuration"><a class="anchor" href="#_configuration"></a>Configuration</h5>
<div class="paragraph">
<p>You need no configuration at all but some of the configuration may be useful for you.</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="yaml">aws:
  kinesis:
    region: sa-east-1

    # for Kinesis client
    stream: MyStream                                                                    <i class="conum" data-value="1"></i><b>(1)</b>

    streams:                                                                            <i class="conum" data-value="2"></i><b>(2)</b>
      test:                                                                             <i class="conum" data-value="3"></i><b>(3)</b>
        stream: TestStream

    # for Kinesis listener
    application-name: my-application # defaults to micronaut.application.name           <i class="conum" data-value="4"></i><b>(4)</b>
    worker-id: myworker              # defaults to host + UUID                          <i class="conum" data-value="5"></i><b>(5)</b>
    listener:
        stream: IncomingMessages                                                        <i class="conum" data-value="6"></i><b>(6)</b>

    listeners:
      other:                                                                            <i class="conum" data-value="7"></i><b>(7)</b>
        stream: OtherStream</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>You can specify the default stream for <a href="https://agorapulse.github.io/micronaut-aws-sdk/api/com/agorapulse/micronaut/aws/kinesis/KinesisService.html">KinesisService</a> and <code>@KinesisClient</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can define multiple configurations</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Each of the configuration can be access using <code>@Named('test') KinesisService</code> qualifier or you can define the configuration as <code>value</code> of <code>@KinesisClient('test')</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>For Kinesis listeners you should provide application name which default to <code>micronaut.application.name</code> if not present</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>You can also provide the of the Kinesis worker</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>This is the default stream to listen</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>You can listen to the multiple Kinesis stream by declaring the name of the configuration in the annotation such as <code>@KinesisListener("other")</code></td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_publishing_with_kinesisclient"><a class="anchor" href="#_publishing_with_kinesisclient"></a>Publishing with <code>@KinesisClient</code></h5>
<div class="paragraph">
<p>If you place <code>KinesisClient</code> annotation on the interface then methods
matching predefined pattern will be automatically implemented. Every method of <code>KinesisClient</code> puts new records into
the stream.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For AWS SDK 2.x, use packages starting <code>com.agorapulse.micronaut.amazon.awssdk.kinesis</code>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For AWS SDK 1.x, use packages starting <code>com.agorapulse.micronaut.aws.sdk.kinesis</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following example shows many of available method signatures for publishing records:</p>
</div>
<div class="listingblock primary">
<div class="title">Publishing String Records (AWS SDK 2.x)</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="java">@KinesisClient                                                                          <i class="conum" data-value="1"></i><b>(1)</b>
interface DefaultClient {
    void putRecordString(String record);                                                <i class="conum" data-value="2"></i><b>(2)</b>

    PutRecordResponse putRecord(String partitionKey, String record);                    <i class="conum" data-value="3"></i><b>(3)</b>

    void putRecordAnno(@PartitionKey String id, String record);                         <i class="conum" data-value="4"></i><b>(4)</b>

    void putRecord(String partitionKey, String record, String sequenceNumber);          <i class="conum" data-value="5"></i><b>(5)</b>

    void putRecordAnno(                                                                 <i class="conum" data-value="6"></i><b>(6)</b>
        @PartitionKey String id,
        String record,
        @SequenceNumber String sqn
    );

    void putRecordAnnoNumbers(                                                          <i class="conum" data-value="7"></i><b>(7)</b>
        @PartitionKey Long id,
        String record,
        @SequenceNumber int sequenceNumber
    );
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>@KinesisClient</code> annotation makes the interface a Kinesis client</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can put String into the stream with generated UUID as partition key</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>You can user predefined partition key</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>If the name of the argument does not contain word <code>parition</code> then <code>@PartitionKey</code> annotation must to be used</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>You can put String into the stream with predefined partition key and a sequence number</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>If the name of the sequence number argument does not contain word <code>sequence</code> then <code>@SequenceKey</code> annotation must to be used</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>The type of parition key and sequence number does not matter as the value will be always converted to string</td>
</tr>
</table>
</div>
<div class="listingblock secondary">
<div class="title">Publishing String Records (AWS SDK 1.x)</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="java">@KinesisClient                                                                          <i class="conum" data-value="1"></i><b>(1)</b>
interface DefaultClient {
    void putRecordString(String record);                                                <i class="conum" data-value="2"></i><b>(2)</b>

    PutRecordResult putRecord(String partitionKey, String record);                      <i class="conum" data-value="3"></i><b>(3)</b>

    void putRecordAnno(@PartitionKey String id, String record);                         <i class="conum" data-value="4"></i><b>(4)</b>

    void putRecord(String partitionKey, String record, String sequenceNumber);          <i class="conum" data-value="5"></i><b>(5)</b>

    void putRecordAnno(                                                                 <i class="conum" data-value="6"></i><b>(6)</b>
        @PartitionKey String id,
        String record,
        @SequenceNumber String sqn
    );

    void putRecordAnnoNumbers(                                                          <i class="conum" data-value="7"></i><b>(7)</b>
        @PartitionKey Long id,
        String record,
        @SequenceNumber int sequenceNumber
    );
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>@KinesisClient</code> annotation makes the interface a Kinesis client</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can put String into the stream with generated UUID as partition key</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>You can user predefined partition key</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>If the name of the argument does not contain word <code>parition</code> then <code>@PartitionKey</code> annotation must to be used</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>You can put String into the stream with predefined partition key and a sequence number</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>If the name of the sequence number argument does not contain word <code>sequence</code> then <code>@SequenceKey</code> annotation must to be used</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>The type of parition key and sequence number does not matter as the value will be always converted to string</td>
</tr>
</table>
</div>
<div class="listingblock primary">
<div class="title">Publishing Byte Array Records (AWS SDK 2.x)</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="java">@KinesisClient                                                                          <i class="conum" data-value="1"></i><b>(1)</b>
interface DefaultClient {
    void putRecordBytes(byte[] record);                                                 <i class="conum" data-value="2"></i><b>(2)</b>

    void putRecordDataByteArray(@PartitionKey String id, byte[] value);                 <i class="conum" data-value="3"></i><b>(3)</b>

    PutRecordsResponse putRecords(Iterable&lt;PutRecordsRequestEntry&gt; entries);            <i class="conum" data-value="4"></i><b>(4)</b>

    PutRecordsResponse putRecords(PutRecordsRequestEntry... entries);                   <i class="conum" data-value="5"></i><b>(5)</b>

    PutRecordsResponse putRecord(PutRecordsRequestEntry entry);                         <i class="conum" data-value="6"></i><b>(6)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>@KinesisClient</code> annotation makes the interface a Kinesis client</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can put byte array into the stream, UUID as partition key will be generated</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>If the name of the argument does not contain word <code>parition</code> then <code>@PartitionKey</code> annotation must to be used</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>You can put several records wrapped into iterable of <code>PutRecordsRequestEntry</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>You can put several records wrapped into array of <code>PutRecordsRequestEntry</code></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>If the single argument is of type <code>PutRecordsRequestEntry</code> then <code>PutRecordsResult</code> object is returned from the method despite only single record has been published</td>
</tr>
</table>
</div>
<div class="listingblock secondary">
<div class="title">Publishing Byte Array Records (AWS SDK 1.x)</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="java">@KinesisClient                                                                          <i class="conum" data-value="1"></i><b>(1)</b>
interface DefaultClient {
    void putRecordBytes(byte[] record);                                                 <i class="conum" data-value="2"></i><b>(2)</b>

    void putRecordDataByteArray(@PartitionKey String id, byte[] value);                 <i class="conum" data-value="3"></i><b>(3)</b>

    PutRecordsResult putRecords(Iterable&lt;PutRecordsRequestEntry&gt; entries);              <i class="conum" data-value="4"></i><b>(4)</b>

    PutRecordsResult putRecords(PutRecordsRequestEntry... entries);                     <i class="conum" data-value="5"></i><b>(5)</b>

    PutRecordsResult putRecord(PutRecordsRequestEntry entry);                           <i class="conum" data-value="6"></i><b>(6)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>@KinesisClient</code> annotation makes the interface a Kinesis client</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can put byte array into the stream, UUID as partition key will be generated</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>If the name of the argument does not contain word <code>parition</code> then <code>@PartitionKey</code> annotation must to be used</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>You can put several records wrapped into iterable of <code>PutRecordsRequestEntry</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>You can put several records wrapped into array of <code>PutRecordsRequestEntry</code></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>If the single argument is of type <code>PutRecordsRequestEntry</code> then <code>PutRecordsResult</code> object is returned from the method despite only single record has been published</td>
</tr>
</table>
</div>
<div class="listingblock primary">
<div class="title">Publishing Plain Old Java Objects (AWS SDK 2.x)</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="java">@KinesisClient                                                                          <i class="conum" data-value="1"></i><b>(1)</b>
interface DefaultClient {
    void putRecordObject(Pogo pogo);                                                    <i class="conum" data-value="2"></i><b>(2)</b>

    PutRecordsResponse putRecordObjects(Pogo... pogo);                                  <i class="conum" data-value="3"></i><b>(3)</b>

    PutRecordsResponse putRecordObjects(Iterable&lt;Pogo&gt; pogo);                           <i class="conum" data-value="4"></i><b>(4)</b>

    void putRecordDataObject(@PartitionKey String id, Pogo value);                      <i class="conum" data-value="5"></i><b>(5)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>@KinesisClient</code> annotation makes the interface a Kinesis client</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can put any object into the stream, UUID as partition key will be generated, the objects will be serialized to JSON</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>You can put array of any objects into the stream, UUID as partition key will be generated for each record, each object will be serialized to JSON</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>You can put iterable of any objects into the stream, UUID as partition key will be generated for each record, each object will be serialized to JSON</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>You can put any object into the stream with predefined partition key, if the name of the argument does not contain word <code>parition</code> then <code>@PartitionKey</code> annotation must to be used</td>
</tr>
</table>
</div>
<div class="listingblock secondary">
<div class="title">Publishing Plain Old Java Objects (AWS SDK 1.x)</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="java">@KinesisClient                                                                          <i class="conum" data-value="1"></i><b>(1)</b>
interface DefaultClient {
    void putRecordObject(Pogo pogo);                                                    <i class="conum" data-value="2"></i><b>(2)</b>

    PutRecordsResult putRecordObjects(Pogo... pogo);                                    <i class="conum" data-value="3"></i><b>(3)</b>

    PutRecordsResult putRecordObjects(Iterable&lt;Pogo&gt; pogo);                             <i class="conum" data-value="4"></i><b>(4)</b>

    void putRecordDataObject(@PartitionKey String id, Pogo value);                      <i class="conum" data-value="5"></i><b>(5)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>@KinesisClient</code> annotation makes the interface a Kinesis client</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can put any object into the stream, UUID as partition key will be generated, the objects will be serialized to JSON</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>You can put array of any objects into the stream, UUID as partition key will be generated for each record, each object will be serialized to JSON</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>You can put iterable of any objects into the stream, UUID as partition key will be generated for each record, each object will be serialized to JSON</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>You can put any object into the stream with predefined partition key, if the name of the argument does not contain word <code>parition</code> then <code>@PartitionKey</code> annotation must to be used</td>
</tr>
</table>
</div>
<div class="listingblock primary">
<div class="title">Publishing Events (AWS SDK 2.x)</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="java">@KinesisClient                                                                          <i class="conum" data-value="1"></i><b>(1)</b>
interface DefaultClient {
    PutRecordResponse putEvent(MyEvent event);                                          <i class="conum" data-value="2"></i><b>(2)</b>

    PutRecordsResponse putEventsIterable(Iterable&lt;MyEvent&gt; events);                     <i class="conum" data-value="3"></i><b>(3)</b>

    void putEventsArrayNoReturn(MyEvent... events);                                     <i class="conum" data-value="4"></i><b>(4)</b>

    @Stream("OtherStream") PutRecordResponse putEventToStream(MyEvent event);           <i class="conum" data-value="5"></i><b>(5)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>@KinesisClient</code> annotation makes the interface a Kinesis client</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can put object implementing <code>Event</code> into the stream</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>You can put iterable of objects implementing <code>Event</code> into the stream</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>You can put array of objects implementing <code>Event</code> into the stream</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Without any parameters <code>@KinesisClient</code> publishes to default stream of the default configuration but you can change it using <code>@Stream</code> annotation on the method</td>
</tr>
</table>
</div>
<div class="listingblock secondary">
<div class="title">Publishing Events (AWS SDK 1.x)</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="java">@KinesisClient                                                                          <i class="conum" data-value="1"></i><b>(1)</b>
interface DefaultClient {
    PutRecordResult putEvent(MyEvent event);                                            <i class="conum" data-value="2"></i><b>(2)</b>

    PutRecordsResult putEventsIterable(Iterable&lt;MyEvent&gt; events);                       <i class="conum" data-value="3"></i><b>(3)</b>

    void putEventsArrayNoReturn(MyEvent... events);                                     <i class="conum" data-value="4"></i><b>(4)</b>

    @Stream("OtherStream") PutRecordResult putEventToStream(MyEvent event);             <i class="conum" data-value="5"></i><b>(5)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>@KinesisClient</code> annotation makes the interface a Kinesis client</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can put object implementing <code>Event</code> into the stream</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>You can put iterable of objects implementing <code>Event</code> into the stream</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>You can put array of objects implementing <code>Event</code> into the stream</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Without any parameters <code>@KinesisClient</code> publishes to default stream of the default configuration but you can change it using <code>@Stream</code> annotation on the method</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The return value of the method is <code>PutRecordResponse</code> and <code>PutRecordsResponse</code> for AWS SDK 2,x or <code>PutRecordResult</code> or <code>PutRecordsResult</code> for AWS SDK 1.x, but it can be always omitted and replaced with <code>void</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By default, <code>KinesisClient</code> publishes records into the default stream defined by <code>aws.kinesis.stream</code> property.
You can switch to different configuration by changing the <code>value</code> of the annotation such as <code>@KinesisClient("other")</code> or
by setting the <code>stream</code> property of the annotation such as <code>@KinesisClient(stream = "MyStream")</code>. You can change stream
used by particular method using <code>@Stream</code> annotation as mentioned above.</p>
</div>
</div>
<div class="sect4">
<h5 id="_listening_with_kinesislistener"><a class="anchor" href="#_listening_with_kinesislistener"></a>Listening with <code>@KinesisListener</code></h5>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Before you start implementing your service with <code>@KinesisListener</code> you may consider implementing a Lambda function instead.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you place <code>KinesisListener</code> annotation on the method in the bean then the method will be triggered with the new records in the stream.</p>
</div>
<div class="listingblock primary">
<div class="title">Listening to Events (AWS SDK 2.x)</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="java">@Singleton                                                                              <i class="conum" data-value="1"></i><b>(1)</b>
public class KinesisListenerTester {

    @KinesisListener
    public void listenString(String string) {                                           <i class="conum" data-value="2"></i><b>(2)</b>
        String message = "EXECUTED: listenString(" + string + ")";
        logExecution(message);
    }

    @KinesisListener
    public void listenRecord(KinesisClientRecord record) {                              <i class="conum" data-value="3"></i><b>(3)</b>
        logExecution("EXECUTED: listenRecord(" + record + ")");
    }


    @KinesisListener
    public void listenStringRecord(String string, KinesisClientRecord record) {         <i class="conum" data-value="4"></i><b>(4)</b>
        logExecution("EXECUTED: listenStringRecord(" + string + ", " + record + ")");
    }

    @KinesisListener
    public void listenObject(MyEvent event) {                                           <i class="conum" data-value="5"></i><b>(5)</b>
        logExecution("EXECUTED: listenObject(" + event + ")");
    }

    @KinesisListener
    public void listenObjectRecord(MyEvent event, KinesisClientRecord record) {         <i class="conum" data-value="6"></i><b>(6)</b>
        logExecution("EXECUTED: listenObjectRecord(" + event + ", " + record + ")");
    }

    @KinesisListener
    public void listenPogoRecord(Pogo event) {                                          <i class="conum" data-value="7"></i><b>(7)</b>
        logExecution("EXECUTED: listenPogoRecord(" + event + ")");
    }

    public List&lt;String&gt; getExecutions() {
        return executions;
    }

    public void setExecutions(List&lt;String&gt; executions) {
        this.executions = executions;
    }

    private void logExecution(String message) {
        executions.add(message);
        System.err.println(message);
    }

    private List&lt;String&gt; executions = new CopyOnWriteArrayList&lt;&gt;();
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>@KinesisListener</code> method must be declared in a bean, e.g. <code>@Singleton</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can listen to just plain string records</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>You can listen to <code>KinesisClientRecord</code> objects</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>You can listen to both string and <code>KinesisClientRecord</code> objects</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>You can listen to objects implementing <code>Event</code> interface</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>You can listen to both <code>Event</code> and <code>KinesisClientRecord</code> objects</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>You can listen to any object as long as it can be unmarshalled from the record payload</td>
</tr>
</table>
</div>
<div class="listingblock secondsary">
<div class="title">Listening to Events (AWS SDK 1.x)</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="java">@Singleton                                                                              <i class="conum" data-value="1"></i><b>(1)</b>
public class KinesisListenerTester {

    @KinesisListener
    public void listenString(String string) {                                           <i class="conum" data-value="2"></i><b>(2)</b>
        String message = "EXECUTED: listenString(" + string + ")";
        logExecution(message);
    }

    @KinesisListener
    public void listenRecord(Record record) {                                           <i class="conum" data-value="3"></i><b>(3)</b>
        logExecution("EXECUTED: listenRecord(" + record + ")");
    }


    @KinesisListener
    public void listenStringRecord(String string, Record record) {                      <i class="conum" data-value="4"></i><b>(4)</b>
        logExecution("EXECUTED: listenStringRecord(" + string + ", " + record + ")");
    }

    @KinesisListener
    public void listenObject(MyEvent event) {                                           <i class="conum" data-value="5"></i><b>(5)</b>
        logExecution("EXECUTED: listenObject(" + event + ")");
    }

    @KinesisListener
    public void listenObjectRecord(MyEvent event, Record record) {                      <i class="conum" data-value="6"></i><b>(6)</b>
        logExecution("EXECUTED: listenObjectRecord(" + event + ", " + record + ")");
    }

    @KinesisListener
    public void listenPogoRecord(Pogo event) {                                          <i class="conum" data-value="7"></i><b>(7)</b>
        logExecution("EXECUTED: listenPogoRecord(" + event + ")");
    }

    public List&lt;String&gt; getExecutions() {
        return executions;
    }

    public void setExecutions(List&lt;String&gt; executions) {
        this.executions = executions;
    }

    private void logExecution(String message) {
        executions.add(message);
        System.err.println(message);
    }

    private List&lt;String&gt; executions = new CopyOnWriteArrayList&lt;&gt;();
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>@KinesisListener</code> method must be declared in a bean, e.g. <code>@Singleton</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can listen to just plain string records</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>You can listen to <code>Record</code> objects</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>You can listen to both string and <code>Record</code> objects</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>You can listen to objects implementing <code>Event</code> interface</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>You can listen to both <code>Event</code> and <code>Record</code> objects</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>You can listen to any object as long as it can be unmarshalled from the record payload</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can listen to different than default configuration by changing the <code>value</code> of the annotation such as <code>@KinesisListener("other")</code>.</p>
</div>
<div class="paragraph">
<p>Multiple methods in a single application can listen to the same configuration (stream). In that case, every method will be executed with the
incoming payload.</p>
</div>
</div>
<div class="sect4">
<h5 id="_kinesis_service"><a class="anchor" href="#_kinesis_service"></a>Kinesis Service</h5>
<div class="paragraph">
<p><code>KinesisService</code> provides middle-level API for creating, describing, and deleting streams. You can manage shards as well as read records
from particular shards.</p>
</div>
<div class="paragraph">
<p>Instance of <code>KinesisService</code> is created for the default Kinesis configuration and each stream configuration in <code>aws.kinesis.streams</code> map.
You should always use <code>@Named</code> qualifier when injecting <code>KinesisService</code> if you have more than one stream configuration present, e.g. <code>@Named("other") KinesisService otherService</code>.</p>
</div>
<div class="paragraph">
<p>Please, see
<a href="https://agorapulse.github.io/micronaut-amazon-awssdk/api/com/agorapulse/micronaut/amazon/awssdk/kinesis/KinesisService.html">KinesisService for AWS SDK 2.x</a> or
<a href="https://agorapulse.github.io/micronaut-aws-sdk/api/com/agorapulse/micronaut/aws/kinesis/KinesisService.html">KinesisService for AWS SDK 1.x</a>
for the full reference.</p>
</div>
</div>
<div class="sect4">
<h5 id="_testing_3"><a class="anchor" href="#_testing_3"></a>Testing</h5>
<div class="paragraph">
<p>You can very easily mock any of the interfaces and declarative services but if you need close-to-production
DynamoDB integration works well with <a href="https://www.testcontainers.org/">Testcontainers</a> and <a href="https://localstack.cloud/">LocalStack</a> using <code>micronaut-amazon-awssdk-integration-testing</code> module.</p>
</div>
<div class="paragraph">
<p>You need to add following dependencies into your build file:</p>
</div>
<div class="listingblock primary">
<div class="title">Gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code>testImplementation 'com.agorapulse:micronaut-amazon-awssdk-integration-testing:3.3.4'</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Maven</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.agorapulse&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-amazon-awssdk-dynamodb&lt;/artifactId&gt;
    &lt;version&gt;3.3.4&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you can set up your tests like this:</p>
</div>
<div class="listingblock primary">
<div class="title">Groovy</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@MicronautTest                                                                          <i class="conum" data-value="1"></i><b>(1)</b>
class KinesisDemoSpec extends Specification {

    @Inject KinesisService service                                                      <i class="conum" data-value="2"></i><b>(2)</b>

    @Retry
    void 'new default stream'() {
        when:
            CreateStreamResponse stream = service.createStream('NewStream')
        then:
            stream
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate the specification with <code>@MicronautTest</code> to let Micronaut handle the application context lifecycle</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use <code>@Inject</code> to let Micronaut inject the beans into your tests</td>
</tr>
</table>
</div>
<div class="listingblock secondary">
<div class="title">Java</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@MicronautTest                                                                          <i class="conum" data-value="1"></i><b>(1)</b>
public class KinesisJavaDemoTest {

    @Inject KinesisService service;                                                     <i class="conum" data-value="2"></i><b>(2)</b>

    @Test
    public void testJavaService() {
        assertNotNull(service.createStream("TestStream"));
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate the specification with <code>@MicronautTest</code> to let Micronaut handle the application context lifecycle</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use <code>@Inject</code> to let Micronaut inject the beans into your tests</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can save time creating the new Localstack container by sharing it between the tests.</p>
</div>
<div class="listingblock">
<div class="title">application-test.yml</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="yaml">localstack:
  services: kinesis
  shared: true</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_lambda"><a class="anchor" href="#_lambda"></a>1.5. Lambda</h4>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>With AWS Lambda, you can run code without provisioning or managing servers. You pay only for the compute time that you consume—there&#8217;s no charge when your code isn&#8217;t running.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>This library provides support for function invocation using <code>@LambdaClient</code> introduction.</p>
</div>
<div class="sect4">
<h5 id="_installation_5"><a class="anchor" href="#_installation_5"></a>Installation</h5>
<div class="listingblock primary">
<div class="title">Gradle (AWS SDK 2.x)</div>
<div class="content">
<pre class="prettyprint highlight"><code>implementation 'com.agorapulse:micronaut-amazon-awssdk-lambda:3.3.4'</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Maven (AWS SDK 2.x)</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.agorapulse&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-amazon-awssdk-lambda&lt;/artifactId&gt;
    &lt;version&gt;3.3.4&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Gradle (AWS SDK 1.x)</div>
<div class="content">
<pre class="prettyprint highlight"><code>implementation 'com.agorapulse:micronaut-aws-sdk-lambda:3.3.4'</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Maven (AWS SDK 1.x)</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.agorapulse&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-aws-sdk-lambda&lt;/artifactId&gt;
    &lt;version&gt;3.3.4&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_configuration_2"><a class="anchor" href="#_configuration_2"></a>Configuration</h5>
<div class="paragraph">
<p>You can configure the function name in the configuration</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="yaml">aws:
  lambda:
    functions:
      hello:                                                                          <i class="conum" data-value="1"></i><b>(1)</b>
        function: HelloFunction                                                       <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The name of the configuration to be used with the interface such as  <code>@LambdaClient("hello")</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The name of the function to execute</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_invocation_using_lambdaclient"><a class="anchor" href="#_invocation_using_lambdaclient"></a>Invocation using <code>@LambdaClient</code></h5>
<div class="paragraph">
<p>If you place <code>LambdaClient</code> annotation on the interface then any of its methods will invoke the function. Methods that return <code>void</code> will be invoked with <code>Event</code> invocation type - the client won&#8217;t wait until the invocation is finished.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For AWS SDK 2.x, use packages starting <code>com.agorapulse.micronaut.amazon.awssdk.lambda</code>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For AWS SDK 1.x, use packages starting <code>com.agorapulse.micronaut.aws.sdk.lambda</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following example shows typical Lambda client interface:</p>
</div>
<div class="listingblock">
<div class="title">Lambda Client using Configuration</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="java">package com.agorapulse.micronaut.amazon.awssdk.lambda;

import com.agorapulse.micronaut.amazon.awssdk.lambda.annotation.LambdaClient;

@LambdaClient("hello")                                                                  <i class="conum" data-value="1"></i><b>(1)</b>
public interface HelloConfigurationClient {

    HelloResponse hello(String name);                                                   <i class="conum" data-value="2"></i><b>(2)</b>

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This <code>@LambdaClient</code> will be invoked against function defined in <code>aws.lambda.functions.hello.function</code> property</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The function will be invoked with an object containing the property <code>name</code> with the actual argument</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Lambda Client with Body</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="java">package com.agorapulse.micronaut.amazon.awssdk.lambda;

import com.agorapulse.micronaut.amazon.awssdk.lambda.annotation.Body;
import com.agorapulse.micronaut.amazon.awssdk.lambda.annotation.LambdaClient;

@LambdaClient(function = "HelloFunction")                                               <i class="conum" data-value="1"></i><b>(1)</b>
public interface HelloBodyClient {

    HelloResponse hello(@Body HelloRequest request);                                    <i class="conum" data-value="2"></i><b>(2)</b>

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>You can specify the name of the function directly in the annotation using <code>function</code> property</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can use <code>@Body</code> annotation to use the whole argument object as a payload of the function</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_testing_4"><a class="anchor" href="#_testing_4"></a>Testing</h5>
<div class="paragraph">
<p>You can very easily create a Lambda function locally with <a href="https://www.testcontainers.org/">Testcontainers</a> and <a href="https://localstack.cloud/">LocalStack</a> using <code>micronaut-amazon-awssdk-integration-testing</code> module.</p>
</div>
<div class="paragraph">
<p>You need to add following dependencies into your build file:</p>
</div>
<div class="listingblock primary">
<div class="title">Gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code>testImplementation 'com.agorapulse:micronaut-amazon-awssdk-integration-testing:3.3.4'</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Maven</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.agorapulse&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-amazon-awssdk-dynamodb&lt;/artifactId&gt;
    &lt;version&gt;3.3.4&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you can set up your tests like this:</p>
</div>
<div class="listingblock">
<div class="title">Lambda Test</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">package com.agorapulse.micronaut.amazon.awssdk.lambda;

import com.agorapulse.testing.fixt.Fixt;
import io.micronaut.test.extensions.junit5.annotation.MicronautTest;
import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.io.TempDir;
import org.zeroturnaround.zip.ZipUtil;
import software.amazon.awssdk.core.SdkBytes;
import software.amazon.awssdk.services.lambda.LambdaClient;
import software.amazon.awssdk.services.lambda.model.Runtime;

import jakarta.inject.Inject;
import java.io.File;
import java.io.IOException;
import java.io.InputStream;
import java.nio.file.Files;
import java.util.Collections;

@MicronautTest                                                                          <i class="conum" data-value="1"></i><b>(1)</b>
public class HelloClientTest {

    private static final Fixt FIXT = Fixt.create(AbstractClientSpec.class);             <i class="conum" data-value="2"></i><b>(2)</b>

    @TempDir private File tmp;
    @Inject private LambdaClient lambda;                                                <i class="conum" data-value="3"></i><b>(3)</b>
    @Inject private HelloClient client;                                                 <i class="conum" data-value="4"></i><b>(4)</b>

    @BeforeEach
    public void setupSpec() {
        prepareHelloFunction();                                                         <i class="conum" data-value="5"></i><b>(5)</b>
    }

    @Test
    public void invokeFunction() {
        HelloResponse result = client.hello("Vlad");                                    <i class="conum" data-value="6"></i><b>(6)</b>
        Assertions.assertEquals("Hello Vlad", result.getMessage());                     <i class="conum" data-value="7"></i><b>(7)</b>
    }

    private void prepareHelloFunction() {
        boolean alreadyExists = lambda.listFunctions()
            .functions()
            .stream()
            .anyMatch(fn -&gt; "HelloFunction".equals(fn.functionName()));

        if (alreadyExists) {
            return;
        }

        File functionDir = new File(tmp, "HelloFunction");
        functionDir.mkdirs();

        FIXT.copyTo("HelloFunction", functionDir);

        File functionArchive = new File(tmp, "function.zip");
        ZipUtil.pack(functionDir, functionArchive);

        lambda.createFunction(create -&gt; create.functionName("HelloFunction")
            .runtime(Runtime.NODEJS16_X)
            .role("HelloRole")
            .handler("index.handler")
            .environment(e -&gt;
                e.variables(Collections.singletonMap("MICRONAUT_ENVIRONMENTS", "itest"))<i class="conum" data-value="8"></i><b>(8)</b>
            )
            .code(code -&gt; {
                try {
                    InputStream archiveStream = Files.newInputStream(functionArchive.toPath());
                    SdkBytes archiveBytes = SdkBytes.fromInputStream(archiveStream);
                    code.zipFile(archiveBytes);
                } catch (IOException e) {
                    throw new IllegalStateException(
                        "Failed to create function from archive " + functionArchive, e
                    );
                }
            })
            .build());
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate the specification with <code>@MicronautTest</code> to let Micronaut handle the application context lifecycle</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>Fixt</code> is used to organize the function fixture</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>LambdaClient</code> (for v1 <code>AWSLambda</code>) is populated automatically pointing to the Localstack test container</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The function client can be injected as well</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The function is created in Localstack if not present yet</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>The function is invoked</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>The result of the invocation is compared to the expected value</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Set the Micronaut environment for the AWS Lambda function</td>
</tr>
</table>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If your Lambda function under test itself integrates with some other AWS services then you need to set them up in Localstack and set the endpoints correctly to point to the Localstack mocks.</p>
</div>
<div class="listingblock">
<div class="title">application-itest.yml</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="yaml">aws:
  dynamodb:
    endpoint: http://${LOCALSTACK_HOSTNAME}:4566                                        <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use <code>LOCALSTACK_HOSTNAME</code> environment variable to access the DynamoDB mock</td>
</tr>
</table>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can save time creating the new Localstack container by sharing it between the tests.</p>
</div>
<div class="listingblock">
<div class="title">application-test.yml</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="yaml">localstack:
  services: s3
  shared: true
  env:
    DEBUG: 1</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_integration_testing"><a class="anchor" href="#_integration_testing"></a>Integration Testing</h5>
<div class="paragraph">
<p>You can very verify proper serialization and deserialization of the function arguments and results using <code>micronaut-amazon-awssdk-lambda-integration-testing</code> module.</p>
</div>
<div class="paragraph">
<p>You need to add following dependencies into your build file:</p>
</div>
<div class="listingblock primary">
<div class="title">Gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code>testImplementation 'com.agorapulse:micronaut-amazon-awssdk-lambda-integration-testing:3.3.4'</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Maven</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.agorapulse&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-amazon-awssdk-lambda-integration-testing&lt;/artifactId&gt;
    &lt;version&gt;3.3.4&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use the <code>TestAwsLambdaRuntime</code> runner to test the function execution, including the serialization.</p>
</div>
<div class="listingblock primary">
<div class="title">Groovy</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="groovy">import com.fasterxml.jackson.databind.ObjectMapper
import io.micronaut.test.annotation.MockBean
import io.micronaut.test.extensions.spock.annotation.MicronautTest
import jakarta.inject.Inject
import spock.lang.Specification

@MicronautTest                                                                          <i class="conum" data-value="1"></i><b>(1)</b>
class TestAwsLambdaRuntimeSpec extends Specification {

    private static final String RESPONSE_TEXT = 'olleH'
    private static final String REQUEST = '{ "message": "Hello" }'

    @Inject ObjectMapper mapper

    @Inject TestAwsLambdaRuntime aws                                                    <i class="conum" data-value="2"></i><b>(2)</b>

    @MockBean(DefaultSomeService) SomeService someService() {                           <i class="conum" data-value="3"></i><b>(3)</b>
        return Mock(SomeService) {
            transform(_ as String) &gt;&gt; { String msg -&gt; msg.reverse() }
        }
    }

    void 'handle request'() {                                                           <i class="conum" data-value="4"></i><b>(4)</b>
        expect:
            aws.handleRequest(PojoHandler, REQUEST).text == RESPONSE_TEXT
            aws.handleRequest(PojoHandler, new ByteArrayInputStream(REQUEST.bytes)).text == RESPONSE_TEXT

            aws.apply(FunctionHandler, REQUEST).text == RESPONSE_TEXT
            aws.apply(FunctionHandler, new ByteArrayInputStream(REQUEST.bytes)).text == RESPONSE_TEXT

            aws.&lt;Response&gt;invoke(PojoHandler.name, REQUEST).text == RESPONSE_TEXT
            aws.&lt;Response&gt;invoke(PojoHandler.name, new ByteArrayInputStream(REQUEST.bytes)).text == RESPONSE_TEXT

            aws.&lt;Response&gt;invoke(SimpleHandler.name + '::execute', REQUEST).text == RESPONSE_TEXT
            aws.&lt;Response&gt;invoke(SimpleHandler.name + '::execute', REQUEST).text == RESPONSE_TEXT

            mapper.readValue(aws.stream(PojoStreamHandler, REQUEST).toString(), Response).text == RESPONSE_TEXT
            mapper.readValue(aws.stream(PojoStreamHandler, new ByteArrayInputStream(REQUEST.bytes)).toString(), Response).text == RESPONSE_TEXT

            mapper.readValue(aws.stream(PojoStreamHandler.name, REQUEST).toString(), Response).text == RESPONSE_TEXT
            mapper.readValue(aws.stream(PojoStreamHandler.name, new ByteArrayInputStream(REQUEST.bytes)).toString(), Response).text == RESPONSE_TEXT
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use <code>@MicronautTest</code> to let Micronaut handle the application context lifecycle</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Inject the <code>TestAwsLambdaRuntime</code> runner</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Use can mock any services as in any other Micronaut test</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Use one of the methods to execute the function and verify the result</td>
</tr>
</table>
</div>
<div class="listingblock secondary">
<div class="title">Java</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="java">import com.fasterxml.jackson.databind.ObjectMapper;
import io.micronaut.test.annotation.MockBean;
import io.micronaut.test.extensions.junit5.annotation.MicronautTest;
import jakarta.inject.Inject;
import org.junit.jupiter.api.Test;
import org.mockito.Mockito;

import java.io.ByteArrayInputStream;
import java.nio.charset.StandardCharsets;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.mockito.Mockito.when;

@MicronautTest                                                                          <i class="conum" data-value="1"></i><b>(1)</b>
public class TestAwsLambdaRuntimeTest {

    private static final String RESPONSE_TEXT = "olleH";
    private static final String REQUEST = "{ \"message\": \"Hello\" }";

    @Inject ObjectMapper mapper;

    @Inject TestAwsLambdaRuntime aws;                                                   <i class="conum" data-value="2"></i><b>(2)</b>

    @MockBean(DefaultSomeService.class) SomeService someService() {                     <i class="conum" data-value="3"></i><b>(3)</b>
        SomeService mock = Mockito.mock(SomeService.class);
        when(mock.transform("Hello")).thenReturn(RESPONSE_TEXT);
        return mock;
    }

    @Test
    void handleRequest() throws Exception {                                             <i class="conum" data-value="4"></i><b>(4)</b>
        assertEquals(
            RESPONSE_TEXT,
            aws.handleRequest(PojoHandler.class, REQUEST).getText()
        );
        assertEquals(
            RESPONSE_TEXT,
            aws.handleRequest(PojoHandler.class, new ByteArrayInputStream(REQUEST.getBytes(StandardCharsets.UTF_8))).getText()
        );

        assertEquals(
            RESPONSE_TEXT,
            aws.apply(FunctionHandler.class, REQUEST).getText()
        );
        assertEquals(
            RESPONSE_TEXT,
            aws.apply(FunctionHandler.class, new ByteArrayInputStream(REQUEST.getBytes(StandardCharsets.UTF_8))).getText()
        );

        assertEquals(
            RESPONSE_TEXT,
            aws.&lt;Response&gt;invoke(PojoHandler.class.getName(), REQUEST).getText()
        );
        assertEquals(
            RESPONSE_TEXT,
            aws.&lt;Response&gt;invoke(PojoHandler.class.getName(), new ByteArrayInputStream(REQUEST.getBytes(StandardCharsets.UTF_8))).getText()
        );

        assertEquals(
            RESPONSE_TEXT,
            aws.&lt;Response&gt;invoke(SimpleHandler.class.getName() + "::execute", REQUEST).getText()
        );
        assertEquals(
            RESPONSE_TEXT,
            aws.&lt;Response&gt;invoke(SimpleHandler.class.getName() + "::execute", REQUEST).getText()
        );

        assertEquals(
            RESPONSE_TEXT,
            mapper.readValue(aws.stream(PojoStreamHandler.class, REQUEST).toString(), Response.class).getText()
        );
        assertEquals(
            RESPONSE_TEXT,
            mapper.readValue(aws.stream(PojoStreamHandler.class, new ByteArrayInputStream(REQUEST.getBytes(StandardCharsets.UTF_8))).toString(), Response.class).getText()
        );

        assertEquals(
            RESPONSE_TEXT,
            mapper.readValue(aws.stream(PojoStreamHandler.class.getName(), REQUEST).toString(), Response.class).getText()
        );
        assertEquals(
            RESPONSE_TEXT,
            mapper.readValue(aws.stream(PojoStreamHandler.class.getName(), new ByteArrayInputStream(REQUEST.getBytes(StandardCharsets.UTF_8))).toString(), Response.class).getText()
        );

    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use <code>@MicronautTest</code> to let Micronaut handle the application context lifecycle</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Inject the <code>TestAwsLambdaRuntime</code> runner</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Use can mock any services as in any other Micronaut test</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Use one of the methods to execute the function and verify the result</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_simple_storage_service_s3"><a class="anchor" href="#_simple_storage_service_s3"></a>1.6. Simple Storage Service (S3)</h4>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Amazon Simple Storage Service (Amazon S3) is an object storage service that offers industry-leading scalability, data availability, security, and performance.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>This library provides basic support for Amazon S3 using <a href="#_simple_storage_service">Simple Storage Service</a></p>
</div>
<div class="sect4">
<h5 id="_installation_6"><a class="anchor" href="#_installation_6"></a>Installation</h5>
<div class="listingblock primary">
<div class="title">Gradle (AWS SDK 2.x)</div>
<div class="content">
<pre class="prettyprint highlight"><code>implementation 'com.agorapulse:micronaut-amazon-awssdk-s3:3.3.4'</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Maven (AWS SDK 2.x)</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.agorapulse&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-amazon-awssdk-s3&lt;/artifactId&gt;
    &lt;version&gt;3.3.4&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Gradle (AWS SDK 1.x)</div>
<div class="content">
<pre class="prettyprint highlight"><code>implementation 'com.agorapulse:micronaut-aws-sdk-s3:3.3.4'</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Maven (AWS SDK 1.x)</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.agorapulse&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-aws-sdk-s3&lt;/artifactId&gt;
    &lt;version&gt;3.3.4&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_configuration_3"><a class="anchor" href="#_configuration_3"></a>Configuration</h5>
<div class="paragraph">
<p>You can store the name of the bucket in the configuration using <code>aws.s3.bucket</code> property. You can create additional configurations
by providing 'aws.s3.buckets' configuration map.</p>
</div>
<div class="listingblock primary">
<div class="title">application.yml (AWS SDK 2.x)</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="yaml">aws:
  s3:
    region: sa-east-1
    bucket: MyBucket                                                                    <i class="conum" data-value="1"></i><b>(1)</b>
    force-path-style: true                                                              <i class="conum" data-value="2"></i><b>(2)</b>

    buckets:                                                                            <i class="conum" data-value="3"></i><b>(3)</b>
      test:                                                                             <i class="conum" data-value="4"></i><b>(4)</b>
        bucket: TestBucket</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>You can define default bucket for the service</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Force path style URL usage</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>You can define multiple configurations</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Each of the configuration can be access using <code>@Named('test') SimpleStorageService</code> qualifier</td>
</tr>
</table>
</div>
<div class="listingblock secondary">
<div class="title">application.yml (AWS SDK 1.x)</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="yaml">aws:
  s3:
    region: sa-east-1
    bucket: MyBucket                                                                    <i class="conum" data-value="1"></i><b>(1)</b>
    path-style-access-enabled: true                                                     <i class="conum" data-value="2"></i><b>(2)</b>

    buckets:                                                                            <i class="conum" data-value="3"></i><b>(3)</b>
      test:                                                                             <i class="conum" data-value="4"></i><b>(4)</b>
        bucket: TestBucket</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>You can define default bucket for the service</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Force path style URL usage</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>You can define multiple configurations</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Each of the configuration can be access using <code>@Named('test') SimpleStorageService</code> qualifier</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_simple_storage_service"><a class="anchor" href="#_simple_storage_service"></a>Simple Storage Service</h5>
<div class="paragraph">
<p><code>SimpleStorageService</code> provides middle-level API for managing buckets and uploading and downloading files.</p>
</div>
<div class="paragraph">
<p>Instance of <code>SimpleStorageService</code> is created for the default S3 configuration and each bucket configuration in <code>aws.s3.buckets</code> map.
You should always use <code>@Named</code> qualifier when injecting <code>SimpleStorageService</code> if you have more than one bucket configuration present, e.g. <code>@Named("test") SimpleStorageService service</code>.</p>
</div>
<div class="paragraph">
<p>Following example shows some of the most common use cases for working with S3 buckets.</p>
</div>
<div class="listingblock">
<div class="title">Creating Bucket</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="java">service.createBucket(MY_BUCKET);                                                <i class="conum" data-value="1"></i><b>(1)</b>

assertTrue(service.listBucketNames().contains(MY_BUCKET));                      <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create new bucket of given name</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The bucket is present within the list of all bucket names</td>
</tr>
</table>
</div>
<div class="listingblock primary">
<div class="title">Upload File (AWS SDK 2.x)</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="java">File sampleContent = createFileWithSampleContent();

service.storeFile(TEXT_FILE_PATH, sampleContent);                               <i class="conum" data-value="1"></i><b>(1)</b>

assertTrue(service.exists(TEXT_FILE_PATH));                                     <i class="conum" data-value="2"></i><b>(2)</b>

Publisher&lt;S3Object&gt; summaries = service.listObjectSummaries("foo");             <i class="conum" data-value="3"></i><b>(3)</b>
assertEquals(Long.valueOf(0L), Flux.from(summaries).count().block());</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Upload file</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>File is uploaded</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>File is present in the summaries of all files</td>
</tr>
</table>
</div>
<div class="listingblock secondary">
<div class="title">Upload File (AWS SDK 1.x)</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="java">File sampleContent = createFileWithSampleContent();

service.storeFile(TEXT_FILE_PATH, sampleContent);                               <i class="conum" data-value="1"></i><b>(1)</b>

assertTrue(service.exists(TEXT_FILE_PATH));                                     <i class="conum" data-value="2"></i><b>(2)</b>

Publisher&lt;S3ObjectSummary&gt; summaries = service.listObjectSummaries("foo");      <i class="conum" data-value="3"></i><b>(3)</b>
assertEquals(Long.valueOf(0L), Flux.from(summaries).count().block());</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Upload file</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>File is uploaded</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>File is present in the summaries of all files</td>
</tr>
</table>
</div>
<div class="listingblock primary">
<div class="title">Upload from <code>InputStream</code> (AWS SDK 2.x)</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="java">service.storeInputStream(                                                       <i class="conum" data-value="1"></i><b>(1)</b>
    KEY,
    new ByteArrayInputStream(SAMPLE_CONTENT.getBytes()),
    metadata -&gt; {
        metadata.contentLength((long) SAMPLE_CONTENT.length())
            .contentType("text/plain")
            .contentDisposition("bar.baz");
    }
);

Publisher&lt;S3Object&gt; fooSummaries = service.listObjectSummaries("foo");        <i class="conum" data-value="2"></i><b>(2)</b>
assertEquals(KEY, Flux.from(fooSummaries).blockFirst().key());</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Upload data from stream</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Stream is uploaded</td>
</tr>
</table>
</div>
<div class="listingblock secondary">
<div class="title">Upload from <code>InputStream</code> (AWS SDK 1.x)</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="java">service.storeInputStream(                                                       <i class="conum" data-value="1"></i><b>(1)</b>
    KEY,
    new ByteArrayInputStream(SAMPLE_CONTENT.getBytes()),
    buildMetadata()
);

Publisher&lt;S3ObjectSummary&gt; fooSummaries = service.listObjectSummaries("foo");   <i class="conum" data-value="2"></i><b>(2)</b>
assertEquals(KEY, Flux.from(fooSummaries).blockFirst().getKey());</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Upload data from stream</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Stream is uploaded</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Generate URL</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="java">String url = service.generatePresignedUrl(KEY, TOMORROW);                       <i class="conum" data-value="1"></i><b>(1)</b>

assertEquals(SAMPLE_CONTENT, download(url));                                    <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Generate presigned URL</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Downloaded content corresponds with the expected content</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Download File</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="java">File file = new File(tmp, "bar.baz");                                           <i class="conum" data-value="1"></i><b>(1)</b>

service.getFile(KEY, file);                                                     <i class="conum" data-value="2"></i><b>(2)</b>
assertTrue(file.exists());

assertEquals(SAMPLE_CONTENT, new String(Files.readAllBytes(Paths.get(file.toURI()))));</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Prepare a destination file</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Download the file locally</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Delete File</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="java">service.deleteFile(TEXT_FILE_PATH);                                             <i class="conum" data-value="1"></i><b>(1)</b>
assertFalse(service.exists(TEXT_FILE_PATH));                                    <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Delete file</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The file is no longer present</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Delete Bucket</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="java">service.deleteBucket();                                                         <i class="conum" data-value="1"></i><b>(1)</b>
assertFalse(service.listBucketNames().contains(MY_BUCKET));                     <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Delete bucket</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The Bucket is no longer present</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Please, see
<a href="https://agorapulse.github.io/micronaut-aws-sdk/api/com/agorapulse/micronaut/amazon/awssdk/s3/SimpleStorageService.html">SimpleStorageService AWS SDK 2.x</a> or
<a href="https://agorapulse.github.io/micronaut-aws-sdk/api/com/agorapulse/micronaut/aws/s3/SimpleStorageService.html">SimpleStorageService AWS SDK 1.x</a> for the full reference.</p>
</div>
</div>
<div class="sect4">
<h5 id="_testing_5"><a class="anchor" href="#_testing_5"></a>Testing</h5>
<div class="paragraph">
<p>You can very easily mock any of the interfaces and declarative services but if you need close-to-production
DynamoDB integration works well with <a href="https://www.testcontainers.org/">Testcontainers</a> and <a href="https://localstack.cloud/">LocalStack</a> using <code>micronaut-amazon-awssdk-integration-testing</code> module.</p>
</div>
<div class="paragraph">
<p>You need to add following dependencies into your build file:</p>
</div>
<div class="listingblock primary">
<div class="title">Gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code>testImplementation 'com.agorapulse:micronaut-amazon-awssdk-integration-testing:3.3.4'</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Maven</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.agorapulse&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-amazon-awssdk-dynamodb&lt;/artifactId&gt;
    &lt;version&gt;3.3.4&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you can set up your tests like this:</p>
</div>
<div class="listingblock primary">
<div class="title">Groovy</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@MicronautTest                                                                          <i class="conum" data-value="1"></i><b>(1)</b>
@Property(name = 'aws.s3.bucket', value = MY_BUCKET)                                    <i class="conum" data-value="2"></i><b>(2)</b>
class SimpleStorageServiceSpec extends Specification {

    @Inject SimpleStorageService service                                                <i class="conum" data-value="3"></i><b>(3)</b>

    // test methods

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate the specification with <code>@MicronautTest</code> to let Micronaut handle the application context lifecycle</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Annotate the specification with <code>@Property</code> to set the required Micronaut properties</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Use <code>@Inject</code> to let Micronaut inject the beans into your tests</td>
</tr>
</table>
</div>
<div class="listingblock secondary">
<div class="title">Java</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@MicronautTest                                                                          <i class="conum" data-value="1"></i><b>(1)</b>
@Property(name = "aws.s3.bucket", value = SimpleStorageServiceTest.MY_BUCKET)           <i class="conum" data-value="2"></i><b>(2)</b>
public class SimpleStorageServiceTest {

    @Inject SimpleStorageService service;                                               <i class="conum" data-value="3"></i><b>(3)</b>

    // test methods

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate the specification with <code>@MicronautTest</code> to let Micronaut handle the application context lifecycle</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Annotate the specification with <code>@Property</code> to set the required Micronaut properties</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Use <code>@Inject</code> to let Micronaut inject the beans into your tests</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can save time creating the new Localstack container by sharing it between the tests.</p>
</div>
<div class="listingblock">
<div class="title">application-test.yml</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="yaml">localstack:
  services: s3
  shared: true
  env:
    DEBUG: 1</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_simple_email_service_ses"><a class="anchor" href="#_simple_email_service_ses"></a>1.7. Simple Email Service (SES)</h4>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Amazon Simple Email Service (Amazon SES) is a cloud-based email sending service designed to help digital marketers and application developers send marketing, notification, and transactional emails. It is a reliable, cost-effective service for businesses of all sizes that use email to keep in contact with their customers.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>This library provides basic support for Amazon SES using <a href="#_simple_email_service">Simple Email Service</a></p>
</div>
<div class="sect4">
<h5 id="_installation_7"><a class="anchor" href="#_installation_7"></a>Installation</h5>
<div class="listingblock primary">
<div class="title">Gradle (AWS SDK 2.x)</div>
<div class="content">
<pre class="prettyprint highlight"><code>implementation 'com.agorapulse:micronaut-amazon-awssdk-ses:3.3.4'</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Maven (AWS SDK 2.x)</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.agorapulse&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-amazon-awssdk-ses&lt;/artifactId&gt;
    &lt;version&gt;3.3.4&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Gradle (AWS SDK 1.x)</div>
<div class="content">
<pre class="prettyprint highlight"><code>implementation 'com.agorapulse:micronaut-aws-sdk-ses:3.3.4'</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Maven (AWS SDK 1.x)</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.agorapulse&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-aws-sdk-ses&lt;/artifactId&gt;
    &lt;version&gt;3.3.4&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_simple_email_service"><a class="anchor" href="#_simple_email_service"></a>Simple Email Service</h5>
<div class="paragraph">
<p><code>SimpleEmailService</code> provides DSL for creating and sending simple emails with attachments. As the other services,
it uses default credentials chain to obtain the credentials.</p>
</div>
<div class="paragraph">
<p>Following example shows how to send an email with attachment.</p>
</div>
<div class="listingblock primary">
<div class="title">Groovy</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="groovy">EmailDeliveryStatus status = service.send {                                 <i class="conum" data-value="1"></i><b>(1)</b>
    subject 'Hi Paul'                                                       <i class="conum" data-value="2"></i><b>(2)</b>
    from 'subscribe@groovycalamari.com'                                     <i class="conum" data-value="3"></i><b>(3)</b>
    to 'me@sergiodelamo.com'                                                <i class="conum" data-value="4"></i><b>(4)</b>
    htmlBody '&lt;p&gt;This is an example body&lt;/p&gt;'                               <i class="conum" data-value="5"></i><b>(5)</b>
    configurationSetName 'configuration-set'                                <i class="conum" data-value="6"></i><b>(6)</b>
    tags mapOfTags                                                          <i class="conum" data-value="7"></i><b>(7)</b>
    attachment {                                                            <i class="conum" data-value="8"></i><b>(8)</b>
        filepath thePath                                                    <i class="conum" data-value="9"></i><b>(9)</b>
        filename 'test.pdf'                                                 <i class="conum" data-value="10"></i><b>(10)</b>
        mimeType 'application/pdf'                                          <i class="conum" data-value="11"></i><b>(11)</b>
        description 'An example pdf'                                        <i class="conum" data-value="12"></i><b>(12)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Start building an email</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Define subject of the email</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Define the from address</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Define one or more recipients</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Define HTML body (alternatively you can declare plain text body as well)</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Define configuration set for the email (<a href="https://docs.aws.amazon.com/ses/latest/dg/using-configuration-sets.html" class="bare">https://docs.aws.amazon.com/ses/latest/dg/using-configuration-sets.html</a>)</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Define tags for the email, they will be included in SES events</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Build an attachment</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Define the location of the file to be sent</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>Define the file name (optional - deduced from the file)</td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b>11</b></td>
<td>Define the mime type (usually optional - deduced from the file)</td>
</tr>
<tr>
<td><i class="conum" data-value="12"></i><b>12</b></td>
<td>Define the description of the file (optional)</td>
</tr>
</table>
</div>
<div class="listingblock secondary">
<div class="title">Java</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="java">EmailDeliveryStatus status = service.send(e -&gt;                                  <i class="conum" data-value="1"></i><b>(1)</b>
    e.subject("Hi Paul")                                                        <i class="conum" data-value="2"></i><b>(2)</b>
        .from("subscribe@groovycalamari.com")                                   <i class="conum" data-value="3"></i><b>(3)</b>
        .to("me@sergiodelamo.com")                                              <i class="conum" data-value="4"></i><b>(4)</b>
        .htmlBody("&lt;p&gt;This is an example body&lt;/p&gt;")                             <i class="conum" data-value="5"></i><b>(5)</b>
        .configurationSetName("configuration-set")                              <i class="conum" data-value="6"></i><b>(6)</b>
        .tags(mapOfTags)                                                        <i class="conum" data-value="7"></i><b>(7)</b>
        .attachment(a -&gt;                                                        <i class="conum" data-value="8"></i><b>(8)</b>
            a.filepath(filepath)                                                <i class="conum" data-value="9"></i><b>(9)</b>
                .filename("test.pdf")                                           <i class="conum" data-value="10"></i><b>(10)</b>
                .mimeType("application/pdf")                                    <i class="conum" data-value="11"></i><b>(11)</b>
                .description("An example pdf")                                  <i class="conum" data-value="12"></i><b>(12)</b>
        )
);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Start building an email</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Define subject of the email</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Define the from address</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Define one or more recipients</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Define HTML body (alternatively you can declare plain text body as well)</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Define configuration set for the email (<a href="https://docs.aws.amazon.com/ses/latest/dg/using-configuration-sets.html" class="bare">https://docs.aws.amazon.com/ses/latest/dg/using-configuration-sets.html</a>)</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Define tags for the email, they will be included in SES events</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Build an attachment</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Define the location of the file to be sent</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>Define the file name (optional - deduced from the file)</td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b>11</b></td>
<td>Define the mime type (usually optional - deduced from the file)</td>
</tr>
<tr>
<td><i class="conum" data-value="12"></i><b>12</b></td>
<td>Define the description of the file (optional)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Please, see
<a href="https://agorapulse.github.io/micronaut-aws-sdk/api/com/agorapulse/micronaut/amazon/awsses/SimpleEmailService.html">SimpleEmailService AWS SDK 2.x</a>
or
<a href="https://agorapulse.github.io/micronaut-aws-sdk/api/com/agorapulse/micronaut/aws/ses/SimpleEmailService.html">SimpleEmailService AWS SDK 1.x</a>
for the full reference.</p>
</div>
</div>
<div class="sect4">
<h5 id="_configuration_4"><a class="anchor" href="#_configuration_4"></a>Configuration</h5>
<div class="paragraph">
<p>You can configure the SES client using <code>aws.ses</code> prefix in your <code>application.yml</code> file.
Use <code>aws.ses.use-base64-encoding-for-multipart-emails</code> to enable base64 encoding for HTML body of multipart emails.</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="yaml">aws:
    ses:
        use-base64-encoding-for-multipart-emails: true</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_testing_6"><a class="anchor" href="#_testing_6"></a>Testing</h5>
<div class="paragraph">
<p>It is recommended just to mock the <code>SimpleEmailService</code> in your tests as it only contains single abstract method.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_simple_notification_service_sns"><a class="anchor" href="#_simple_notification_service_sns"></a>1.8. Simple Notification Service (SNS)</h4>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Amazon Simple Notification Service (SNS) is a highly available, durable, secure, fully managed pub/sub messaging service that enables you to decouple microservices, distributed systems, and serverless applications.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>This library provides two approaches to work with Simple Notification Service topics:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>High-level <a href="#_publishing_with_notificationclient">Publishing with <code>@NotificationClient</code></a></p>
</li>
<li>
<p>Middle-level <a href="#_simple_notification_service">Simple Notification Service</a></p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_installation_8"><a class="anchor" href="#_installation_8"></a>Installation</h5>
<div class="listingblock primary">
<div class="title">Gradle (AWS SDK 2.x)</div>
<div class="content">
<pre class="prettyprint highlight"><code>annotationProcessor 'com.agorapulse:micronaut-amazon-awssdk-sns-annotation-processor:3.3.4'
implementation 'com.agorapulse:micronaut-amazon-awssdk-sns:3.3.4'</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Maven (AWS SDK 2.x)</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.agorapulse&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-amazon-awssdk-sns&lt;/artifactId&gt;
    &lt;version&gt;3.3.4&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Gradle (AWS SDK 1.x)</div>
<div class="content">
<pre class="prettyprint highlight"><code>annotationProcessor 'com.agorapulse:micronaut-aws-sdk-sns-annotation-processor:3.3.4'
implementation 'com.agorapulse:micronaut-aws-sdk-sns:3.3.4'</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Maven (AWS SDK 1.x)</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.agorapulse&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-aws-sdk-sns&lt;/artifactId&gt;
    &lt;version&gt;3.3.4&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For Kotlin use <code>kapt</code> instead of <code>annotationProcessor</code> configuration.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_configuration_5"><a class="anchor" href="#_configuration_5"></a>Configuration</h5>
<div class="paragraph">
<p>No configuration is required but some of the configuration properties may be useful for you.</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="yaml">aws:
  sns:
    region: sa-east-1
    topic: MyTopic                                                                      <i class="conum" data-value="1"></i><b>(1)</b>
    ios:
      arn: 'arn:aws:sns:eu-west-1:123456789:app/APNS/my-ios-app'                        <i class="conum" data-value="2"></i><b>(2)</b>
    android:
      arn: 'arn:aws:sns:eu-west-1:123456789:app/GCM/my-android-app'                     <i class="conum" data-value="3"></i><b>(3)</b>
    amazon:
      arn: 'arn:aws:sns:eu-west-1:123456789:app/ADM/my-amazon-app'                      <i class="conum" data-value="4"></i><b>(4)</b>


    topics:                                                                             <i class="conum" data-value="5"></i><b>(5)</b>
      test:                                                                             <i class="conum" data-value="6"></i><b>(6)</b>
        topic: TestTopic</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>You can specify the default topic for <a href="https://agorapulse.github.io/micronaut-aws-sdk/api/com/agorapulse/micronaut/aws/sns/SimpleNotificationService.html">SimpleNotificationService</a> and <code>@NotificationClient</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Amazon Resource Name for the iOS application mobile push</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Amazon Resource Name for the Android application mobile push</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Amazon Resource Name for the Amazon application mobile push</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>You can define multiple configurations</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Each of the configuration can be access using <code>@Named('test') SimpleNotificationService</code> qualifier or you can define the configuration as <code>value</code> of <code>@NotificationClient('test')</code></td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_publishing_with_notificationclient"><a class="anchor" href="#_publishing_with_notificationclient"></a>Publishing with <code>@NotificationClient</code></h5>
<div class="paragraph">
<p>If you place <code>NotificationClient</code> annotation on the interface then methods
matching predefined pattern will be automatically implemented. Methods containing word <code>sms</code> will send text messages.
Other methods of <code>NotificationClient</code> will publish new messages into the topic.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For AWS SDK 2.x, use packages starting <code>com.agorapulse.micronaut.amazon.awssdk.sns</code>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For AWS SDK 1.x, use packages starting <code>com.agorapulse.micronaut.aws.sdk.sns</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following example shows many of available method signatures for publishing records:</p>
</div>
<div class="listingblock primary">
<div class="title">Publishing String Records (AWS SDK 2.x)</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="java">package com.agorapulse.micronaut.amazon.awssdk.sns;

import com.agorapulse.micronaut.amazon.awssdk.sns.annotation.MessageDeduplicationId;
import com.agorapulse.micronaut.amazon.awssdk.sns.annotation.MessageGroupId;
import com.agorapulse.micronaut.amazon.awssdk.sns.annotation.NotificationClient;
import com.agorapulse.micronaut.amazon.awssdk.sns.annotation.Topic;

import java.util.Map;

@NotificationClient                                                                             <i class="conum" data-value="1"></i><b>(1)</b>
interface DefaultClient {

    String OTHER_TOPIC = "OtherTopic";

    @Topic("OtherTopic") String publishMessageToDifferentTopic(Pogo pogo);                      <i class="conum" data-value="2"></i><b>(2)</b>

    String publishMessage(Pogo message);                                                        <i class="conum" data-value="3"></i><b>(3)</b>
    String publishMessage(Pogo message, @MessageGroupId String groupId, @MessageDeduplicationId String deduplicationId); <i class="conum" data-value="4"></i><b>(4)</b>
    String publishMessage(String subject, Pogo message);                                        <i class="conum" data-value="5"></i><b>(5)</b>
    String publishMessage(String subject, Pogo message, Map&lt;String, String&gt; attributes);
    String publishMessage(String message);                                                      <i class="conum" data-value="6"></i><b>(6)</b>
    String publishMessage(String subject, String message);
    String publishMessage(String subject, String message, Map&lt;String, String&gt; attributes);

    String sendSMS(String phoneNumber, String message);                                         <i class="conum" data-value="7"></i><b>(7)</b>
    String sendSms(String phoneNumber, String message, Map attributes);                         <i class="conum" data-value="8"></i><b>(8)</b>

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>@NotificationClient</code> annotation makes the interface a SNS client</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can specify to which topic is the message published using <code>@Topic</code> annotation</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>You can publish any object which can be converted into JSON.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>For FIFO Topics the annotations <code>@MessageGroupId</code> and <code>@MessageDeduplicationId</code> can be added on method parameters to forward these attributes when publishing</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>You can add additional subject to published message (only useful for few protocols, e.g. email)</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>You can publish a string message</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>You can send SMS using the word <code>SMS</code> in the name of the method. One argument must be phone number and its name must contain the word <code>number</code></td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>You can provide additional attributes for the SMS message</td>
</tr>
</table>
</div>
<div class="listingblock secondary">
<div class="title">Publishing String Records (AWS SDK 1.x)</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="java">package com.agorapulse.micronaut.aws.sns;

import com.agorapulse.micronaut.aws.sns.annotation.MessageDeduplicationId;
import com.agorapulse.micronaut.aws.sns.annotation.MessageGroupId;
import com.agorapulse.micronaut.aws.sns.annotation.NotificationClient;
import com.agorapulse.micronaut.aws.sns.annotation.Topic;
import java.util.Map;

@NotificationClient                                                                             <i class="conum" data-value="1"></i><b>(1)</b>
interface DefaultClient {

    String OTHER_TOPIC = "OtherTopic";

    @Topic("OtherTopic") String publishMessageToDifferentTopic(Pogo pogo);                      <i class="conum" data-value="2"></i><b>(2)</b>

    String publishMessage(Pogo message);                                                        <i class="conum" data-value="3"></i><b>(3)</b>
    String publishMessage(Pogo message, @MessageGroupId String groupId, @MessageDeduplicationId String deduplicationId); <i class="conum" data-value="4"></i><b>(4)</b>
    String publishMessage(String subject, Pogo message);                                        <i class="conum" data-value="5"></i><b>(5)</b>
    String publishMessage(String subject, Pogo message, Map&lt;String, String&gt; attributes);
    String publishMessage(String message);                                                      <i class="conum" data-value="6"></i><b>(6)</b>
    String publishMessage(String subject, String message);
    String publishMessage(String subject, String message, Map&lt;String, String&gt; attributes);

    String sendSMS(String phoneNumber, String message);                                         <i class="conum" data-value="7"></i><b>(7)</b>
    String sendSms(String phoneNumber, String message, Map attributes);                         <i class="conum" data-value="8"></i><b>(8)</b>

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>@NotificationClient</code> annotation makes the interface a SNS client</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can specify to which topic is the message published using <code>@Topic</code> annotation</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>You can publish any object which can be converted into JSON.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>You can add additional subject to published message (only useful for few protocols, e.g. email)</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>You can publish a string message</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>You can send SMS using the word <code>SMS</code> in the name of the method. One argument must be phone number and its name must contain the word <code>number</code></td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>You can provide additional attributes for the SMS message</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The return value of the methods is message id returned by AWS.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can add <code>Map&lt;String, String&gt; attributes</code> argument to send message attributes.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By default, <code>NotificationClient</code> publishes messages into the default topic defined by <code>aws.sns.topic</code> property.
You can switch to different configuration by changing the <code>value</code> of the annotation such as <code>@NotificationClient("other")</code> or
by setting the <code>topic</code> property of the annotation such as <code>@NotificationClient(topic = "SomeTopic")</code>. You can change topic
used by particular method using <code>@Topic</code> annotation as mentioned above.</p>
</div>
</div>
<div class="sect4">
<h5 id="_simple_notification_service"><a class="anchor" href="#_simple_notification_service"></a>Simple Notification Service</h5>
<div class="paragraph">
<p><code>SimpleNotificationService</code> provides middle-level API for creating, describing, and deleting topics. You can manage applications, endpoints and devices.
You can send messages and notifications.</p>
</div>
<div class="paragraph">
<p>Instance of <code>SimpleNotificationService</code> is created for the default SNS configuration and each topics configuration in <code>aws.sns.topics</code> map.
You should always use <code>@Named</code> qualifier when injecting <code>SimpleNotificationService</code> if you have more than one topic configuration present, e.g. <code>@Named("other") SimpleNotificationService otherService</code>.</p>
</div>
<div class="paragraph">
<p>Following example shows some of the most common use cases for working with Amazon SNS.</p>
</div>
<div class="sect5">
<h6 id="_working_with_topics"><a class="anchor" href="#_working_with_topics"></a>Working with Topics</h6>
<div class="listingblock primary">
<div class="title">Creating Topic (AWS SDK 2.x)</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="java">String topicArn = service.createTopic(TEST_TOPIC);                              <i class="conum" data-value="1"></i><b>(1)</b>

Topic found = Flux.from(service.listTopics()).filter(t -&gt;                       <i class="conum" data-value="2"></i><b>(2)</b>
    t.topicArn().endsWith(TEST_TOPIC)
).blockFirst();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create new topic of given name</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The topic is present within the list of all topics' names</td>
</tr>
</table>
</div>
<div class="listingblock secondary">
<div class="title">Creating Topic (AWS SDK 1.x)</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="java">String topicArn = service.createTopic(TEST_TOPIC);                              <i class="conum" data-value="1"></i><b>(1)</b>

Topic found = Flux.from(service.listTopics()).filter(t -&gt;                       <i class="conum" data-value="2"></i><b>(2)</b>
    t.getTopicArn().endsWith(TEST_TOPIC)
).blockFirst();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create new topic of given name</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The topic is present within the list of all topics' names</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Subscribe to Topic</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="java">String subArn = service.subscribeTopicWithEmail(topicArn, EMAIL);               <i class="conum" data-value="1"></i><b>(1)</b>

String messageId = service.publishMessageToTopic(                               <i class="conum" data-value="2"></i><b>(2)</b>
    topicArn,
    "Test Email",
    "Hello World"
);

service.unsubscribeTopic(subArn);                                               <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Subscribe to the topic with an email (there are more variants of this method to subscribe to most common protocols such as HTTP(S) endpoints, SQS, &#8230;&#8203;)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Publish message to the topic</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Use the subscription ARN to unsubscribe from the topic</td>
</tr>
</table>
</div>
<div class="listingblock primary">
<div class="title">Delete Topic (AWS SDK 2.x)</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="java">service.deleteTopic(topicArn);                                                  <i class="conum" data-value="1"></i><b>(1)</b>

Long zero = Flux.from(service.listTopics()).filter(t -&gt;                         <i class="conum" data-value="2"></i><b>(2)</b>
    t.topicArn().endsWith(TEST_TOPIC)
).count().block();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Delete the topic</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The topic is no longer present within the list of all topics' names</td>
</tr>
</table>
</div>
<div class="listingblock secondary">
<div class="title">Delete Topic (AWS SDK 1.x)</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="java">service.deleteTopic(topicArn);                                                  <i class="conum" data-value="1"></i><b>(1)</b>

Long zero = Flux.from(service.listTopics()).filter(t -&gt;                         <i class="conum" data-value="2"></i><b>(2)</b>
    t.getTopicArn().endsWith(TEST_TOPIC)
).count().block();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Delete the topic</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The topic is no longer present within the list of all topics' names</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_working_with_applications"><a class="anchor" href="#_working_with_applications"></a>Working with Applications</h6>
<div class="listingblock">
<div class="title">Working with Applications</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="java">String appArn = service.createPlatformApplication(                              <i class="conum" data-value="1"></i><b>(1)</b>
    "my-app",
    APNS,
    null,
    API_KEY
);

String endpoint = service.createPlatformEndpoint(appArn, DEVICE_TOKEN, DATA);   <i class="conum" data-value="2"></i><b>(2)</b>

String jsonMessage = "{\"data\", \"{\"foo\": \"some bar\"}\", \"notification\", \"{\"title\": \"some title\", \"body\": \"some body\"}\"}";

String msgId = service.sendNotification(endpoint, APNS, jsonMessage);            <i class="conum" data-value="3"></i><b>(3)</b>

service.validateDeviceToken(appArn, endpoint, DEVICE_TOKEN, DATA);              <i class="conum" data-value="4"></i><b>(4)</b>

service.unregisterDevice(endpoint);                                             <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create new Android application (more platforms available)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Register Android device (more platforms available)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Send Android notification (more platforms available)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Validate Android device</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Unregister device</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_sending_sms"><a class="anchor" href="#_sending_sms"></a>Sending SMS</h6>
<div class="listingblock primary">
<div class="title">Sending SMS (AWS SDK 2.x)</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="java">Map&lt;String, MessageAttributeValue&gt; attrs = Collections.emptyMap();
String msgId = service.sendSMSMessage(PHONE_NUMBER, "Hello World", attrs);      <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Send a message to the phone number</td>
</tr>
</table>
</div>
<div class="listingblock secondary">
<div class="title">Sending SMS (AWS SDK 1.x)</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="java">Map&lt;Object, Object&gt; attrs = Collections.emptyMap();
String msgId = service.sendSMSMessage(PHONE_NUMBER, "Hello World", attrs);      <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Send a message to the phone number</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Please, see
<a href="https://agorapulse.github.io/micronaut-aws-sdk/api/com/agorapulse/micronaut/amazon/awssdk/sns/SimpleNotificationService.html">SimpleNotificationService AWS SDK 2.x</a> or
<a href="https://agorapulse.github.io/micronaut-aws-sdk/api/com/agorapulse/micronaut/aws/sns/SimpleNotificationService.html">SimpleNotificationService AWS SDK 1.x</a>
for the full reference.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_testing_7"><a class="anchor" href="#_testing_7"></a>Testing</h5>
<div class="paragraph">
<p>You can very easily mock any of the interfaces and declarative services but if you need close-to-production
DynamoDB integration works well with <a href="https://www.testcontainers.org/">Testcontainers</a> and <a href="https://localstack.cloud/">LocalStack</a> using <code>micronaut-amazon-awssdk-integration-testing</code> module.</p>
</div>
<div class="paragraph">
<p>You need to add following dependencies into your build file:</p>
</div>
<div class="listingblock primary">
<div class="title">Gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code>testImplementation 'com.agorapulse:micronaut-amazon-awssdk-integration-testing:3.3.4'</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Maven</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.agorapulse&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-amazon-awssdk-dynamodb&lt;/artifactId&gt;
    &lt;version&gt;3.3.4&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you can set up your tests like this:</p>
</div>
<div class="listingblock primary">
<div class="title">Groovy</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@MicronautTest                                                                          <i class="conum" data-value="1"></i><b>(1)</b>
@Property(name = 'aws.sns.topic', value = TEST_TOPIC)                                   <i class="conum" data-value="2"></i><b>(2)</b>
@Property(name = 'aws.sns.ios.arn', value = IOS_APP_ARN)
@Property(name = 'aws.sns.ios-sandbox.arn', value = IOS_SANDBOX_APP_ARN)
@Property(name = 'aws.sns.android.arn', value = ANDROID_APP_ARN)
@Property(name = 'aws.sns.amazon.arn', value = AMAZON_APP_ARN)
@Property(name = 'aws.sqs.queue', value = TEST_QUEUE)
class SimpleNotificationServiceSpec extends Specification {

    @Inject SimpleNotificationService service                                           <i class="conum" data-value="3"></i><b>(3)</b>

    // tests

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate the specification with <code>@MicronautTest</code> to let Micronaut handle the application context lifecycle</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Annotate the specification with <code>@Property</code> to set the required Micronaut properties</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Use <code>@Inject</code> to let Micronaut inject the beans into your tests</td>
</tr>
</table>
</div>
<div class="listingblock secondary">
<div class="title">Java</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">class SimpleNotificationServiceTest {

@MicronautTest                                                                          <i class="conum" data-value="1"></i><b>(1)</b>
@Property(name = "aws.sns.topic", value = SimpleNotificationServiceTest.TEST_TOPIC)     <i class="conum" data-value="2"></i><b>(2)</b>
public class SimpleNotificationServiceTest {

    @Inject SimpleNotificationService service;                                          <i class="conum" data-value="3"></i><b>(3)</b>

    // tests

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate the specification with <code>@MicronautTest</code> to let Micronaut handle the application context lifecycle</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Annotate the specification with <code>@Property</code> to set the required Micronaut properties</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Use <code>@Inject</code> to let Micronaut inject the beans into your tests</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can save time creating the new Localstack container by sharing it between the tests.</p>
</div>
<div class="listingblock">
<div class="title">application-test.yml</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="yaml">localstack:
  services: sns,sqs
  shared: true</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_simple_queue_service_sqs"><a class="anchor" href="#_simple_queue_service_sqs"></a>1.9. Simple Queue Service (SQS)</h4>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Amazon Simple Queue Service (SQS) is a fully managed message queuing service that enables you to decouple and scale microservices, distributed systems, and serverless applications. SQS eliminates the complexity and overhead associated with managing and operating message oriented middleware, and empowers developers to focus on differentiating work.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>This library provides two approaches to work with Simple Queue Service queues:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>High-level <a href="#_publishing_with_queueclient">Publishing with <code>@QueueClient</code></a></p>
</li>
<li>
<p>Middle-level <a href="#_simple_queue_service">Simple Queue Service</a></p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_installation_9"><a class="anchor" href="#_installation_9"></a>Installation</h5>
<div class="listingblock primary">
<div class="title">Gradle (AWS SDK 2.x)</div>
<div class="content">
<pre class="prettyprint highlight"><code>annotationProcessor 'com.agorapulse:micronaut-amazon-awssdk-sqs-annotation-processor:3.3.4'
implementation 'com.agorapulse:micronaut-amazon-awssdk-sqs:3.3.4'</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Maven (AWS SDK 2.x)</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.agorapulse&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-amazon-awssdk-sqs&lt;/artifactId&gt;
    &lt;version&gt;3.3.4&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Gradle (AWS SDK 1.x)</div>
<div class="content">
<pre class="prettyprint highlight"><code>annotationProcessor 'com.agorapulse:micronaut-aws-sdk-sqs-annotation-processor:3.3.4'
implementation 'com.agorapulse:micronaut-aws-sdk-sqs:3.3.4'</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Maven (AWS SDK 1.x)</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.agorapulse&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-aws-sdk-sqs&lt;/artifactId&gt;
    &lt;version&gt;3.3.4&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For Kotlin use <code>kapt</code> instead of <code>annotationProcessor</code> configuration.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_configuration_6"><a class="anchor" href="#_configuration_6"></a>Configuration</h5>
<div class="paragraph">
<p>No configuration is required but some of the configuration properties may be useful for you.</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="yaml">aws:
  sqs:
    region: sa-east-1
    # related to service behaviour
    queueNamePrefix: 'vlad_'                                                            <i class="conum" data-value="1"></i><b>(1)</b>
    autoCreateQueue: false                                                              <i class="conum" data-value="2"></i><b>(2)</b>
    cache: false                                                                        <i class="conum" data-value="3"></i><b>(3)</b>

    # related to default queue
    queue: MyQueue                                                                      <i class="conum" data-value="4"></i><b>(4)</b>
    fifo: true                                                                          <i class="conum" data-value="5"></i><b>(5)</b>
    contentBasedDeduplication: true                                                     <i class="conum" data-value="6"></i><b>(6)</b>
    delaySeconds: 0                                                                     <i class="conum" data-value="7"></i><b>(7)</b>
    messageRetentionPeriod: 345600                                                      <i class="conum" data-value="8"></i><b>(8)</b>
    maximumMessageSize: 262144                                                          <i class="conum" data-value="9"></i><b>(9)</b>
    visibilityTimeout: 30                                                               <i class="conum" data-value="10"></i><b>(10)</b>

    queues:                                                                             <i class="conum" data-value="11"></i><b>(11)</b>
      test:                                                                             <i class="conum" data-value="12"></i><b>(12)</b>
        queue: TestQueue</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Queue prefix is prepended to every queue name (may be useful for local development)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Whether to create any missing queue automatically (default <code>false</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Whether to first fetch all queues and set up queue to url cache first time the service is prompted for the queue URL (default <code>false</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>You can specify the default topic for <a href="https://agorapulse.github.io/micronaut-aws-sdk/api/com/agorapulse/micronaut/aws/sqs/SimpleQueueService.html">SimpleQueueService</a> and <code>@QueueClient</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Whether the newly created queues are supposed to be <a href="https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/FIFO-queues.html">FIFO queues</a> (default <code>false</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Enable content based deduplication for FIFO queues (default <code>false</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>The length of time, in seconds, for which the delivery of all messages in the queue is delayed. Valid values: An integer from <code>0</code> to <code>900</code> (15 minutes). Default: <code>0</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>The length of time, in seconds, for which Amazon SQS retains a message. Valid values: An integer representing seconds, from <code>60</code> (1 minute) to <code>1,209,600</code> (14 days). Default: <code>345,600</code> (4 days).</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>The limit of how many bytes a message can contain before Amazon SQS rejects it. Valid values: An integer from <code>1,024</code> bytes (1 KiB) up to <code>262,144</code> bytes (256 KiB). Default: <code>262,144</code> (256 KiB).</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>The visibility timeout for the queue, in seconds. Valid values: an integer from <code>0</code> to <code>43,200</code> (12 hours). Default: <code>30</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b>11</b></td>
<td>You can define multiple configurations</td>
</tr>
<tr>
<td><i class="conum" data-value="12"></i><b>12</b></td>
<td>Each of the configuration can be access using <code>@Named('test') SimpleNotificationService</code> qualifier, or you can define the configuration as <code>value</code> of <code>@NotificationClient('test')</code></td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_publishing_with_queueclient"><a class="anchor" href="#_publishing_with_queueclient"></a>Publishing with <code>@QueueClient</code></h5>
<div class="paragraph">
<p>If you place <code>QueueClient</code> annotation on the interface then methods
matching predefined pattern will be automatically implemented. Methods containing word <code>delete</code> will delete queue messages.
Other methods of <code>QueueClient</code> will publish new records into the queue.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For AWS SDK 2.x, use packages starting <code>com.agorapulse.micronaut.amazon.awssdk.sqs</code>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For AWS SDK 1.x, use packages starting <code>com.agorapulse.micronaut.aws.sdk.sqs</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following example shows many of available method signatures for publishing records:</p>
</div>
<div class="listingblock primary">
<div class="title">Publishing String Records (AWS SDK 2.x)</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="java">package com.agorapulse.micronaut.amazon.awssdk.sqs;

import com.agorapulse.micronaut.amazon.awssdk.sqs.annotation.Queue;
import com.agorapulse.micronaut.amazon.awssdk.sqs.annotation.QueueClient;
import org.reactivestreams.Publisher;

@QueueClient                                                                            <i class="conum" data-value="1"></i><b>(1)</b>
interface DefaultClient {

    @Queue(value = "OtherQueue", group = "SomeGroup")
    String sendMessageToQueue(String message);                                          <i class="conum" data-value="2"></i><b>(2)</b>

    String sendMessage(Pogo message);                                                   <i class="conum" data-value="3"></i><b>(3)</b>

    String sendMessage(byte[] record);                                                  <i class="conum" data-value="4"></i><b>(4)</b>

    String sendMessage(String record);                                                  <i class="conum" data-value="5"></i><b>(5)</b>

    String sendMessage(String record, int delay);                                       <i class="conum" data-value="6"></i><b>(6)</b>

    String sendMessage(String record, String group);                                    <i class="conum" data-value="7"></i><b>(7)</b>

    String sendMessage(String record, int delay, String group);                         <i class="conum" data-value="8"></i><b>(8)</b>

    void sendStringMessages(Publisher&lt;String&gt; messages);                                <i class="conum" data-value="9"></i><b>(9)</b>

    Publisher&lt;String&gt; sendMessages(Publisher&lt;Pogo&gt; messages);                           <i class="conum" data-value="10"></i><b>(10)</b>

    void deleteMessage(String messageId);                                               <i class="conum" data-value="11"></i><b>(11)</b>

    String OTHER_QUEUE = "OtherQueue";
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>@QueueClient</code> annotation makes the interface a SQS client</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can specify to which queue is the message published using <code>@Queue</code> annotation, you can also specify the <code>group</code> for FIFO queues</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>You can publish any record object which can be converted into JSON.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>You can publish a byte array record</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>You can publish a string record</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>You can publish a string with custom delay</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>You can publish a string with custom FIFO queue group</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>You can publish a string with custom delay and FIFO queue group</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>You can send multiple messages at once when the argument is <code>Publisher</code></td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>If the return type is also publisher type then <strong>you need to subscribe to the publisher to actually send the messages</strong></td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b>11</b></td>
<td>You can delete published message using the message ID if the</td>
</tr>
</table>
</div>
<div class="listingblock secondary">
<div class="title">Publishing String Records (AWS SDK 1.x)</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="java">package com.agorapulse.micronaut.aws.sqs;

import com.agorapulse.micronaut.aws.sqs.annotation.Queue;
import com.agorapulse.micronaut.aws.sqs.annotation.QueueClient;

@QueueClient                                                                            <i class="conum" data-value="1"></i><b>(1)</b>
interface DefaultClient {

    @Queue(value = "OtherQueue", group = "SomeGroup")
    String sendMessageToQueue(String message);                                          <i class="conum" data-value="2"></i><b>(2)</b>

    String sendMessage(Pogo message);                                                   <i class="conum" data-value="3"></i><b>(3)</b>

    String sendMessage(byte[] record);                                                  <i class="conum" data-value="4"></i><b>(4)</b>

    String sendMessage(String record);                                                  <i class="conum" data-value="5"></i><b>(5)</b>

    String sendMessage(String record, int delay);                                       <i class="conum" data-value="6"></i><b>(6)</b>

    String sendMessage(String record, String group);                                    <i class="conum" data-value="7"></i><b>(7)</b>

    String sendMessage(String record, int delay, String group);                         <i class="conum" data-value="8"></i><b>(8)</b>

    void deleteMessage(String messageId);                                               <i class="conum" data-value="9"></i><b>(9)</b>

    String OTHER_QUEUE = "OtherQueue";
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>@QueueClient</code> annotation makes the interface a SQS client</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can specify to which queue is the message published using <code>@Queue</code> annotation, you can also specify the <code>group</code> for FIFO queues</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>You can publish any record object which can be converted into JSON.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>You can publish a byte array record</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>You can publish a string record</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>You can publish a string with custom delay</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>You can publish a string with custom FIFO queue group</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>You can publish a string with custom delay and FIFO queue group</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>You can delete published message using the message ID if the</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The return value of the publishing methods is message id returned by AWS.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By default, <code>QueueClient</code> publishes records into the default queue defined by <code>aws.sqs.queue</code> property.
You can switch to different configuration by changing the <code>value</code> of the annotation such as <code>@QueueClient("other")</code> or
by setting the <code>queue</code> property of the annotation such as <code>@QueueClient(queue = "SomeQueue")</code>. You can change queue
used by particular method using <code>@Queue</code> annotation as mentioned above.</p>
</div>
</div>
<div class="sect4">
<h5 id="_simple_queue_service"><a class="anchor" href="#_simple_queue_service"></a>Simple Queue Service</h5>
<div class="paragraph">
<p><code>SimpleQueuenService</code> provides middle-level API for creating, describing, and deleting queues. It allows to publish, receive and delete records.</p>
</div>
<div class="paragraph">
<p>Instance of <code>SimpleQueueService</code> is created for the default SQS configuration and each queue configuration in <code>aws.sqs.queues</code> map.
You should always use <code>@Named</code> qualifier when injecting <code>SimpleQueueService</code> if you have more than one topic configuration present, e.g. <code>@Named("other") SimpleQueueService otherService</code>.</p>
</div>
<div class="paragraph">
<p>Following example shows some of the most common use cases for working with Amazon SQS.</p>
</div>
<div class="listingblock">
<div class="title">Creating Queue</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="java">String queueUrl = service.createQueue(TEST_QUEUE);                              <i class="conum" data-value="1"></i><b>(1)</b>

assertTrue(service.listQueueUrls().contains(queueUrl));                         <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create new queue of given name</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The queue URL is present within the list of all queues' URLs</td>
</tr>
</table>
</div>
<div class="listingblock primary">
<div class="title">Describing Queue Attributes (AWS SDK 2.x)</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="java">Map&lt;QueueAttributeName, String&gt; queueAttributes = service
    .getQueueAttributes(TEST_QUEUE);                                            <i class="conum" data-value="1"></i><b>(1)</b>

assertEquals("0", queueAttributes
    .get(QueueAttributeName.DELAY_SECONDS));                                    <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Fetch queue&#8217;s attributes</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can read the queue&#8217;s attributes from the map</td>
</tr>
</table>
</div>
<div class="listingblock secondary">
<div class="title">Describing Queue Attributes (AWS SDK 1.x)</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="java">Map&lt;String, String&gt; queueAttributes = service.getQueueAttributes(TEST_QUEUE);   <i class="conum" data-value="1"></i><b>(1)</b>

assertEquals("0", queueAttributes.get("DelaySeconds"));                         <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Fetch queue&#8217;s attributes</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can read the queue&#8217;s attributes from the map</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Delete Queue</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="java">service.deleteQueue(TEST_QUEUE);                                                <i class="conum" data-value="1"></i><b>(1)</b>

assertFalse(service.listQueueUrls().contains(queueUrl));                        <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Delete queue</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The queue URL is no longer present within the list of all queues' URLs</td>
</tr>
</table>
</div>
<div class="listingblock primary">
<div class="title">Working with Messages (AWS SDK 2.x)</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="java">String msgId = service.sendMessage(DATA);                                       <i class="conum" data-value="1"></i><b>(1)</b>

assertNotNull(msgId);

List&lt;Message&gt; messages = service.receiveMessages();                             <i class="conum" data-value="2"></i><b>(2)</b>
Message first = messages.get(0);

assertEquals(DATA, first.body());                                               <i class="conum" data-value="3"></i><b>(3)</b>
assertEquals(msgId, first.messageId());
assertEquals(1, messages.size());

service.deleteMessage(first.receiptHandle());                                   <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Send a message</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Receive messages from the queue (in another application)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Read message body</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Developers are responsible to delete the message from the queue themselves</td>
</tr>
</table>
</div>
<div class="listingblock secondary">
<div class="title">Working with Messages (AWS SDK 1.x)</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="java">String msgId = service.sendMessage(DATA);                                       <i class="conum" data-value="1"></i><b>(1)</b>

assertNotNull(msgId);

List&lt;Message&gt; messages = service.receiveMessages();                             <i class="conum" data-value="2"></i><b>(2)</b>
Message first = messages.get(0);

assertEquals(DATA, first.getBody());                                            <i class="conum" data-value="3"></i><b>(3)</b>
assertEquals(msgId, first.getMessageId());
assertEquals(1, messages.size());

service.deleteMessage(first.getReceiptHandle());                                <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Send a message</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Receive messages from the queue (in another application)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Read message body</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Developers are responsible to delete the message from the queue themselves</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Try to use AWS Lambda functions triggered by SQS messages to handle incoming SQS messages instead of implementing
complex message handling logic yourselves.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Please, see
<a href="https://agorapulse.github.io/micronaut-aws-sdk/api/com/agorapulse/micronaut/amazon/awssdk/sqs/SimpleQueueService.html">SimpleQueueService AWS SDK 2.x</a> or
<a href="https://agorapulse.github.io/micronaut-aws-sdk/api/com/agorapulse/micronaut/aws/sqs/SimpleQueueService.html">SimpleQueueService AWS SDK 1.x</a>
for the full reference.</p>
</div>
</div>
<div class="sect4">
<h5 id="_testing_8"><a class="anchor" href="#_testing_8"></a>Testing</h5>
<div class="paragraph">
<p>You can very easily mock any of the interfaces and declarative services but if you need close-to-production
DynamoDB integration works well with <a href="https://www.testcontainers.org/">Testcontainers</a> and <a href="https://localstack.cloud/">LocalStack</a> using <code>micronaut-amazon-awssdk-integration-testing</code> module.</p>
</div>
<div class="paragraph">
<p>You need to add following dependencies into your build file:</p>
</div>
<div class="listingblock primary">
<div class="title">Gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code>testImplementation 'com.agorapulse:micronaut-amazon-awssdk-integration-testing:3.3.4'</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Maven</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.agorapulse&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-amazon-awssdk-dynamodb&lt;/artifactId&gt;
    &lt;version&gt;3.3.4&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you can set up your tests like this:</p>
</div>
<div class="listingblock primary">
<div class="title">Groovy</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">@MicronautTest                                                                          <i class="conum" data-value="1"></i><b>(1)</b>
@Property(name = 'aws.sqs.queue', value = TEST_QUEUE)                                   <i class="conum" data-value="2"></i><b>(2)</b>
class SimpleQueueServiceSpec extends Specification {

    @Inject SimpleQueueService service                                                  <i class="conum" data-value="3"></i><b>(3)</b>

    // tests

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate the specification with <code>@MicronautTest</code> to let Micronaut handle the application context lifecycle</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Annotate the specification with <code>@Property</code> to set the required Micronaut properties</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Use <code>@Inject</code> to let Micronaut inject the beans into your tests</td>
</tr>
</table>
</div>
<div class="listingblock secondary">
<div class="title">Java</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@MicronautTest                                                                          <i class="conum" data-value="1"></i><b>(1)</b>
@Property(name = "aws.sqs.queue", value = SimpleQueueServiceTest.TEST_QUEUE)            <i class="conum" data-value="2"></i><b>(2)</b>
public class SimpleQueueServiceTest {

    @Inject SimpleQueueService service;                                                 <i class="conum" data-value="3"></i><b>(3)</b>

    // tests

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate the specification with <code>@MicronautTest</code> to let Micronaut handle the application context lifecycle</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Annotate the specification with <code>@Property</code> to set the required Micronaut properties</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Use <code>@Inject</code> to let Micronaut inject the beans into your tests</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can save time creating the new Localstack container by sharing it between the tests.</p>
</div>
<div class="listingblock">
<div class="title">application-test.yml</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="yaml">localstack:
  services: sqs
  shared: true

  aws:
    sqs:
      tags:
        domain: Agorapulse</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_security_token_service_sts"><a class="anchor" href="#_security_token_service_sts"></a>1.10. Security Token Service (STS)</h4>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>The AWS Security Token Service (STS) is a web service that enables you to request temporary, limited-privilege credentials for AWS Identity and Access Management (IAM) users or for users that you authenticate (federated users).</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>This library provides basic support for Amazon STS using <a href="#_security_token_service">Security Token Service</a></p>
</div>
<div class="sect4">
<h5 id="_installation_10"><a class="anchor" href="#_installation_10"></a>Installation</h5>
<div class="listingblock primary">
<div class="title">Gradle (AWS SDK 2.x)</div>
<div class="content">
<pre class="prettyprint highlight"><code>implementation 'com.agorapulse:micronaut-amazon-awssdk-sts:3.3.4'</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Maven (AWS SDK 2.x)</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.agorapulse&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-amazon-awssdk-sts&lt;/artifactId&gt;
    &lt;version&gt;3.3.4&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Gradle (AWS SDK 1.x)</div>
<div class="content">
<pre class="prettyprint highlight"><code>implementation 'com.agorapulse:micronaut-aws-sdk-sts:3.3.4'</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Maven (AWS SDK 1.x)</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.agorapulse&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-aws-sdk-sts&lt;/artifactId&gt;
    &lt;version&gt;3.3.4&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_security_token_service"><a class="anchor" href="#_security_token_service"></a>Security Token Service</h5>
<div class="paragraph">
<p><code>SecurityTokenService</code> provides only one method (with multiple variations) to create credentials
which assumes usage of a certain IAM role.</p>
</div>
<div class="paragraph">
<p>Following example shows how to create credentials for assumed role.</p>
</div>
<div class="listingblock primary">
<div class="title">Assume Role (AWS SDK 2.x)</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="groovy">service.assumeRole('session', 'arn:::my-role', 360) {
    externalId '123456789'
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Assume Role (AWS SDK 1.x)</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="groovy">service.assumeRole('session', 'arn:::my-role', 360) {
    externalId = '123456789'
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please, see
<a href="https://agorapulse.github.io/micronaut-aws-sdk/api/com/agorapulse/micronaut/amazon/awssdk/sts/SecurityTokenService.html">SecurityTokenService AWS SDK 2.x</a> or
<a href="https://agorapulse.github.io/micronaut-aws-sdk/api/com/agorapulse/micronaut/aws/sts/SecurityTokenService.html">SecurityTokenService AWS SDK 1.x</a>
for the full reference.</p>
</div>
</div>
<div class="sect4">
<h5 id="_testing_9"><a class="anchor" href="#_testing_9"></a>Testing</h5>
<div class="paragraph">
<p>It is recommended just to mock the <code>SecurityTokenService</code> in your tests as it only contains single abstract method.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_7"><a class="anchor" href="#_configuration_7"></a>1.11. Configuration</h4>
<div class="paragraph">
<p>See the configuration sections for particular services.</p>
</div>
<div class="paragraph">
<p>Following services support configuring <code>region</code> and <code>endpoint</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>CloudWatch</p>
</li>
<li>
<p>DynamoDB</p>
</li>
<li>
<p>Lambda</p>
</li>
<li>
<p>Kinesis</p>
</li>
<li>
<p>S3</p>
</li>
<li>
<p>SES</p>
</li>
<li>
<p>SNS</p>
</li>
<li>
<p>SQS</p>
</li>
<li>
<p>STS</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, to configure region for DynamoDB you can add following settings:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="yaml">aws:
  dynamodb:
    region: us-east-1
    endpoint: http://localhost:8000</code></pre>
</div>
</div>
<div class="paragraph">
<p>The same service can also be configured with different <a href="https://docs.aws.amazon.com/sdk-for-java/latest/developer-guide/http-configuration.html">HTTP client</a> settings when using AWS SDK 2.x.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="yaml">aws:
  dynamodb:
    # can be url-connection or aws-crt, apache is the default
    client: url-connection
    # can be aws-crt, netty is the default
    async-client: aws-crt</code></pre>
</div>
</div>
<div class="paragraph">
<p>The client libraries must be added to the classpath. For example for Gradle add the following dependencies:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">dependencies {
    runtimeOnly "software.amazon.awssdk:aws-crt-client:$awsSdk2Version"
    runtimeOnly "software.amazon.awssdk:url-connection-client:$awsSdk2Version"
    runtimeOnly "software.amazon.awssdk:netty-nio-client:$awsSdk2Version"
    runtimeOnly "software.amazon.awssdk:apache-client:$awsSdk2Version"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The particular client builder can be then configured using <code>BeanCreatedEventListener</code> beans:</p>
</div>
<div class="listingblock">
<div class="title">NettyClientCustomizer</div>
<div class="content">
<pre class="prettyprint highlight nowrap"><code data-lang="java">@Singleton
public class NettyClientCustomizer implements BeanCreatedEventListener&lt;NettyNioAsyncHttpClient.Builder&gt; {

    @Override
    public NettyNioAsyncHttpClient.Builder onCreated(@NonNull BeanCreatedEvent&lt;NettyNioAsyncHttpClient.Builder&gt; event) {
        event.getBean().readTimeout(Duration.ofSeconds(10));
        return event.getBean();
    }

}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_micronaut_for_api_gateway_proxy"><a class="anchor" href="#_micronaut_for_api_gateway_proxy"></a>2. Micronaut for API Gateway Proxy</h3>
<div class="paragraph">
<p>API Gateway Lambda Proxy support for Micronaut has been replaced by an official suport
<a href="https://micronaut-projects.github.io/micronaut-aws/latest/guide/#apiProxy">Micronaut AWS API Gateway Support</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_micronaut_grails"><a class="anchor" href="#_micronaut_grails"></a>3. Micronaut Grails</h3>
<div class="paragraph">
<p>Micronaut Grails package has been moved into <a href="https://agorapulse.github.io/micronaut-grails">own repository</a>.</p>
</div>
</div>
<div class="sect1">
<h2 id="_links"><a class="anchor" href="#_links"></a>1. Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="api/index.html" target="_blank" rel="noopener">Javadoc</a></p>
</div>
<div class="paragraph">
<p><a href="api-html/index.html" target="_blank" rel="noopener">Source</a></p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 3.3.4<br>
Last updated 2025-01-09 15:49:33 UTC
</div>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/run_prettify.min.js"></script>
</body>
</html>